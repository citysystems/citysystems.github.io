System.register(["jimu-core","jimu-layouts/layout-runtime","jimu-ui/advanced/setting-components","jimu-ui","jimu-core/react","jimu-arcgis","jimu-theme"],(function(e,t){var o={},n={},l={},r={},s={},i={},a={};return{setters:[function(e){o.AppMode=e.AppMode,o.BaseVersionManager=e.BaseVersionManager,o.ClauseLogic=e.ClauseLogic,o.ClauseOperator=e.ClauseOperator,o.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,o.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,o.DataSourceComponent=e.DataSourceComponent,o.DataSourceFilterChangeMessage=e.DataSourceFilterChangeMessage,o.DataSourceManager=e.DataSourceManager,o.DataSourceStatus=e.DataSourceStatus,o.Immutable=e.Immutable,o.JimuFieldType=e.JimuFieldType,o.MessageManager=e.MessageManager,o.QueryScope=e.QueryScope,o.React=e.React,o.ReactRedux=e.ReactRedux,o.RecordSetChangeType=e.RecordSetChangeType,o.UtilityManager=e.UtilityManager,o.WidgetState=e.WidgetState,o.classNames=e.classNames,o.css=e.css,o.dataSourceUtils=e.dataSourceUtils,o.esri=e.esri,o.i18n=e.i18n,o.jsx=e.jsx,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,o.lodash=e.lodash,o.polished=e.polished,o.urlUtils=e.urlUtils,o.utils=e.utils},function(e){n.PageVisibilityContext=e.PageVisibilityContext,n.ViewVisibilityContext=e.ViewVisibilityContext},function(e){l.OutputDsAddress=e.OutputDsAddress,l.SearchServiceType=e.SearchServiceType},function(e){r.Button=e.Button,r.Checkbox=e.Checkbox,r.Dropdown=e.Dropdown,r.DropdownButton=e.DropdownButton,r.DropdownItem=e.DropdownItem,r.DropdownMenu=e.DropdownMenu,r.Icon=e.Icon,r.Link=e.Link,r.Popper=e.Popper,r.TextInput=e.TextInput,r.defaultMessages=e.defaultMessages,r.hooks=e.hooks},function(e){s.useEffect=e.useEffect},function(e){i.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){a.useTheme=e.useTheme}],execute:function(){e((()=>{var e={20864:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13 6.133c0 .598-.28 1.46-.825 2.51-.53 1.02-1.247 2.102-1.981 3.102A45.718 45.718 0 0 1 8 14.492a48.01 48.01 0 0 1-2.194-2.747c-.734-1-1.451-2.081-1.98-3.102C3.28 7.593 3 6.731 3 6.133 3 3.277 5.26 1 8 1s5 2.277 5 5.133Zm1 0c0 2.685-3.768 7.311-5.332 9.115C8.258 15.722 8 16 8 16s-.258-.279-.668-.752C5.768 13.444 2 8.819 2 6.133 2 2.746 4.686 0 8 0s6 2.746 6 6.133ZM10 5.5a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm1 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" fill="#000"></path></svg>'},59788:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .538.538 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.538.538 0 0 1 0-.738Z" fill="#000"></path></svg>'},96009:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .538.538 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.538.538 0 0 1 0 .738Z" fill="#000"></path></svg>'},55339:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746L8.746 8Z" fill="#000"></path></svg>'},30224:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0Zm-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707l-4.137-4.137Z" fill="#000"></path></svg>'},54357:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0v-6ZM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5Z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1Zm0 3V1H5v2h6Zm1.895 1h-9.79l.8 11h8.19l.8-11Z" fill="#000"></path></svg>'},79964:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 2.125 14.334 14H1.667L8 2.125Zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47L7.118 1.653ZM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995Zm1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z" fill="#000"></path></svg>'},26826:e=>{"use strict";e.exports=i},48891:e=>{"use strict";e.exports=o},51315:e=>{"use strict";e.exports=s},74758:e=>{"use strict";e.exports=n},34796:e=>{"use strict";e.exports=a},30726:e=>{"use strict";e.exports=r},77756:e=>{"use strict";e.exports=l}},t={};function u(o){var n=t[o];if(void 0!==n)return n.exports;var l=t[o]={exports:{}};return e[o](l,l.exports,u),l.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var o in t)u.o(t,o)&&!u.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var c={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(c),u.d(c,{default:()=>Ae});var e=u(48891),t=u(74758),o=u(77756);const n="recent_searches";var l,r,s;!function(e){e.ResultPanel="Result_Panel",e.OtherWidgets="Other_Widgets"}(l||(l={})),function(e){e.Style1="Style1",e.Style2="Style2"}(r||(r={})),function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(s||(s={}));var i=u(30726),a=u(51315);const d={_widgetLabel:"Search",showResult:"Show search results for {searchText}",hideResult:"Hide search results for {searchText}",allSearchSources:"All search sources",noResult:'No results found for "{searchText}"',couldNotRetrieve:"Could not retrieve current location.",showMoreResult:"Show more results",clearAllHistories:"Clear all histories",clearHistorie:"Clear history",clearThisHistories:"Remove this history",clearRecentSearches:"Recent searches",searchIn:"Search in {value}",searchResults:"Search result"};var v=u(59788),g=u.n(v);const p=t=>{const o=window.SVG,{className:n}=t,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:g()},l)):e.React.createElement("svg",Object.assign({className:r},l))};var m=u(96009),h=u.n(m);const f=t=>{const o=window.SVG,{className:n}=t,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:h()},l)):e.React.createElement("svg",Object.assign({className:r},l))},{useRef:S,useState:y}=e.React,b=t=>{const o=i.hooks.useTranslate(d,i.defaultMessages),n=e.css`
    & {
      box-sizing: border-box;
      width: ${e.polished.rem(32)}
    }
    .setting-dropdown-button {
      border-radius: 0;
      svg {
        margin: 0 !important;
      }
    }
  `,[l,r]=y(!0),[s,u]=e.React.useState(!1),{className:c,datasourceConfig:v,onDatasourceConfigChange:g}=t,m=S(null);return(0,a.useEffect)((()=>{var e;const t=0===(null===(e=null==v?void 0:v.filter((e=>!(null==e?void 0:e.enable))))||void 0===e?void 0:e.length);r(t)}),[v]),(0,e.jsx)("div",{className:`${c||""}`,css:n,role:"group","aria-label":o("searchIn",{value:""})},(0,e.jsx)(i.Dropdown,{className:"w-100 h-100",toggle:e=>{var t;const o=null==e?void 0:e.target;if(null===(t=null==m?void 0:m.current)||void 0===t?void 0:t.contains(o))return!1;u(!s)},isOpen:s},(0,e.jsx)(i.DropdownButton,{className:"h-100 setting-dropdown-button",arrow:!1,icon:!0,title:o("searchIn",{value:""})},!s&&(0,e.jsx)(p,{size:16,className:"mr-1 d-inline-block",autoFlip:!0}),s&&(0,e.jsx)(f,{size:16,className:"mr-1 d-inline-block",autoFlip:!0})),(0,e.jsx)(i.DropdownMenu,{trapFocus:!1,autoFocus:!1,style:{maxHeight:"auto"}},(0,e.jsx)("div",{ref:m},(0,e.jsx)(i.DropdownItem,{onClick:()=>{const e=null==v?void 0:v.map((e=>{var t;return null===(t=e.setIn(["enable"],!0))||void 0===t?void 0:t.asMutable({deep:!0})}));g(e)},disabled:l,title:o("all")},(0,e.jsx)(i.Checkbox,{checked:l,disabled:l,className:"mr-2"}),o("all")),(0,e.jsx)(i.DropdownItem,{divider:!0}),null==v?void 0:v.map(((t,o)=>{var n;const l=1===(null===(n=null==v?void 0:v.filter((e=>null==e?void 0:e.enable)))||void 0===n?void 0:n.length)&&(null==t?void 0:t.enable);return(0,e.jsx)(i.DropdownItem,{key:`${null==t?void 0:t.label}${o}`,title:null==t?void 0:t.label,disabled:l,onClick:()=>{((e,t)=>{const o=null==v?void 0:v.setIn([t,"enable"],e);g(o)})(!(null==t?void 0:t.enable),o)}},(0,e.jsx)(i.Checkbox,{checked:null==t?void 0:t.enable,disabled:l,className:"mr-2"}),null==t?void 0:t.label)}))))))};var x=u(26826);const I="address",w={alias:"ADDRESS",type:"string",name:I},j=(Object.assign(Object.assign({},w),{jimuName:I}),(e,t)=>B(null==t?void 0:t.outputDataSourceId)&&(null==t?void 0:t.isSupportSuggest)?R(t,e):Promise.resolve({})),R=(e,t)=>T(null==e?void 0:e.geocodeURL,t,null==e?void 0:e.maxSuggestions).then((o=>{let n=[];o.forEach(((o,l)=>{const r=o.text;if(r&&!A(n,r)){const l={suggestionHtml:$(r,t),suggestion:r,configId:null==e?void 0:e.configId,magicKey:null==o?void 0:o.magicKey};n.push(l)}})),n=P(n,"suggestion");const l={suggestionItem:n.splice(0,e.maxSuggestions),layer:null==e?void 0:e.label,icon:null==e?void 0:e.icon};return Promise.resolve(l)})).catch((e=>Promise.reject(e))),N=(t,o,n,l)=>{if(B(null==n?void 0:n.outputDataSourceId))return U(D(n.outputDataSourceId),e.DataSourceStatus.NotReady),O({address:t,maxResultNumber:o,searchResultView:l,geocodeItem:n})},O=t=>{const{address:o,maxResultNumber:n,geocodeItem:l}=t,{outputDataSourceId:r,singleLineFieldName:s,defaultAddressFieldName:i}=l,a=D(r),u={geocodeItem:l,address:o,maxResultNumber:n,singleLineFieldName:s,addressFields:(null==l?void 0:l.addressFields)||[]};return C(u).then((t=>(0,x.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer","esri/Graphic"]).then((n=>{var s;const[u,c]=n,d=null==t?void 0:t.filter((e=>null==e?void 0:e.address));let v;const g=null==d?void 0:d.map(((e,t)=>{const o=e.attributes;return o.address=e.address,i&&(o[i]=e.address),o.objectid=t,v=e.extent,new c({attributes:o,geometry:e.location})})),p=new u({id:`${r}_layer`,fields:null===(s=null==l?void 0:l.addressFields)||void 0===s?void 0:s.map((e=>({alias:e.alias,type:"string",name:e.jimuName}))),objectIdField:"objectid",geometryType:"point",source:g,fullExtent:v});a.layer=p;const m=o?e.DataSourceStatus.Unloaded:e.DataSourceStatus.NotReady;return U(a,m),Promise.resolve(e.DataSourceStatus.Unloaded)})))).catch((e=>Promise.reject(e)))},C=t=>{const{geocodeItem:o,address:n,maxResultNumber:l,singleLineFieldName:r,addressFields:s}=t,{geocodeURL:i,magicKey:a}=o;return(0,x.loadArcGISJSAPIModules)(["esri/rest/locator"]).then((t=>{var o;const[u]=t,c=r||"SingleLine";let d=(0,e.Immutable)({maxSuggestions:l});const v=null===(o=null==s?void 0:s.map((e=>null==e?void 0:e.jimuName)))||void 0===o?void 0:o.join(",");return v&&(d=d.set("outFields",v)),d=d.setIn([c],n),a&&(d=d.set("magicKey",a)),u.addressToLocations(i,{address:null==d?void 0:d.asMutable({deep:!0})},{query:{}}).then((e=>(e=e.sort(((e,t)=>t.score-e.score))).filter((e=>e.location))),(e=>(console.error(e.message),[])))}))},T=(e,t,o)=>(0,x.loadArcGISJSAPIModules)(["esri/rest/locator"]).then((n=>{const[l]=n;return l.suggestLocations(e,{text:t,maxSuggestions:o}).then((e=>e||[]),(e=>(console.error(e.message),[])))})),M=(e,t,o,n=!1)=>{const l=null==e?void 0:e.outputDataSourceId,r=D(null==e?void 0:e.outputDataSourceId),s={where:"1=1",pageSize:t,page:1,returnGeometry:!0};return null==r?void 0:r.load(s,{widgetId:o}).then((t=>Promise.resolve({records:t,configId:e.configId,dsId:l,isGeocodeRecords:!0,displayFields:null==e?void 0:e.displayFields})))},k=(e,t,n,l=!1)=>{const r=[];for(const s in e){const i=e[s];let a;a=i.searchServiceType===o.SearchServiceType.FeatureService?J(i,t,n):M(i,t,n,l),r.push(a)}return Promise.all(r)},D=t=>t?e.DataSourceManager.getInstance().getDataSource(t):null,P=(e,t)=>{const o=e[0]?[e[0]]:[];for(let n=1;n<e.length;n++){const l=e[n];let r=!1;for(let e=0;e<o.length;e++)if(l[t]===o[e][t]){r=!0;break}r||o.push(l)}return o},F=t=>{const o=`exb-${e.urlUtils.getAppIdPageIdFromUrl().appId}-${t}_${n}`,l=`${t}_${n}`;let r=e.utils.readLocalStorage(o)||e.utils.readLocalStorage(l);return r&&(r=unescape(r)),r?null==r?void 0:r.split("/@/"):[]},L=(e,t)=>{var o,n,l;return null===(l=null===(n=null===(o=null==e?void 0:e.asMutable({deep:!0}))||void 0===o?void 0:o.datasourceConfig)||void 0===n?void 0:n.filter((e=>e.configId===t)))||void 0===l?void 0:l[0]},E=e=>{let t=0;for(const o in e)t++;return t};function A(e,t){return e.filter((e=>t===(null==e?void 0:e.suggestion))).length>0}function $(e,t){if(!t)return e;const o=new RegExp(`(${t})`,"gi"),n=new RegExp(`(${t})`,"gi");return e.match(o)?e.replace(n,"<strong >$1</strong>"):e}function U(e,t){e.setStatus(t),e.setCountStatus(t)}function B(e){return!!e&&!!D(e)}const G=(t,o,n=e.RecordSetChangeType.CreateUpdate)=>{const l=[];null==o||o.forEach((e=>{var t;if(null==e?void 0:e.isGeocodeRecords){const o=D(e.dsId),n=null===(t=null==e?void 0:e.displayFields)||void 0===t?void 0:t.map((e=>e.jimuName)),r={records:e.records,fields:n,dataSource:o,name:o.id};l.push(r)}}));const r=new e.DataRecordSetChangeMessage(t,n,l);e.MessageManager.getInstance().publishMessage(r)};var V=function(e,t,o,n){return new(o||(o=Promise))((function(l,r){function s(e){try{a(n.next(e))}catch(e){r(e)}}function i(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,i)}a((n=n.apply(e,t||[])).next())}))};function _(t,o,n){var l,r;return V(this,void 0,void 0,(function*(){const s=(null==o?void 0:o.datasourceConfig)||[];if(!B(null===(l=null==n?void 0:n.useDataSource)||void 0===l?void 0:l.dataSourceId))return Promise.resolve({});const i=(null==n?void 0:n.searchFields)||[],a=null===(r=null==s?void 0:s.filter((e=>(null==e?void 0:e.configId)===n.configId)))||void 0===r?void 0:r[0];return function(t,o,n,l,r){var s;return V(this,void 0,void 0,(function*(){const{label:i,icon:a,configId:u}=n,c=null===(s=null==o?void 0:o.useDataSource)||void 0===s?void 0:s.dataSourceId,d=D(c),v=null==o?void 0:o.SuggestionSQL,g={outFields:l.map((e=>e.name)),returnDistinctValues:!0,returnGeometry:!1,orderByFields:null};((null==v?void 0:v.sql)||"string"==typeof(null==v?void 0:v.sql))&&(g.where=null==v?void 0:v.sql);const p=new RegExp(`(${t})`,"gi");return function(t,o){return V(this,void 0,void 0,(function*(){return o?yield o.query(t,{scope:e.QueryScope.InRuntimeView}).then((e=>V(this,void 0,void 0,(function*(){return yield function(e,t){return V(this,void 0,void 0,(function*(){return yield Promise.resolve((null==t?void 0:t.records)||[])}))}(0,e)})))):yield Promise.resolve([])}))}(g,d).then((o=>V(this,void 0,void 0,(function*(){let n=[];l.forEach((l=>{o.forEach((o=>{const r=e.i18n.getIntl(),s=o.getFormattedFieldValue(null==l?void 0:l.name,r);if(s&&!A(n,s)&&s.match(p)){const e={suggestionHtml:$(s,t),suggestion:s,configId:u,isFromSuggestion:!0};n.push(e)}}))})),n=P(n,"suggestion");const s={suggestionItem:n.splice(0,r),layer:i,icon:a};return Promise.resolve(s)})))).catch((e=>Promise.resolve({suggestionItem:[],layer:null,icon:null})))}))}(t,n,a,i,null==o?void 0:o.maxSuggestions)}))}function Z(t,o,n,l){if(o){const r=[];o.forEach((o=>{let s=t;const i=null==n?void 0:n.getFieldCodedValueList(null==o?void 0:o.name);i&&(null==i||i.forEach((e=>{s===(null==e?void 0:e.label)&&(s=null==e?void 0:e.value)})));const a=!isNaN(Number(s))&&isFinite(Number(s));if(o.type===e.JimuFieldType.Number&&!a)return!1;const u=function(t,o){let n;return t===e.JimuFieldType.Number?n=e.ClauseOperator.NumberOperatorIs:t===e.JimuFieldType.String&&(n=o?e.ClauseOperator.StringOperatorIs:e.ClauseOperator.StringOperatorContains),n}(o.type,l),c=o.type===e.JimuFieldType.Number?Number(s):s,d=e.dataSourceUtils.createSQLClause(null==o?void 0:o.name,u,c);r.push(d)}));const s=e.dataSourceUtils.createSQLExpression(e.ClauseLogic.Or,r);return e.dataSourceUtils.getArcGISSQL(s,n)}}function H(t,o,n){var l;const r=null===(l=null==t?void 0:t.useDataSource)||void 0===l?void 0:l.dataSourceId,s=D(r),i=null==t?void 0:t.SQL,a=n?(null==i?void 0:i.sql)||"1=0":"1=1",u=(0,e.Immutable)({outFields:["*"],where:a,returnGeometry:!0});s&&s.updateQueryParams(u,o)}const J=(e,t,o)=>{var n,l;const r=null===(n=null==e?void 0:e.useDataSource)||void 0===n?void 0:n.dataSourceId;if(!B(r))return Promise.resolve({});const s=D(r),i={where:(null===(l=null==e?void 0:e.SQL)||void 0===l?void 0:l.sql)||"1=0",pageSize:t,page:1,returnGeometry:!0};return null==s?void 0:s.load(i,{widgetId:o}).then((t=>Promise.resolve({records:t,configId:e.configId,dsId:r,isGeocodeRecords:!1})))};var q=u(54357),K=u.n(q);const z=t=>{const o=window.SVG,{className:n}=t,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:K()},l)):e.React.createElement("svg",Object.assign({className:r},l))};var Q=u(20864),W=u.n(Q);const X=t=>{const o=window.SVG,{className:n}=t,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:W()},l)):e.React.createElement("svg",Object.assign({className:r},l))};var Y=u(79964),ee=u.n(Y);const te=t=>{const o=window.SVG,{className:n}=t,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:ee()},l)):e.React.createElement("svg",Object.assign({className:r},l))},{useState:oe}=e.React,ne=t=>{const n=i.hooks.useTranslate(d,i.defaultMessages),{serviceList:l,onLocationChange:r}=t,[s,a]=oe(!1),[u,c]=e.React.useState(null);e.React.useEffect((()=>{v()}),[l]);const v=()=>{var e;for(const t in l){const n=null===(e=l[t])||void 0===e?void 0:e.asMutable({deep:!0});if(n.searchServiceType===o.SearchServiceType.GeocodeService){c(n);break}}},g=e=>{const t=`${e.coords.longitude},${e.coords.latitude}`;u?((e,t)=>t?(0,x.loadArcGISJSAPIModules)(["esri/rest/locator"]).then((o=>{const[n]=o;return(e=>{const t=e&&e.coords;return t?(0,x.loadArcGISJSAPIModules)(["esri/geometry/Point"]).then((e=>{const[o]=e;return new o({longitude:t.longitude,latitude:t.latitude,z:t.altitude||null,spatialReference:{wkid:4326}})})):Promise.resolve(null)})(t).then((t=>n.locationToAddress(e,{location:t},{query:{}}).then((e=>Promise.resolve(e.address)),(e=>(console.error(e.message),[])))))})):Promise.resolve(null))(null==u?void 0:u.geocodeURL,e).then((e=>{r(e)})):r(t)},p=()=>{a(!0)};return(0,e.jsx)("div",null,!s&&(0,e.jsx)(i.Button,{role:"button",onClick:()=>{var e,t;e=g,t=p,navigator.geolocation?navigator.geolocation.getCurrentPosition(e,t):t&&t()},title:n("useCurrentLocation")},(0,e.jsx)(X,{className:"mr-2"}),n("useCurrentLocation")),s&&(0,e.jsx)(i.Button,{role:"button",title:n("couldNotRetrieve")},(0,e.jsx)(te,{className:"mr-2"}),n("couldNotRetrieve")))};var le=u(34796);const re=(t,o)=>{var n,l,r,s,i,a,u,c,d,v,g,p,m,h;return e.css`
    & {
      max-height: ${e.polished.rem(300)};
      width: ${e.polished.rem(null===(n=null==o?void 0:o.current)||void 0===n?void 0:n.clientWidth)};
      overflow: auto;
      padding-top: 0;
      padding-bottom: 0;
      visibility: unset !important;
    }
    &.hide-popper {
      border: none;
      outline: none;
      box-shadow: none;
      width: 0;
    }
    button {
      width: 100%;
      border: none;
      text-align: left;
      min-height: ${e.polished.rem(32)};
      border-radius: 0;
    }
    &.result-list-con button {
      text-overflow: ellipsis;
      white-space: pre-wrap;
      &:focus {
        background: var(--light-100);
      }
    }
    &.result-list-con :disabled, &.result-list-con button:disabled:hover {
      color: ${null===(s=null===(r=null===(l=null==t?void 0:t.colors)||void 0===l?void 0:l.palette)||void 0===r?void 0:r.secondary)||void 0===s?void 0:s[800]};
      background-color: ${null===(u=null===(a=null===(i=null==t?void 0:t.colors)||void 0===i?void 0:i.palette)||void 0===a?void 0:a.light)||void 0===u?void 0:u[200]};
    }
    &.result-list-con button:hover, &.result-list-con button:focus {
      color: ${null===(c=null==t?void 0:t.colors)||void 0===c?void 0:c.black};
      background-color: ${null===(g=null===(v=null===(d=null==t?void 0:t.colors)||void 0===d?void 0:d.palette)||void 0===v?void 0:v.light)||void 0===g?void 0:g[100]};
    }
    &.result-list-con .dropdown-divider {
      margin-left: 0;
      margin-right: 0;
    }
    &.result-list-con button.active {
      background: ${null===(p=null==t?void 0:t.colors)||void 0===p?void 0:p.primary};
      color: ${null===(m=null==t?void 0:t.colors)||void 0===m?void 0:m.white};
    }
    .show-result-button:active, &.result-list-con .show-result-button:focus, &.result-list-con .show-result-button:hover {
      background-color: ${null===(h=null==t?void 0:t.colors)||void 0===h?void 0:h.white};
    }
    .dropdown-menu--inner {
      max-height: none;
    }
    .jimu-dropdown-item {
      min-height: ${e.polished.rem(32)};
    }
    .clear-recent-search-con {
      color: var(--primary) !important;
      height: ${e.polished.rem(40)};
      margin-top: ${e.polished.rem(-4)};
    }
    .dropdown-divider {
      min-height: 0;
    }
    .item-p-l {
      padding-left: ${e.polished.rem(42)} !important;
    }
    .source-label-con {
      color: var(--black) !important;
      font-weight: bold !important;
    }
  `},{useEffect:se,useRef:ie}=e.React,ae=t=>{const o=ie(null),n=ie(null),{children:l,isOpen:r,reference:s,searchInputRef:a,autoFocus:u,className:c,isFocusWidtSearchInput:d,id:v,toggle:g}=t,p=(0,le.useTheme)(),m=e.ReactRedux.useSelector((e=>{var t;const o=null==e?void 0:e.widgetsRuntimeInfo;return null===(t=null==o?void 0:o[v])||void 0===t?void 0:t.state}));se((()=>((null==a?void 0:a.current)&&d&&a.current.addEventListener("keydown",h,!0),()=>{d&&a.current.removeEventListener("keydown",h,!0)})),[]);const h=i.hooks.useEventCallback((e=>{if(!r)return!1;const t=y()||[],o=(null==t?void 0:t.length)-1;"ArrowUp"===e.key?n.current=setTimeout((()=>{t[o].focus()})):"ArrowDown"===e.key&&(n.current=setTimeout((()=>{t[0].focus()})))})),f=i.hooks.useEventCallback((e=>{if(!r)return;const t="button"===e.target.getAttribute("role");if(["Tab","ArrowUp","ArrowDown"].includes(e.key)&&((e.which>=48&&e.which<=90||"Tab"===e.key)&&e.preventDefault(),r&&t))if(clearTimeout(n.current),"Escape"===e.key)S(e);else if(["ArrowUp","ArrowDown"].includes(e.key)||["n","p"].includes(e.key)&&e.ctrlKey){const t=y();let l=t.indexOf(e.target),r=!1;"ArrowUp"===e.key||"p"===e.key&&e.ctrlKey?(l=0!==l?l-1:t.length-1,r=!0):("ArrowDown"===e.key||"n"===e.key&&e.ctrlKey)&&(r=!1,l=l===t.length-1?0:l+1);const s=0===l&&!r,i=l===t.length-1&&r;n.current=d&&(s||i)?setTimeout((()=>{var e;null===(e=a.current)||void 0===e||e.focus()})):setTimeout((()=>{Array.prototype.slice.call(o.current.querySelectorAll(".popper-box"))[0].focus(),t[l].focus()}))}else if("End"===e.key){const e=y();n.current=setTimeout((()=>{e[e.length-1].focus()}))}else if("Home"===e.key){const e=y();n.current=setTimeout((()=>{e[0].focus()}))}else if(e.which>=48&&e.which<=90){const t=y(),o=String.fromCharCode(e.which).toLowerCase();for(let e=0;e<t.length;e+=1)if((t[e].textContent&&t[e].textContent[0].toLowerCase())===o){n.current=setTimeout((()=>{t[e].focus()}));break}}})),S=e=>{var t;e.preventDefault(),b(e),null===(t=null==a?void 0:a.current)||void 0===t||t.focus()},y=()=>o?Array.prototype.slice.call(o.current.querySelectorAll('[role="button"]')).filter((e=>!e.disabled)):[],b=e=>{g(e)};return(0,e.jsx)("div",null,(0,e.jsx)(i.Popper,{autoFocus:u,placement:"bottom-start",open:r,toggle:b,css:re(p,s),reference:s,className:(0,e.classNames)("result-list-popper",c,{"hide-popper":m===e.WidgetState.Closed}),offset:[0,3],popperNodeRef:o},(0,e.jsx)("div",{onKeyDown:f},l)))},{useRef:ue}=e.React,ce=new(0,e.esri.Sanitizer),de=t=>{const o=i.hooks.useTranslate(d,i.defaultMessages),{isRecentSearches:n,className:l,reference:r,searchSuggestion:s,isOpen:a,searchText:u,canUseOutoutDsLength:c,serviceList:v,isShowCurrentLocation:g,id:p,toggel:m,onRecordItemClick:h,clearSearches:f,setSuggestionFirstItem:S}=t,y=(0,le.useTheme)(),b=ue(!1),x=(e,t)=>{0!==e||b.current||(S(t),b.current=!0)};return(0,e.jsx)("div",null,(0,e.jsx)(ae,{isOpen:a,autoFocus:!1,reference:r,toggle:m,id:p,className:(0,e.classNames)("result-list-con",l)},!u&&g&&(0,e.jsx)(ne,{serviceList:v,isShowCurrentLocation:!0,onLocationChange:h}),(()=>{let e=[];return s.forEach((t=>{const o=(null==t?void 0:t.suggestionItem)||[];e=e.concat(o)})),u&&0===e.length})()&&(0,e.jsx)(i.Button,{role:"button",className:"text-center py-2",disabled:!0,title:o("noResult",{searchText:u})},o("noResult",{searchText:u})),(b.current=null,null==s?void 0:s.map(((t,o)=>{var n,l,r;const a=(null==s?void 0:s.length)>1&&(null===(n=null==t?void 0:t.suggestionItem)||void 0===n?void 0:n.length)>0;return(0,e.jsx)("div",{key:`${null==t?void 0:t.layer}-${o}`,role:"group","aria-label":null==t?void 0:t.layer},a&&(0,e.jsx)(i.Button,{role:"button",className:"source-label-con",disabled:!0,title:null==t?void 0:t.layer},(null==t?void 0:t.icon)&&(0,e.jsx)(i.Icon,{className:"mr-2",color:null===(l=null==y?void 0:y.colors)||void 0===l?void 0:l.primary,size:16,icon:null===(r=null==t?void 0:t.icon)||void 0===r?void 0:r.svg}),null==t?void 0:t.layer),((t,o=!1)=>{const n=null==t?void 0:t.suggestionItem,l=null==t?void 0:t.icon;return null==n?void 0:n.map(((n,r)=>{var s;const a=ce.sanitize(n.suggestionHtml),u={configId:null==n?void 0:n.configId,isFromSuggestion:null==n?void 0:n.isFromSuggestion,magicKey:null==n?void 0:n.magicKey};return(0,e.jsx)(i.Button,{className:(0,e.classNames)("d-flex align-items-center py-2",{"item-p-l":o}),key:`${null==t?void 0:t.layer}${r}`,title:n.suggestion,role:"button",onClick:()=>{((e,t)=>{const{configId:o,isFromSuggestion:n,magicKey:l}=t||{};o&&(n||l)?h(e,t):h(e)})(n.suggestion,u)},ref:e=>{x(r,e)}},l&&1===c&&(0,e.jsx)(i.Icon,{className:"mr-2",color:null===(s=null==y?void 0:y.colors)||void 0===s?void 0:s.primary,size:16,icon:null==l?void 0:l.svg}),(0,e.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:a}}))}))})(t,(()=>{if((null==s?void 0:s.length)<2)return!1;let e=0,t=0;return null==s||s.forEach((o=>{var n;const l=null==o?void 0:o.icon;l&&(e+=1),(null===(n=o.suggestionItem)||void 0===n?void 0:n.length)>0&&l&&(t+=1)})),t>0&&e>0})()))}))),n&&(0,e.jsx)(i.DropdownItem,{divider:!0}),n&&(0,e.jsx)(i.Button,{role:"button",className:"clear-recent-search-con",title:o("clearRecentSearches"),onClick:f},(0,e.jsx)(z,{className:"mr-2"}),o("clearRecentSearches"))))},{useEffect:ve,useRef:ge}=e.React,pe=t=>{const n=i.hooks.useTranslate(d),{reference:l,searchText:r,id:s,config:a,serviceList:u,isOpentResultListDefault:c,searchInputRef:v,setResultFirstItem:g,handleDsIdOfSelectedResultItemChange:m}=t,{resultMaxNumber:h}=a,S=ge([]),y=ge(!1),b=ge(null),x=ge(!1);let I={};const w=(0,le.useTheme)(),[j,R]=e.React.useState((0,e.Immutable)({})),[N,O]=e.React.useState({}),[C,T]=e.React.useState(null),[M,P]=e.React.useState(c),[F,A]=e.React.useState(!1),[$,U]=e.React.useState(0);ve((()=>{B()}),[u]),ve((()=>{S.current=[]}),[r]);const B=()=>{y.current=!1;const t=k(null==u?void 0:u.asMutable({deep:!0}),h,s);Promise.all([t]).then((t=>{y.current=!0;let o=j||(0,e.Immutable)({}),n=[];null==t||t.forEach((e=>{n=n.concat(e)})),G(s,n,e.RecordSetChangeType.CreateUpdate);const l={};n.forEach((e=>{const{records:t,configId:n,dsId:r,isGeocodeRecords:s}=e;l[n]=t;const i=W(t,n,r,s);o=o.setIn([n],i)})),O(l),R(o),U($+1),ee(),H()}))},V=()=>{var e;if(E(u)<2)return!1;let t=0,o=0;for(const n in j){const l=L(a,n),r=null==l?void 0:l.icon;r&&(t+=1),(null===(e=j[n])||void 0===e?void 0:e.length)>0&&r&&(o+=1)}return o>0&&t>0},_=(t,o=!1)=>null==t?void 0:t.map(((t,n)=>{var l,r;const{configId:s,value:c,recordId:d,outputDsId:v}=t,g=Y(s,d),p=C===g,m=L(a,s),h=null==m?void 0:m.icon,f=p?null===(l=null==w?void 0:w.colors)||void 0===l?void 0:l.white:null===(r=null==w?void 0:w.colors)||void 0===r?void 0:r.primary,S=E(u);return(0,e.jsx)(i.Button,{className:(0,e.classNames)("d-flex align-items-center",{"item-p-l":o}),key:g,role:"button",active:p,title:c.join(", "),ref:e=>{Z(n,e)},onClick:()=>{K({isActive:p,key:g,recordId:d,dsId:v,configId:s})}},h&&1===S&&(0,e.jsx)(i.Icon,{className:"mr-2",color:f,size:16,icon:null==h?void 0:h.svg}),(0,e.jsx)("div",null,c.join(", ")))})),Z=(e,t)=>{0!==e||x.current||(g(t),x.current=!0)},H=()=>{var e;if(te())return;const t=[];for(const n in u){const l=u[n],r=(null==l?void 0:l.searchServiceType)===o.SearchServiceType.GeocodeService?null==l?void 0:l.outputDataSourceId:null===(e=null==l?void 0:l.useDataSource)||void 0===e?void 0:e.dataSourceId,s=J(r,n);s&&t.push(s)}const n=q(t,null==S?void 0:S.current);S.current=t,n&&n[0]?T(n[0]):T(null)},J=(e,t)=>{var o;const n=D(e).getSelectedRecords(),l=null===(o=null==n?void 0:n[0])||void 0===o?void 0:o.getId();return n&&l?Y(t,l):null},q=(e,t)=>(null==e?void 0:e.length)>(null==t?void 0:t.length)?e.concat(t).filter((o=>!e.includes(o)||!t.includes(o)))||[]:e||[],K=t=>{const{isActive:o,recordId:n,dsId:l,configId:r}=t,i=D(l),a=o?[]:Q(r,n);e.MessageManager.getInstance().publishMessage(new e.DataRecordsSelectionChangeMessage(s,a)),m(n?l:null),n&&(o?i.selectRecordsByIds([]):i.selectRecordsByIds([n]),!o&&z(r))},z=e=>{var t,o;for(const n in j)if(e!==n){const e=null===(o=null===(t=j[n])||void 0===t?void 0:t[0])||void 0===o?void 0:o.outputDsId,l=D(e);l&&l.selectRecordsByIds([])}},Q=(e,t)=>{const o=(null==N?void 0:N[e])||[];return(null==o?void 0:o.filter((e=>(null==e?void 0:e.getId())===t)))||[]},W=(t,o,n,l)=>{var r;const s=(null===(r=null==u?void 0:u[o])||void 0===r?void 0:r.displayFields)||[],i=[],a=e.i18n.getIntl();return null==t||t.forEach((e=>{const t=[];s.forEach((o=>{const n=e.getFormattedFieldValue(o.jimuName,a);(n||0===n)&&t.push(n)}));const l={value:t,configId:o,outputDsId:n,recordId:null==e?void 0:e.getId()};i.push(l),X(l)})),i},X=e=>{!(null==I?void 0:I.recordId)&&e.recordId&&(I=e)},Y=(e,t)=>`${e}_${t}`,ee=()=>{if(!(null==a?void 0:a.isAutoSelectFirstResult)||!(null==I?void 0:I.recordId)||F)return;const{configId:e,recordId:t,outputDsId:o}=I,n=Y(e,t);K({isActive:!1,key:n,recordId:t,dsId:o,configId:e}),A(!0)},te=()=>{var e;let t=0;for(const o in j)t+=(null===(e=null==j?void 0:j[o])||void 0===e?void 0:e.length)||0;return 0===t&&y.current};return(0,e.jsx)("div",{role:"group","aria-label":n("searchResults")},(0,e.jsx)(ae,{isOpen:!0,isFocusWidtSearchInput:!0,autoFocus:!1,reference:l,searchInputRef:v,toggle:e=>{var t;const o=null==e?void 0:e.target;if(null===(t=null==b?void 0:b.current)||void 0===t?void 0:t.contains(o))return!1;te()||P(!1)},id:s,className:"result-list-con"},(0,e.jsx)("div",{className:"result-list-con"},(0,e.jsx)("div",{ref:b},!te()&&(0,e.jsx)(i.Button,{role:"button",className:"d-flex align-items-center show-result-button",onClick:()=>{P(!M),U($+1)},title:n("searchResults")},(0,e.jsx)("div",{className:"flex-grow-1 font-weight-bold"},n("searchResults")),!M&&r?(0,e.jsx)(p,null):(0,e.jsx)(f,null)),M&&(0,e.jsx)("div",null,!te()&&(0,e.jsx)(i.DropdownItem,{divider:!0}),te()&&(0,e.jsx)(i.Button,{role:"button",className:"text-center",disabled:!0,title:n("noResult",{searchText:r})},n("noResult",{searchText:r})),!te()&&(()=>{var t,o;const n=[];x.current=null;for(const l in j){const r=null===(t=null==j?void 0:j.asMutable({deep:!0}))||void 0===t?void 0:t[l],s=L(a,l),c=null==s?void 0:s.label,d=null==s?void 0:s.icon,v=E(u),g=(0,e.jsx)("div",{key:`${l}_${c}_con`,role:"group",title:"label","aria-label":c},r.length>0&&(0,e.jsx)("div",null,v>1&&(0,e.jsx)(i.Button,{role:"button",className:"source-label-con",disabled:!0,key:`${l}_${c}`,title:c},d&&(0,e.jsx)(i.Icon,{className:"mr-2",color:null===(o=null==w?void 0:w.colors)||void 0===o?void 0:o.primary,size:16,icon:null==d?void 0:d.svg}),c),_(r,V())));n.push(g)}return n})())))))};var me=u(30224),he=u.n(me);const fe=t=>{const o=window.SVG,{className:n}=t,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:he()},l)):e.React.createElement("svg",Object.assign({className:r},l))};var Se=u(55339),ye=u.n(Se);const be=t=>{const o=window.SVG,{className:n}=t,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:ye()},l)):e.React.createElement("svg",Object.assign({className:r},l))},{useSelector:xe}=e.ReactRedux,{useState:Ie,useEffect:we,useRef:je,useMemo:Re}=e.React,Ne=t=>{var s,a,u,c,v,g;const p=i.hooks.useTranslate(d,i.defaultMessages),m=(0,le.useTheme)(),h=xe((e=>null==e?void 0:e.queryObject)),f=xe((e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.appMode})),S=je((e=>{})),y=je(null),b=je(null),x=je(null),I=je(null),w=je(null),R=je(!1),O=je(null),C=je(null),T=je(null),M=je(!1),{config:P,className:L,reference:A,id:$,datasourceConfig:V,isShowSearchInput:J,isInCurrentView:q,isWidgetInCurrentPage:K,onShowSearchInputChange:z}=t,{isShowRecentSearches:Q,recentSearchesMaxNumber:W,linkParam:X,searchResultView:Y,resultMaxNumber:ee,arrangementStyle:te}=P,[oe,ne]=Ie(null),[re,se]=Ie(!1),[ie,ae]=Ie(!1),[ue,ce]=Ie(!1),[ve,ge]=Ie({}),[me,he]=Ie(null),[Se,ye]=Ie([]),[Ne,Oe]=Ie(!1),[Ce,Te]=Ie(!1),[Me,ke]=Ie(!1),[De,Pe]=Ie(null),Fe=e.css`
    .input-wrapper {
      height: 100% !important;
    }
    .loading-con {
      @keyframes loading {
        0% {transform: rotate(0deg); };
        100% {transform: rotate(360deg)};
      }
      width: ${e.polished.rem(16)};
      height: ${e.polished.rem(16)};
      min-width: ${e.polished.rem(16)};
      border: 2px solid ${null===(u=null===(a=null===(s=null==m?void 0:m.colors)||void 0===s?void 0:s.palette)||void 0===a?void 0:a.secondary)||void 0===u?void 0:u[300]};
      border-radius: 50%;
      border-top: 2px solid ${null===(g=null===(v=null===(c=null==m?void 0:m.colors)||void 0===c?void 0:c.palette)||void 0===v?void 0:v.primary)||void 0===g?void 0:g[500]};
      box-sizing: border-box;
      animation:loading 2s infinite linear;
      box-sizing: border-box;
    }
    .search-button {
      width: ${e.polished.rem(32)};
      border-radius: 0;
    }
    .search-input-con input{
      width: 100%;
    }
    .search-link-con {
      width: 0;
      height: 0;
      overflow: hidden;
    }
  `;we((()=>{tt()}),[V]),we((()=>{R.current&&q&&K?(Te(!1),e.lodash.defer((()=>{Ge(!0)}))):Te(!0),q&&K||Oe(!1)}),[q,K]),we((()=>{Ne&&f===e.AppMode.Design&&Oe(!1)}),[f]),we((()=>{$e(me),S.current=e.lodash.debounce(Ae,400),Le(me),T.current=me}),[me,P]);const Le=e=>{const t=T.current,n=Ee(e),l=Ee(T.current),r=null==l?void 0:l.filter((e=>!(null==n?void 0:n.includes(e))));(null==r?void 0:r.length)>0&&(clearTimeout(b.current),b.current=setTimeout((()=>{Ue(),null==r||r.forEach((e=>{var n,l;(null===(n=t[e])||void 0===n?void 0:n.searchServiceType)===o.SearchServiceType.FeatureService&&((e,t)=>{const o=D(e);o&&o.updateQueryParams({},t)})(null===(l=t[e].useDataSource)||void 0===l?void 0:l.dataSourceId,$)}))})))},Ee=e=>e?Object.keys(e).map((e=>e)):[],Ae=i.hooks.useEventCallback((e=>{const t=((e,t,n)=>{const l=[];for(const r in t){const s=t[r];let i;i=s.searchServiceType===o.SearchServiceType.FeatureService?_(e,n,s):j(e,s),l.push(i)}return Promise.all(l)})(e,null==me?void 0:me.asMutable({deep:!0}),P);Promise.all([t]).then((e=>{const t=null==e?void 0:e[0];se(!1),t&&ye(t),w.current&&ae(!0)})).catch((e=>{se(!1)}))})),$e=e=>{let t=!1;for(const n in e){const l=e[n];((null==l?void 0:l.searchServiceType)===o.SearchServiceType.FeatureService||(null==l?void 0:l.isSupportSuggest))&&(t=!0)}ke(t)},Ue=()=>{et(""),Be(),se(!1),Ge(!1),_e("",!0)},Be=i.hooks.useEventCallback((()=>{var t,n;for(const l in me)if((null===(t=me[l])||void 0===t?void 0:t.searchServiceType)===o.SearchServiceType.GeocodeService){const t=null===(n=me[l])||void 0===n?void 0:n.outputDataSourceId,o=D(t);o.selectRecordsByIds([]),U(o,e.DataSourceStatus.NotReady),G($,[],e.RecordSetChangeType.Remove)}})),Ge=e=>{R.current=e,e||Te(!0),Oe(e)},Ve=()=>{let e=!0;if(!O.current)return e;const t=O.current;for(const o in t){const n=t[o];if(e=!((null==n?void 0:n.magicKey)||(null==n?void 0:n.isFromSuggestion)),!e)break}return e},_e=(e,t=!1)=>{if(Ne&&!t)return;Qe(e),ae(!1);const n={serviceList:O.current,searchText:e,searchResultView:Y,id:$};Ze(),(e=>{const{serviceList:t,searchText:n,searchResultView:r,id:s}=e,i=[];for(const e in t){const a=t[e],{searchServiceType:u,resultMaxNumber:c}=a;if(u===o.SearchServiceType.FeatureService)H(a,s,n);else if(u===o.SearchServiceType.GeocodeService){const e=r===l.ResultPanel?c:null,t=N(n,e,a,r);i.push(t)}}return Promise.all(i)})(n).then((t=>{He(),e&&Je(e)}))},Ze=()=>{if(e.MessageManager.getInstance().publishMessage(new e.DataRecordsSelectionChangeMessage($,[])),De){const e=D(De);null==e||e.selectRecordsByIds([])}},He=()=>{var t;const n=[];for(const e in me){const l=me[e];let r;(null==l?void 0:l.searchServiceType)===o.SearchServiceType.FeatureService&&(r=null===(t=null==l?void 0:l.useDataSource)||void 0===t?void 0:t.dataSourceId,n.push(r))}e.MessageManager.getInstance().publishMessage(new e.DataSourceFilterChangeMessage($,n))},Je=e=>{Y===l.OtherWidgets?(Xe(),e&&(ze()?We():qe())):Ke()},qe=()=>{const e=k(O.current,ee,$);Promise.all([e]).then((e=>{let t=[],o=[];null==e||e.forEach((e=>{t=t.concat(e)})),t.forEach((e=>{const t=(null==e?void 0:e.records)||[];o=o.concat(t)})),(null==o?void 0:o.length)>0?We():Ke()}))},Ke=()=>{const t=k(O.current,ee,$,!0);Promise.all([t]).then((t=>{let o=[];null==t||t.forEach((e=>{o=o.concat(e)})),G($,o,e.RecordSetChangeType.CreateUpdate)})),Ge(!0)},ze=()=>{let e=[];return Se.forEach((t=>{e=e.concat(null==t?void 0:t.suggestionItem)})),e.length>0},Qe=t=>{(t=>{const{searchText:o,id:l,recentSearchesMaxNumber:r,isShowRecentSearches:s}=t,i=`exb-${e.urlUtils.getAppIdPageIdFromUrl().appId}-${l}_${n}`;if(!s||!o)return!1;let a=F(l);a.includes(o)||(a.unshift(o),a=a.splice(0,r||10),localStorage.setItem(i,escape(a.join("/@/"))))})({searchText:t,id:$,recentSearchesMaxNumber:W,isShowRecentSearches:Q})},We=()=>{var e;if(!(null==y?void 0:y.current))return!1;null===(e=null==y?void 0:y.current)||void 0===e||e.click()},Xe=()=>{const t=Y===l.ResultPanel?ee:null,o=k(O.current,t,$,!0);Promise.all([o]).then((t=>{let o=[];null==t||t.forEach((e=>{o=o.concat(e)})),G($,o,e.RecordSetChangeType.CreateUpdate)}))},Ye=Re((()=>(e=>{let t,o;return(null==e?void 0:e.linkType)&&(t=null==e?void 0:e.openType,o={linkType:null==e?void 0:e.linkType},o.value=null==e?void 0:e.value),{linkTo:o,target:t}})(X)),[X]),et=(e,t)=>{ue&&ce(!1),ye([]),ne(e),w.current=e,lt(e,t)},tt=()=>{var t;let n=(0,e.Immutable)({});null===(t=null==V?void 0:V.asMutable({deep:!0}))||void 0===t||t.forEach((e=>{if(!(null==e?void 0:e.enable))return!1;const{configId:t}=e;let l;l=(null==e?void 0:e.searchServiceType)===o.SearchServiceType.GeocodeService?nt(e):ot(e),n=n.setIn([t],l)})),he(n)},ot=i.hooks.useEventCallback((e=>{var t;if(!(null==e?void 0:e.enable)||(null==e?void 0:e.searchServiceType)===o.SearchServiceType.GeocodeService)return!1;const{configId:n,useDataSource:l,displayFields:r,searchFields:s,searchExact:i,hint:a,searchServiceType:u}=e,c=(null===(t=null==me?void 0:me[n])||void 0===t?void 0:t.asMutable({deep:!0}))||{},d={useDataSource:l,displayFields:r,searchFields:s,searchExact:i,maxSuggestions:null==P?void 0:P.maxSuggestions,resultMaxNumber:ee,hint:a,searchServiceType:u,configId:n};return Object.assign(c,d)})),nt=e=>{var t;if(!(null==e?void 0:e.enable)||(null==e?void 0:e.searchServiceType)===o.SearchServiceType.FeatureService)return!1;const{configId:n,hint:l,geocodeURL:r,outputDataSourceId:s,label:i,searchServiceType:a,singleLineFieldName:u,displayFields:c,defaultAddressFieldName:d,addressFields:v,isSupportSuggest:g}=e,p=(null===(t=null==me?void 0:me[n])||void 0===t?void 0:t.asMutable({deep:!0}))||{},m={hint:l,geocodeURL:r,outputDataSourceId:s,icon:null==e?void 0:e.icon,maxSuggestions:null==P?void 0:P.maxSuggestions,resultMaxNumber:ee,label:i,searchServiceType:a,configId:n,singleLineFieldName:u||"",displayFields:c,defaultAddressFieldName:d,addressFields:v||[],isSupportSuggest:g};return Object.assign(p,m)},lt=i.hooks.useEventCallback(((t,n)=>{var l,r,s;let i=me;for(const e in me){const n=null===(r=null===(l=me[e])||void 0===l?void 0:l.useDataSource)||void 0===r?void 0:r.dataSourceId;if(me[e].searchServiceType===o.SearchServiceType.GeocodeService||!B(n))continue;const a=D(n),u=(null===(s=me[e].searchFields)||void 0===s?void 0:s.asMutable({deep:!0}))||[],c=Z(t,u,a,me[e].searchExact||!1),d=Z(t,u,a,!1);i=i.setIn([e,"SQL"],c).setIn([e,"SuggestionSQL"],d)}he(i),((t,o)=>{const{configId:n,magicKey:l,isFromSuggestion:r}=o||{};let s=(0,e.Immutable)(t);for(const e in s)e===n&&(l&&(s=s.setIn([n,"magicKey"],l||null)),r&&(s=s.setIn([n,"isFromSuggestion"],r||null)));O.current=null==s?void 0:s.asMutable({deep:!0}),ge(null==s?void 0:s.asMutable({deep:!0}))})(null==i?void 0:i.asMutable({deep:!0}),n)})),rt=e=>{if(!e&&Q){const e=F($);if(0===(null==e?void 0:e.length))return!1;const t=e.map((e=>({suggestionHtml:e,suggestion:e,isRecentSearche:!0})));ye([{suggestionItem:t,layer:null,icon:null}]),ae(!0),ce(!0)}else ye([{suggestionItem:[],layer:null,icon:null}]),ae(!1),ce(!1)},st=i.hooks.useEventCallback((()=>{var e,t;let o;const n=it();for(const n in me)o=(null===(e=null==me?void 0:me[n])||void 0===e?void 0:e.hint)&&(null===(t=null==me?void 0:me[n])||void 0===t?void 0:t.hint);const l=(null==P?void 0:P.hint)||p("findAddressOrPlace");return o=o||p("findAddressOrPlace"),1!==n?l:o})),it=i.hooks.useEventCallback((()=>E(me))),at=ie&&!re&&!Ne,ut=e=>{var t,o;40===e.keyCode&&x&&(at?null===(t=null==x?void 0:x.current)||void 0===t||t.focus():Ne&&(null===(o=null==I?void 0:I.current)||void 0===o||o.focus()))};return(0,e.jsx)("div",{className:`h-100 align-items-center position-relative d-flex flex-grow-1 ${L||""}`,css:Fe},(0,e.jsx)("div",{className:"h-100 flex-grow-1 search-input-con"},(0,e.jsx)("div",{className:"h-100 w-100",onKeyUp:e=>{"ArrowUp"!==e.key&&"ArrowDown"!==e.key||(M.current=!0),ut(e)}},J&&(0,e.jsx)(i.TextInput,{value:oe||"",onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,n=(null==o?void 0:o.length)>2;if(et(o),Ne&&_e("",!0),Ge(!1),!n||!Me)return ae(!1),0===(null==o?void 0:o.length)&&_e("",!0),!1;!re&&se(!0),S.current(o)},onFocus:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;rt(o),o||!(null==P?void 0:P.isUseCurrentLoation)||ie||(ae(!0),rt||ye([{suggestionItem:[],layer:null,icon:null}]))},onKeyUp:e=>{var t;if(!e||!e.target)return;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;13===e.keyCode&&Ve()&&(et(o),_e(o)),ut(e)},onBlur:e=>{setTimeout((()=>{M.current||ae(!1),M.current=!1}),200)},className:"h-100 w-100",suffix:(0,e.jsx)("div",{className:"d-flex align-items-center"},re&&(0,e.jsx)("div",{className:"loading-con mr-1"}),oe&&(null==oe?void 0:oe.length)>0&&(0,e.jsx)(i.Button,{icon:!0,type:"tertiary",size:"sm",title:p("clear"),onClick:Ue},(0,e.jsx)(be,null))),placeholder:st(),title:oe||st(),ref:C})),(0,e.jsx)(de,{serviceList:(0,e.Immutable)(ve),canUseOutoutDsLength:it(),isOpen:(()=>{if((null==P?void 0:P.maxSuggestions)>0)return at&&Me;{const e=!oe&&(null==P?void 0:P.isUseCurrentLoation)||ue;return at&&e}})(),reference:A,searchText:oe,searchSuggestion:Se,toggel:()=>{ae(!ie)},onRecordItemClick:(e,t)=>{et(e,t),_e(e)},isRecentSearches:ue,clearSearches:()=>{(t=>{const o=`exb-${e.urlUtils.getAppIdPageIdFromUrl().appId}-${t}_${n}`,l=`${t}_${n}`,r=e.utils.readLocalStorage(l);e.utils.setLocalStorage(o,""),r&&e.utils.setLocalStorage(l,"")})($),ye([]),ae(!1),ce(!1)},isShowCurrentLocation:null==P?void 0:P.isUseCurrentLoation,setSuggestionFirstItem:e=>{x.current=e},id:$,config:P}),Ne&&(0,e.jsx)(pe,{serviceList:(0,e.Immutable)(ve),config:P,reference:A,searchText:oe,id:$,setResultFirstItem:e=>{I.current=e},isOpentResultListDefault:Ce,searchInputRef:C,handleDsIdOfSelectedResultItemChange:e=>{Pe(e)}})),(0,e.jsx)(i.Button,{className:"search-button h-100",type:"primary",icon:!0,onClick:()=>{(e=>{te===r.Style2?(z(!J),ae(!1)):Ve()&&_e(e)})(oe)},title:p("SearchLabel")},(0,e.jsx)(fe,null)),Y===l.OtherWidgets&&(0,e.jsx)("div",{className:"search-link-con"},(0,e.jsx)(i.Link,{ref:y,to:null==Ye?void 0:Ye.linkTo,target:null==Ye?void 0:Ye.target,queryObject:h})))},Oe=t=>{var o;const{config:n,id:l}=t;return(0,e.jsx)("div",null,null===(o=null==n?void 0:n.datasourceConfig)||void 0===o?void 0:o.map((t=>(t=>{const{configId:o}=t,n=null==t?void 0:t.outputDataSourceId,r=null==t?void 0:t.useDataSource,s={dataSourceId:n,mainDataSourceId:n};return(0,e.jsx)("div",{key:`${o}_con`},r&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:(0,e.Immutable)(r),query:null,key:`${o}_useDataSource`,widgetId:l}),n&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:(0,e.Immutable)(s),query:null,key:`${o}_outputDataSource`,widgetId:l}))})(t))))};var Ce=function(e,t,o,n){return new(o||(o=Promise))((function(l,r){function s(e){try{a(n.next(e))}catch(e){r(e)}}function i(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,i)}a((n=n.apply(e,t||[])).next())}))};const Te={jimuName:o.OutputDsAddress,alias:"ADDRESS",type:e.JimuFieldType.String,name:o.OutputDsAddress};class Me extends e.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.9.0",description:"For geocode service, use arrary of Schema to set displayFields",upgrader:e=>{var t,n;const l=null===(n=null===(t=null==e?void 0:e.asMutable({deep:!0}))||void 0===t?void 0:t.datasourceConfig)||void 0===n?void 0:n.map((e=>((null==e?void 0:e.searchServiceType)===o.SearchServiceType.FeatureService||(null==e?void 0:e.displayFields)||(e.displayFields=[Te],e.addressFields=[Te],e.defaultAddressFieldName=Te.jimuName),e)));return e.setIn(["datasourceConfig"],l)}},{version:"1.10.0",description:"For locator service, need to save support for suggest in config",upgrader:t=>Ce(this,void 0,void 0,(function*(){var n,l;const r=t=>Ce(this,void 0,void 0,(function*(){return e.UtilityManager.getInstance().getUrlOfUseUtility(t).then((e=>Promise.resolve(e)))})),s=null===(l=null===(n=null==t?void 0:t.asMutable({deep:!0}))||void 0===n?void 0:n.datasourceConfig)||void 0===l?void 0:l.map((t=>(null==t?void 0:t.searchServiceType)===o.SearchServiceType.FeatureService?Promise.resolve(t):r(null==t?void 0:t.useUtility).then((o=>(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[n]=e;return n(o,{query:{f:"json"},responseType:"json"}).then((e=>{var o;const n=(null==e?void 0:e.data)||{};if(null==n?void 0:n.capabilities){const e=(null===(o=null==n?void 0:n.capabilities)||void 0===o?void 0:o.split(","))||[],l=null==e?void 0:e.includes("Suggest");return t.isSupportSuggest=l,Promise.resolve(t)}return Promise.resolve(t)}))})))))),i=s?yield Promise.all(s):[];return t.setIn(["datasourceConfig"],i)}))}]}}const ke=new Me;var De=function(e,t,o,n){return new(o||(o=Promise))((function(l,r){function s(e){try{a(n.next(e))}catch(e){r(e)}}function i(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,i)}a((n=n.apply(e,t||[])).next())}))};const{useEffect:Pe,useState:Fe,useRef:Le}=e.React,Ee=o=>{const{config:n,id:l}=o,s=Le(null),[i,a]=Fe((0,e.Immutable)([])),[u,c]=Fe(!1);Pe((()=>{g()}),[n]);const d=e.css`
    & {
      height: ${e.polished.rem(32)};
      margin-top: 1px;
      margin-left: 1px;
    }
  `,v=e=>{e&&a(e)},g=()=>De(void 0,void 0,void 0,(function*(){const t=((null==n?void 0:n.datasourceConfig)||(0,e.Immutable)([])).map((e=>De(void 0,void 0,void 0,(function*(){let t=null==e?void 0:e.setIn(["enable"],!0);return(null==e?void 0:e.useUtility)&&(yield p(null==e?void 0:e.useUtility).then((e=>{t=t.setIn(["geocodeURL"],e)}))),Promise.resolve(null==t?void 0:t.asMutable({deep:!0}))}))));yield Promise.all(t).then((t=>{a((0,e.Immutable)(t))}))})),p=t=>De(void 0,void 0,void 0,(function*(){return e.UtilityManager.getInstance().getUrlOfUseUtility(t).then((e=>Promise.resolve(e)))})),m=()=>(null==n?void 0:n.arrangementStyle)===r.Style1||u,h=e=>{c(e)};return(0,e.jsx)(t.ViewVisibilityContext.Consumer,null,(({isInView:o,isInCurrentView:r})=>{const a=!o||r;return(0,e.jsx)(t.PageVisibilityContext.Consumer,null,(t=>{var o;return(0,e.jsx)("div",{className:"widget-search jimu-widget"},(0,e.jsx)("div",{className:"d-flex w-100 align-items-center",css:d,ref:s},(0,e.jsx)("div",null,(null===(o=null==n?void 0:n.datasourceConfig)||void 0===o?void 0:o.length)>1&&m()&&(0,e.jsx)(b,{className:"h-100",config:n,datasourceConfig:i,onDatasourceConfigChange:v})),(0,e.jsx)(Ne,{id:l,className:"flex-grow-1 h-100",reference:s,datasourceConfig:i,config:n,isShowSearchInput:m(),onShowSearchInputChange:h,isInCurrentView:a,isWidgetInCurrentPage:t}),(0,e.jsx)(Oe,{id:l,config:n})))}))}))};Ee.versionManager=ke;const Ae=Ee})(),c})())}}}));