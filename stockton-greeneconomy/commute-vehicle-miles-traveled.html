<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2.5 Commute Vehicle Miles Traveled | Green Economy Analysis: Opportunities for Stockton</title>
  <meta name="description" content="2.5 Commute Vehicle Miles Traveled | Green Economy Analysis: Opportunities for Stockton" />
  <meta name="generator" content="bookdown 0.17.2 and GitBook 2.6.7" />

  <meta property="og:title" content="2.5 Commute Vehicle Miles Traveled | Green Economy Analysis: Opportunities for Stockton" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2.5 Commute Vehicle Miles Traveled | Green Economy Analysis: Opportunities for Stockton" />
  
  
  

<meta name="author" content="City Systems" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="origin-destination-commute-analysis.html"/>
<link rel="next" href="non-commute-vehicle-miles-traveled.html"/>
<script src="libs/header-attrs-2.1/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan, pre.js');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
.row { display: flex; }
.collapse { display: none; }
.in { display:block }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>



<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://city.systems">City Systems</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="approach.html"><a href="approach.html"><i class="fa fa-check"></i><b>1.1</b> Approach</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="baseline-assessment.html"><a href="baseline-assessment.html"><i class="fa fa-check"></i><b>2</b> Baseline Assessment</a>
<ul>
<li class="chapter" data-level="2.1" data-path="population-and-jobs.html"><a href="population-and-jobs.html"><i class="fa fa-check"></i><b>2.1</b> Population and Jobs</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="population-and-jobs.html"><a href="population-and-jobs.html#county-level-analysis"><i class="fa fa-check"></i><b>2.1.1</b> County-level Analysis</a></li>
<li class="chapter" data-level="2.1.2" data-path="population-and-jobs.html"><a href="population-and-jobs.html#city-level-analysis"><i class="fa fa-check"></i><b>2.1.2</b> City-level Analysis</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="green-jobs.html"><a href="green-jobs.html"><i class="fa fa-check"></i><b>2.2</b> Green Jobs</a></li>
<li class="chapter" data-level="2.3" data-path="ghg-inventory.html"><a href="ghg-inventory.html"><i class="fa fa-check"></i><b>2.3</b> 2005-2016 GHG Inventory</a></li>
<li class="chapter" data-level="2.4" data-path="origin-destination-commute-analysis.html"><a href="origin-destination-commute-analysis.html"><i class="fa fa-check"></i><b>2.4</b> Origin-Destination Commute Analysis</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="origin-destination-commute-analysis.html"><a href="origin-destination-commute-analysis.html#county-level-analysis-1"><i class="fa fa-check"></i><b>2.4.1</b> County-level Analysis</a></li>
<li class="chapter" data-level="2.4.2" data-path="origin-destination-commute-analysis.html"><a href="origin-destination-commute-analysis.html#city-level-analysis-1"><i class="fa fa-check"></i><b>2.4.2</b> City-level Analysis</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="commute-vehicle-miles-traveled.html"><a href="commute-vehicle-miles-traveled.html"><i class="fa fa-check"></i><b>2.5</b> Commute Vehicle Miles Traveled</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="commute-vehicle-miles-traveled.html"><a href="commute-vehicle-miles-traveled.html#county-level-analysis-2"><i class="fa fa-check"></i><b>2.5.1</b> County-level Analysis</a></li>
<li class="chapter" data-level="2.5.2" data-path="commute-vehicle-miles-traveled.html"><a href="commute-vehicle-miles-traveled.html#city-level-analysis-2"><i class="fa fa-check"></i><b>2.5.2</b> City-level Analysis</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="non-commute-vehicle-miles-traveled.html"><a href="non-commute-vehicle-miles-traveled.html"><i class="fa fa-check"></i><b>2.6</b> Non-Commute Vehicle Miles Traveled</a></li>
<li class="chapter" data-level="2.7" data-path="vehicle-emissions.html"><a href="vehicle-emissions.html"><i class="fa fa-check"></i><b>2.7</b> Vehicle Emissions</a></li>
<li class="chapter" data-level="2.8" data-path="energy.html"><a href="energy.html"><i class="fa fa-check"></i><b>2.8</b> Energy</a></li>
<li class="chapter" data-level="2.9" data-path="buildings.html"><a href="buildings.html"><i class="fa fa-check"></i><b>2.9</b> Buildings</a></li>
<li class="chapter" data-level="2.10" data-path="ghg-forecast.html"><a href="ghg-forecast.html"><i class="fa fa-check"></i><b>2.10</b> GHG Forecast</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="overview-of-green-economy-strategies.html"><a href="overview-of-green-economy-strategies.html"><i class="fa fa-check"></i><b>3</b> Overview of Green Economy Strategies</a>
<ul>
<li class="chapter" data-level="3.1" data-path="building-utilization.html"><a href="building-utilization.html"><i class="fa fa-check"></i><b>3.1</b> Building Utilization</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="building-utilization.html"><a href="building-utilization.html#revise-zoning-codes-in-medium-to-large-cities-to-facilitate-upzoning"><i class="fa fa-check"></i><b>3.1.1</b> Revise zoning codes in medium to large cities to facilitate upzoning</a></li>
<li class="chapter" data-level="3.1.2" data-path="building-utilization.html"><a href="building-utilization.html#eliminate-minimum-parking"><i class="fa fa-check"></i><b>3.1.2</b> Eliminate minimum parking</a></li>
<li class="chapter" data-level="3.1.3" data-path="building-utilization.html"><a href="building-utilization.html#encourage-accessory-dwelling-units"><i class="fa fa-check"></i><b>3.1.3</b> Encourage accessory dwelling units</a></li>
<li class="chapter" data-level="3.1.4" data-path="building-utilization.html"><a href="building-utilization.html#encourage-micro-units"><i class="fa fa-check"></i><b>3.1.4</b> Encourage micro-units</a></li>
<li class="chapter" data-level="3.1.5" data-path="building-utilization.html"><a href="building-utilization.html#provide-a-density-bonus-for-affordable-housing"><i class="fa fa-check"></i><b>3.1.5</b> Provide a density bonus for affordable housing</a></li>
<li class="chapter" data-level="3.1.6" data-path="building-utilization.html"><a href="building-utilization.html#develop-a-shared-equity-program-for-high-density-housing"><i class="fa fa-check"></i><b>3.1.6</b> Develop a shared equity program for high-density housing</a></li>
<li class="chapter" data-level="3.1.7" data-path="building-utilization.html"><a href="building-utilization.html#match-homeowners-with-vacant-spaces-with-individuals-looking-for-affordable-housing"><i class="fa fa-check"></i><b>3.1.7</b> Match homeowners with vacant spaces with individuals looking for affordable housing</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="building-energy.html"><a href="building-energy.html"><i class="fa fa-check"></i><b>3.2</b> Building Energy</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="building-energy.html"><a href="building-energy.html#promote-solar-development-in-opportunity-zones"><i class="fa fa-check"></i><b>3.2.1</b> Promote solar development in Opportunity Zones</a></li>
<li class="chapter" data-level="3.2.2" data-path="building-energy.html"><a href="building-energy.html#promote-a-solar-renewable-energy-certificate-program"><i class="fa fa-check"></i><b>3.2.2</b> Promote a Solar Renewable Energy Certificate program</a></li>
<li class="chapter" data-level="3.2.3" data-path="building-energy.html"><a href="building-energy.html#set-energy-savings-standards-on-all-public-buildings-and-provide-financial-and-technical-assistance-for-commercial-private-sector-energy-savings"><i class="fa fa-check"></i><b>3.2.3</b> Set energy savings standards on all public buildings and provide financial and technical assistance for commercial private sector energy savings</a></li>
<li class="chapter" data-level="3.2.4" data-path="building-energy.html"><a href="building-energy.html#create-a-fund-to-implement-energy-savings-projects"><i class="fa fa-check"></i><b>3.2.4</b> Create a fund to implement energy savings projects</a></li>
<li class="chapter" data-level="3.2.5" data-path="building-energy.html"><a href="building-energy.html#enable-property-assessed-clean-energy-pace-financing"><i class="fa fa-check"></i><b>3.2.5</b> Enable property-assessed clean energy (PACE) financing</a></li>
<li class="chapter" data-level="3.2.6" data-path="building-energy.html"><a href="building-energy.html#provide-consumer-oriented-programs-to-incentivize-energy-efficiency-retrofits-and-appliance-improvements"><i class="fa fa-check"></i><b>3.2.6</b> Provide consumer-oriented programs to incentivize energy efficiency retrofits and appliance improvements</a></li>
<li class="chapter" data-level="3.2.7" data-path="building-energy.html"><a href="building-energy.html#provide-incentives-for-households-to-install-on-site-batteries-particularly-for-vulnerable-customers"><i class="fa fa-check"></i><b>3.2.7</b> Provide incentives for households to install on-site batteries, particularly for vulnerable customers</a></li>
<li class="chapter" data-level="3.2.8" data-path="building-energy.html"><a href="building-energy.html#implement-reach-codes-which-go-beyond-state-minimum-requirements-for-energy-use-in-building-design-and-construction"><i class="fa fa-check"></i><b>3.2.8</b> Implement “reach” codes which go beyond state minimum requirements for energy use in building design and construction</a></li>
<li class="chapter" data-level="3.2.9" data-path="building-energy.html"><a href="building-energy.html#use-waste-to-produce-electricity"><i class="fa fa-check"></i><b>3.2.9</b> Use waste to produce electricity</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="employment-growth.html"><a href="employment-growth.html"><i class="fa fa-check"></i><b>3.3</b> Employment Growth</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="employment-growth.html"><a href="employment-growth.html#provide-training-and-coaching-for-low-income-workers-rather-than-unemployed-workers"><i class="fa fa-check"></i><b>3.3.1</b> Provide training and coaching for low-income workers, rather than unemployed workers</a></li>
<li class="chapter" data-level="3.3.2" data-path="employment-growth.html"><a href="employment-growth.html#provide-green-oriented-job-training-and-education-pathways"><i class="fa fa-check"></i><b>3.3.2</b> Provide green-oriented job training and education pathways</a></li>
<li class="chapter" data-level="3.3.3" data-path="employment-growth.html"><a href="employment-growth.html#create-a-scholarship-fund-for-students-wishing-to-pursue-eco-conscious-careers"><i class="fa fa-check"></i><b>3.3.3</b> Create a scholarship fund for students wishing to pursue eco-conscious careers</a></li>
<li class="chapter" data-level="3.3.4" data-path="employment-growth.html"><a href="employment-growth.html#offer-continued-training-and-support-post-employment"><i class="fa fa-check"></i><b>3.3.4</b> Offer continued training and support post-employment</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="local-jobs.html"><a href="local-jobs.html"><i class="fa fa-check"></i><b>3.4</b> Local Jobs</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="local-jobs.html"><a href="local-jobs.html#offer-job-creation-tax-credit"><i class="fa fa-check"></i><b>3.4.1</b> Offer job creation tax credit</a></li>
<li class="chapter" data-level="3.4.2" data-path="local-jobs.html"><a href="local-jobs.html#encourage-mortgage-refinancing"><i class="fa fa-check"></i><b>3.4.2</b> Encourage mortgage refinancing</a></li>
<li class="chapter" data-level="3.4.3" data-path="local-jobs.html"><a href="local-jobs.html#develop-public-employment-program"><i class="fa fa-check"></i><b>3.4.3</b> Develop public employment program</a></li>
<li class="chapter" data-level="3.4.4" data-path="local-jobs.html"><a href="local-jobs.html#provide-tax-credits-to-investors-in-advanced-industries"><i class="fa fa-check"></i><b>3.4.4</b> Provide tax credits to investors in advanced industries</a></li>
<li class="chapter" data-level="3.4.5" data-path="local-jobs.html"><a href="local-jobs.html#provide-tax-credits-to-investors-in-community-development-corporations"><i class="fa fa-check"></i><b>3.4.5</b> Provide tax credits to investors in community development corporations</a></li>
<li class="chapter" data-level="3.4.6" data-path="local-jobs.html"><a href="local-jobs.html#pursue-public-private-partnerships-for-commercial-development"><i class="fa fa-check"></i><b>3.4.6</b> Pursue public-private partnerships for commercial development</a></li>
<li class="chapter" data-level="3.4.7" data-path="local-jobs.html"><a href="local-jobs.html#fund-economic-development-using-tax-base-sharing"><i class="fa fa-check"></i><b>3.4.7</b> Fund economic development using tax-base sharing</a></li>
<li class="chapter" data-level="3.4.8" data-path="local-jobs.html"><a href="local-jobs.html#pay-remote-workers-to-move-to-new-location"><i class="fa fa-check"></i><b>3.4.8</b> Pay remote workers to move to new location</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="vehicle-miles-traveled.html"><a href="vehicle-miles-traveled.html"><i class="fa fa-check"></i><b>3.5</b> Vehicle Miles Traveled</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="vehicle-miles-traveled.html"><a href="vehicle-miles-traveled.html#create-local-transportation-demand-management-ordinances"><i class="fa fa-check"></i><b>3.5.1</b> Create local transportation demand management ordinances</a></li>
<li class="chapter" data-level="3.5.2" data-path="vehicle-miles-traveled.html"><a href="vehicle-miles-traveled.html#redesign-bus-network-to-prioritize-ridership-over-coverage"><i class="fa fa-check"></i><b>3.5.2</b> Redesign bus network to prioritize ridership over coverage</a></li>
<li class="chapter" data-level="3.5.3" data-path="vehicle-miles-traveled.html"><a href="vehicle-miles-traveled.html#use-brt-corridors-to-reduce-travel-times-on-public-transit"><i class="fa fa-check"></i><b>3.5.3</b> Use BRT corridors to reduce travel times on public transit</a></li>
<li class="chapter" data-level="3.5.4" data-path="vehicle-miles-traveled.html"><a href="vehicle-miles-traveled.html#promote-the-use-of-e-scooters-and-dockless-bicycles-to-reduce-reliance-on-private-cars"><i class="fa fa-check"></i><b>3.5.4</b> Promote the use of e-scooters and dockless bicycles to reduce reliance on private cars</a></li>
<li class="chapter" data-level="3.5.5" data-path="vehicle-miles-traveled.html"><a href="vehicle-miles-traveled.html#rezone-areas-around-transit-stations-and-commercial-corridors-to-allow-for-high-density-residential-development"><i class="fa fa-check"></i><b>3.5.5</b> Rezone areas around transit stations and commercial corridors to allow for high-density residential development</a></li>
<li class="chapter" data-level="3.5.6" data-path="vehicle-miles-traveled.html"><a href="vehicle-miles-traveled.html#offset-negative-externalities-of-traffic-through-tolls"><i class="fa fa-check"></i><b>3.5.6</b> Offset negative externalities of traffic through tolls</a></li>
<li class="chapter" data-level="3.5.7" data-path="vehicle-miles-traveled.html"><a href="vehicle-miles-traveled.html#charge-for-parking"><i class="fa fa-check"></i><b>3.5.7</b> Charge for parking</a></li>
<li class="chapter" data-level="3.5.8" data-path="vehicle-miles-traveled.html"><a href="vehicle-miles-traveled.html#give-carpoolers-priority-parking-at-transit-stops"><i class="fa fa-check"></i><b>3.5.8</b> Give carpoolers priority parking at transit stops</a></li>
<li class="chapter" data-level="3.5.9" data-path="vehicle-miles-traveled.html"><a href="vehicle-miles-traveled.html#ban-personal-vehicles-from-certain-areas"><i class="fa fa-check"></i><b>3.5.9</b> Ban personal vehicles from certain areas</a></li>
<li class="chapter" data-level="3.5.10" data-path="vehicle-miles-traveled.html"><a href="vehicle-miles-traveled.html#encourage-carsharing-strategies"><i class="fa fa-check"></i><b>3.5.10</b> Encourage carsharing strategies</a></li>
<li class="chapter" data-level="3.5.11" data-path="vehicle-miles-traveled.html"><a href="vehicle-miles-traveled.html#provide-free-public-transit"><i class="fa fa-check"></i><b>3.5.11</b> Provide free public transit</a></li>
<li class="chapter" data-level="3.5.12" data-path="vehicle-miles-traveled.html"><a href="vehicle-miles-traveled.html#subsidize-first-milelast-mile-transportation-services"><i class="fa fa-check"></i><b>3.5.12</b> Subsidize first-mile/last-mile transportation services</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="vehicle-emissions-1.html"><a href="vehicle-emissions-1.html"><i class="fa fa-check"></i><b>3.6</b> Vehicle Emissions</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="vehicle-emissions-1.html"><a href="vehicle-emissions-1.html#provide-grants-for-pollutant-remediation-and-reduction-initiatives"><i class="fa fa-check"></i><b>3.6.1</b> Provide grants for pollutant remediation and reduction initiatives</a></li>
<li class="chapter" data-level="3.6.2" data-path="vehicle-emissions-1.html"><a href="vehicle-emissions-1.html#provide-commercial-rebates-for-commercial-building-owners-to-install-ev-charging-stations"><i class="fa fa-check"></i><b>3.6.2</b> Provide commercial rebates for commercial building owners to install EV charging stations</a></li>
<li class="chapter" data-level="3.6.3" data-path="vehicle-emissions-1.html"><a href="vehicle-emissions-1.html#provide-grants-to-income-eligible-residents-for-the-replacement-of-high-emission-cars-with-low-emission-cars"><i class="fa fa-check"></i><b>3.6.3</b> Provide grants to income eligible residents for the replacement of high-emission cars with low-emission cars</a></li>
<li class="chapter" data-level="3.6.4" data-path="vehicle-emissions-1.html"><a href="vehicle-emissions-1.html#engage-automobile-manufacturers-as-stakeholders-in-the-ev-market"><i class="fa fa-check"></i><b>3.6.4</b> Engage automobile manufacturers as stakeholders in the EV market</a></li>
<li class="chapter" data-level="3.6.5" data-path="vehicle-emissions-1.html"><a href="vehicle-emissions-1.html#reduce-vehicle-speed-limits"><i class="fa fa-check"></i><b>3.6.5</b> Reduce vehicle speed limits</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="resilience.html"><a href="resilience.html"><i class="fa fa-check"></i><b>3.7</b> Resilience</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="resilience.html"><a href="resilience.html#promote-cool-surfaces-to-reduce-heat-island-effect"><i class="fa fa-check"></i><b>3.7.1</b> Promote cool surfaces to reduce heat island effect</a></li>
<li class="chapter" data-level="3.7.2" data-path="resilience.html"><a href="resilience.html#promote-permeable-pavement-to-increase-groundwater-absorption"><i class="fa fa-check"></i><b>3.7.2</b> Promote permeable pavement to increase groundwater absorption</a></li>
<li class="chapter" data-level="3.7.3" data-path="resilience.html"><a href="resilience.html#reclaim-urban-streams-and-rivers-to-increase-groundwater-absorption-and-filtration"><i class="fa fa-check"></i><b>3.7.3</b> Reclaim urban streams and rivers to increase groundwater absorption and filtration</a></li>
<li class="chapter" data-level="3.7.4" data-path="resilience.html"><a href="resilience.html#use-green-infrastructure-to-improve-stormwater-management"><i class="fa fa-check"></i><b>3.7.4</b> Use green infrastructure to improve stormwater management</a></li>
<li class="chapter" data-level="3.7.5" data-path="resilience.html"><a href="resilience.html#promote-urban-gardens-as-a-substitute-for-displaced-ecosystem-services"><i class="fa fa-check"></i><b>3.7.5</b> Promote urban gardens as a substitute for displaced ecosystem services</a></li>
<li class="chapter" data-level="3.7.6" data-path="resilience.html"><a href="resilience.html#offer-rebates-for-flood-mitigation-projects"><i class="fa fa-check"></i><b>3.7.6</b> Offer rebates for flood mitigation projects</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="resource-management.html"><a href="resource-management.html"><i class="fa fa-check"></i><b>3.8</b> Resource Management</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="resource-management.html"><a href="resource-management.html#develop-carbon-capture-storage-facilities"><i class="fa fa-check"></i><b>3.8.1</b> Develop carbon capture &amp; storage facilities</a></li>
<li class="chapter" data-level="3.8.2" data-path="resource-management.html"><a href="resource-management.html#develop-pneumatic-waste-collection-systems"><i class="fa fa-check"></i><b>3.8.2</b> Develop pneumatic waste collection systems</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="analysis-of-green-economy-strategies.html"><a href="analysis-of-green-economy-strategies.html"><i class="fa fa-check"></i><b>4</b> Analysis of Green Economy Strategies</a>
<ul>
<li class="chapter" data-level="4.1" data-path="methodology.html"><a href="methodology.html"><i class="fa fa-check"></i><b>4.1</b> Methodology</a></li>
<li class="chapter" data-level="4.2" data-path="building-utilization-1.html"><a href="building-utilization-1.html"><i class="fa fa-check"></i><b>4.2</b> Building Utilization</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="building-utilization-1.html"><a href="building-utilization-1.html#strategy-accessory-dwelling-units"><i class="fa fa-check"></i><b>4.2.1</b> Strategy: Accessory Dwelling Units</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="building-energy-1.html"><a href="building-energy-1.html"><i class="fa fa-check"></i><b>4.3</b> Building Energy</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="building-energy-1.html"><a href="building-energy-1.html#strategy-electrification"><i class="fa fa-check"></i><b>4.3.1</b> Strategy: Electrification</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="vehicle-emissions-2.html"><a href="vehicle-emissions-2.html"><i class="fa fa-check"></i><b>4.4</b> Vehicle Emissions</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="vehicle-emissions-2.html"><a href="vehicle-emissions-2.html#strategy-electric-vehicle-program"><i class="fa fa-check"></i><b>4.4.1</b> Strategy: Electric Vehicle Program</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>5</b> Conclusion</a></li>
<li class="chapter" data-level="6" data-path="appendix-a-index-of-case-studies-by-place.html"><a href="appendix-a-index-of-case-studies-by-place.html"><i class="fa fa-check"></i><b>6</b> Appendix A: Index of Case Studies by Place</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Green Economy Analysis: Opportunities for Stockton</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="commute-vehicle-miles-traveled" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Commute Vehicle Miles Traveled</h2>
<p>Building off the Origin-Destination Commute Analysis from the previous section, we isolated every unique pair of SJC or Stockton home block groups and work block groups and used the <a href="http://project-osrm.org/">Open Source Routing Machine</a> to compute a distance (in miles) and duration (and hours) for a one-way trip. Using this analysis, combined with some estimates of mode choice (single-occupancy vehicle vs. carpool vs. other), we created estimates of vehicle miles traveled for a certain number of jobs and were able to see how see how SJC and Stockton residents have changed their driving behavior over time, and how that behavior has compared to neighboring counties. Finally, we used VMT to estimate the GHG footprint of commuting for Stockton residents.</p>
<p>Our analysis in this section focuses on destinations with average commute times of less than 3 hours, which eliminates the unrealistic commutes while preserving more than 90% of reported commutes. We suspect that many of the other commutes with purported destinations like Los Angeles County are erroneously reported, and the actual workplace location is unavailable to us. Note, however, that it could be true that some workers commute to southern California, though not every weekday, and it also could be true to some workers commute by flight, which presents its own distinct and potentially significant GHG analysis which is outside the scope of this report.</p>
<div id="county-level-analysis-2" class="section level3" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> County-level Analysis</h3>
<p>The following table shows commute data for SJC residents from 2011 to 2017, including estimates of the number of total jobs held by residents, the number of those jobs that are car-dependent, and the number of those jobs that are carpooled (according to ACS). The routing analysis provides distances between each origin and destination, which are totaled up to person miles traveled. The conversion to vehicle miles traveled is based on the following assumptions:</p>
<ul>
<li>For each origin-destination block group pair, we used ACS 1-yr 2017 data on commute mode by travel time for the origin block group to estimate a share of travelers commuting by single occupancy vehicle and by carpooling, and applied this factor to the count of jobs from LODES to estimate a total number of vehicle trips and vehicle mildes traveled (VMT).</li>
<li>For carpool trips, we counted 2-person carpools as 1 vehicle for every 2 jobs, and 3-or-more-person carpools as 1 vehicle for every 3 jobs.</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="commute-vehicle-miles-traveled.html#cb32-1"></a><span class="co"># for(year in 2011:2017){</span></span>
<span id="cb32-2"><a href="commute-vehicle-miles-traveled.html#cb32-2"></a><span class="co">#   for(county in c(&quot;013&quot;)){</span></span>
<span id="cb32-3"><a href="commute-vehicle-miles-traveled.html#cb32-3"></a><span class="co"># </span></span>
<span id="cb32-4"><a href="commute-vehicle-miles-traveled.html#cb32-4"></a><span class="co">#     print(paste0(county,&quot;-&quot;,year))</span></span>
<span id="cb32-5"><a href="commute-vehicle-miles-traveled.html#cb32-5"></a><span class="co"># </span></span>
<span id="cb32-6"><a href="commute-vehicle-miles-traveled.html#cb32-6"></a><span class="co">#     ca_lodes &lt;-</span></span>
<span id="cb32-7"><a href="commute-vehicle-miles-traveled.html#cb32-7"></a><span class="co">#       grab_lodes(</span></span>
<span id="cb32-8"><a href="commute-vehicle-miles-traveled.html#cb32-8"></a><span class="co">#         state = &quot;ca&quot;,</span></span>
<span id="cb32-9"><a href="commute-vehicle-miles-traveled.html#cb32-9"></a><span class="co">#         year = year,</span></span>
<span id="cb32-10"><a href="commute-vehicle-miles-traveled.html#cb32-10"></a><span class="co">#         lodes_type = &quot;od&quot;,</span></span>
<span id="cb32-11"><a href="commute-vehicle-miles-traveled.html#cb32-11"></a><span class="co">#         job_type = &quot;JT01&quot;, #Primary Jobs</span></span>
<span id="cb32-12"><a href="commute-vehicle-miles-traveled.html#cb32-12"></a><span class="co">#         segment = &quot;S000&quot;,</span></span>
<span id="cb32-13"><a href="commute-vehicle-miles-traveled.html#cb32-13"></a><span class="co">#         state_part = &quot;main&quot;,</span></span>
<span id="cb32-14"><a href="commute-vehicle-miles-traveled.html#cb32-14"></a><span class="co">#         agg_geo = &quot;tract&quot;</span></span>
<span id="cb32-15"><a href="commute-vehicle-miles-traveled.html#cb32-15"></a><span class="co">#       )</span></span>
<span id="cb32-16"><a href="commute-vehicle-miles-traveled.html#cb32-16"></a><span class="co">#     </span></span>
<span id="cb32-17"><a href="commute-vehicle-miles-traveled.html#cb32-17"></a><span class="co">#     save(ca_lodes, file = paste0(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/ca_lodes_&quot;,year,&quot;_tract.Rdata&quot;))</span></span>
<span id="cb32-18"><a href="commute-vehicle-miles-traveled.html#cb32-18"></a><span class="co"># </span></span>
<span id="cb32-19"><a href="commute-vehicle-miles-traveled.html#cb32-19"></a><span class="co">#     county_tracts &lt;-</span></span>
<span id="cb32-20"><a href="commute-vehicle-miles-traveled.html#cb32-20"></a><span class="co">#       ca_tracts %&gt;%</span></span>
<span id="cb32-21"><a href="commute-vehicle-miles-traveled.html#cb32-21"></a><span class="co">#       filter(COUNTYFP == county)</span></span>
<span id="cb32-22"><a href="commute-vehicle-miles-traveled.html#cb32-22"></a><span class="co"># </span></span>
<span id="cb32-23"><a href="commute-vehicle-miles-traveled.html#cb32-23"></a><span class="co">#     county_lodes_h &lt;-</span></span>
<span id="cb32-24"><a href="commute-vehicle-miles-traveled.html#cb32-24"></a><span class="co">#       ca_lodes[which(ca_lodes$h_tract %in% county_tracts$GEOID),]</span></span>
<span id="cb32-25"><a href="commute-vehicle-miles-traveled.html#cb32-25"></a><span class="co"># </span></span>
<span id="cb32-26"><a href="commute-vehicle-miles-traveled.html#cb32-26"></a><span class="co">#     county_lodes_h_origin_centroids &lt;-</span></span>
<span id="cb32-27"><a href="commute-vehicle-miles-traveled.html#cb32-27"></a><span class="co">#       st_centroid(ca_tracts[which(ca_tracts$GEOID %in% county_lodes_h$h_tract),])</span></span>
<span id="cb32-28"><a href="commute-vehicle-miles-traveled.html#cb32-28"></a><span class="co"># </span></span>
<span id="cb32-29"><a href="commute-vehicle-miles-traveled.html#cb32-29"></a><span class="co">#     county_lodes_h_dest_centroids &lt;-</span></span>
<span id="cb32-30"><a href="commute-vehicle-miles-traveled.html#cb32-30"></a><span class="co">#       st_centroid(ca_tracts[which(ca_tracts$GEOID %in% county_lodes_h$w_tract),])</span></span>
<span id="cb32-31"><a href="commute-vehicle-miles-traveled.html#cb32-31"></a><span class="co"># </span></span>
<span id="cb32-32"><a href="commute-vehicle-miles-traveled.html#cb32-32"></a><span class="co">#     route &lt;-</span></span>
<span id="cb32-33"><a href="commute-vehicle-miles-traveled.html#cb32-33"></a><span class="co">#       1:nrow(county_lodes_h) %&gt;%</span></span>
<span id="cb32-34"><a href="commute-vehicle-miles-traveled.html#cb32-34"></a><span class="co">#       map_dfr(function(row){</span></span>
<span id="cb32-35"><a href="commute-vehicle-miles-traveled.html#cb32-35"></a><span class="co">#         print(row)</span></span>
<span id="cb32-36"><a href="commute-vehicle-miles-traveled.html#cb32-36"></a><span class="co">#         route &lt;- osrmRoute(</span></span>
<span id="cb32-37"><a href="commute-vehicle-miles-traveled.html#cb32-37"></a><span class="co">#           src = county_lodes_h_origin_centroids[which(county_lodes_h_origin_centroids$GEOID %in% county_lodes_h[row,&quot;h_tract&quot;]),],</span></span>
<span id="cb32-38"><a href="commute-vehicle-miles-traveled.html#cb32-38"></a><span class="co">#           dst = county_lodes_h_dest_centroids[which(county_lodes_h_dest_centroids$GEOID %in% county_lodes_h[row,&quot;w_tract&quot;]),],</span></span>
<span id="cb32-39"><a href="commute-vehicle-miles-traveled.html#cb32-39"></a><span class="co">#           overview = FALSE</span></span>
<span id="cb32-40"><a href="commute-vehicle-miles-traveled.html#cb32-40"></a><span class="co">#         ) %&gt;%</span></span>
<span id="cb32-41"><a href="commute-vehicle-miles-traveled.html#cb32-41"></a><span class="co">#           as.list() %&gt;%</span></span>
<span id="cb32-42"><a href="commute-vehicle-miles-traveled.html#cb32-42"></a><span class="co">#           as.data.frame()</span></span>
<span id="cb32-43"><a href="commute-vehicle-miles-traveled.html#cb32-43"></a><span class="co">#         if(is_empty(route)){</span></span>
<span id="cb32-44"><a href="commute-vehicle-miles-traveled.html#cb32-44"></a><span class="co">#           return(</span></span>
<span id="cb32-45"><a href="commute-vehicle-miles-traveled.html#cb32-45"></a><span class="co">#             data.frame(</span></span>
<span id="cb32-46"><a href="commute-vehicle-miles-traveled.html#cb32-46"></a><span class="co">#               duration = NA,</span></span>
<span id="cb32-47"><a href="commute-vehicle-miles-traveled.html#cb32-47"></a><span class="co">#               distance = NA</span></span>
<span id="cb32-48"><a href="commute-vehicle-miles-traveled.html#cb32-48"></a><span class="co">#             )</span></span>
<span id="cb32-49"><a href="commute-vehicle-miles-traveled.html#cb32-49"></a><span class="co">#           )</span></span>
<span id="cb32-50"><a href="commute-vehicle-miles-traveled.html#cb32-50"></a><span class="co">#         } else {return(route)}</span></span>
<span id="cb32-51"><a href="commute-vehicle-miles-traveled.html#cb32-51"></a><span class="co">#       })</span></span>
<span id="cb32-52"><a href="commute-vehicle-miles-traveled.html#cb32-52"></a><span class="co"># </span></span>
<span id="cb32-53"><a href="commute-vehicle-miles-traveled.html#cb32-53"></a><span class="co">#     county_lodes_h_route &lt;-</span></span>
<span id="cb32-54"><a href="commute-vehicle-miles-traveled.html#cb32-54"></a><span class="co">#       county_lodes_h %&gt;%</span></span>
<span id="cb32-55"><a href="commute-vehicle-miles-traveled.html#cb32-55"></a><span class="co">#       cbind(route)</span></span>
<span id="cb32-56"><a href="commute-vehicle-miles-traveled.html#cb32-56"></a><span class="co"># </span></span>
<span id="cb32-57"><a href="commute-vehicle-miles-traveled.html#cb32-57"></a><span class="co">#     county_lodes_h_filter &lt;-</span></span>
<span id="cb32-58"><a href="commute-vehicle-miles-traveled.html#cb32-58"></a><span class="co">#       county_lodes_h_route %&gt;%</span></span>
<span id="cb32-59"><a href="commute-vehicle-miles-traveled.html#cb32-59"></a><span class="co">#       filter(duration &lt; 180)</span></span>
<span id="cb32-60"><a href="commute-vehicle-miles-traveled.html#cb32-60"></a><span class="co"># </span></span>
<span id="cb32-61"><a href="commute-vehicle-miles-traveled.html#cb32-61"></a><span class="co">#     save(county_lodes_h_route,county_lodes_h_filter, file = paste0(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/county_lodes_&quot;,county,&quot;_&quot;,year,&quot;_tract.Rdata&quot;))</span></span>
<span id="cb32-62"><a href="commute-vehicle-miles-traveled.html#cb32-62"></a><span class="co">#   }</span></span>
<span id="cb32-63"><a href="commute-vehicle-miles-traveled.html#cb32-63"></a><span class="co"># }</span></span>
<span id="cb32-64"><a href="commute-vehicle-miles-traveled.html#cb32-64"></a></span>
<span id="cb32-65"><a href="commute-vehicle-miles-traveled.html#cb32-65"></a><span class="co"># county_commute_vmt_tractmode &lt;- NULL</span></span>
<span id="cb32-66"><a href="commute-vehicle-miles-traveled.html#cb32-66"></a><span class="co"># </span></span>
<span id="cb32-67"><a href="commute-vehicle-miles-traveled.html#cb32-67"></a><span class="co"># for(year in 2011:2017){</span></span>
<span id="cb32-68"><a href="commute-vehicle-miles-traveled.html#cb32-68"></a><span class="co">#   for(county in c(&quot;013&quot;)){</span></span>
<span id="cb32-69"><a href="commute-vehicle-miles-traveled.html#cb32-69"></a><span class="co">#     print(paste0(year,&quot;-&quot;,county))</span></span>
<span id="cb32-70"><a href="commute-vehicle-miles-traveled.html#cb32-70"></a><span class="co"># </span></span>
<span id="cb32-71"><a href="commute-vehicle-miles-traveled.html#cb32-71"></a><span class="co">#     load(paste0(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/county_lodes_&quot;,county,&quot;_&quot;,year,&quot;_tract.Rdata&quot;))</span></span>
<span id="cb32-72"><a href="commute-vehicle-miles-traveled.html#cb32-72"></a><span class="co"># </span></span>
<span id="cb32-73"><a href="commute-vehicle-miles-traveled.html#cb32-73"></a><span class="co">#     load(paste0(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/acs5_vars_&quot;,year,&quot;.Rdata&quot;))</span></span>
<span id="cb32-74"><a href="commute-vehicle-miles-traveled.html#cb32-74"></a><span class="co"># </span></span>
<span id="cb32-75"><a href="commute-vehicle-miles-traveled.html#cb32-75"></a><span class="co">#     travel_time_mode &lt;-</span></span>
<span id="cb32-76"><a href="commute-vehicle-miles-traveled.html#cb32-76"></a><span class="co">#       getCensus(</span></span>
<span id="cb32-77"><a href="commute-vehicle-miles-traveled.html#cb32-77"></a><span class="co">#         name = &quot;acs/acs5&quot;,</span></span>
<span id="cb32-78"><a href="commute-vehicle-miles-traveled.html#cb32-78"></a><span class="co">#         vintage = year,</span></span>
<span id="cb32-79"><a href="commute-vehicle-miles-traveled.html#cb32-79"></a><span class="co">#         region = &quot;tract:*&quot;,</span></span>
<span id="cb32-80"><a href="commute-vehicle-miles-traveled.html#cb32-80"></a><span class="co">#         regionin = paste0(&quot;state:06+county:&quot;,county),</span></span>
<span id="cb32-81"><a href="commute-vehicle-miles-traveled.html#cb32-81"></a><span class="co">#         vars = &quot;group(B08134)&quot;</span></span>
<span id="cb32-82"><a href="commute-vehicle-miles-traveled.html#cb32-82"></a><span class="co">#       ) %&gt;%</span></span>
<span id="cb32-83"><a href="commute-vehicle-miles-traveled.html#cb32-83"></a><span class="co">#       mutate(tract = paste0(state,county,tract)) %&gt;%</span></span>
<span id="cb32-84"><a href="commute-vehicle-miles-traveled.html#cb32-84"></a><span class="co">#       select_if(!names(.) %in% c(&quot;GEO_ID&quot;,&quot;state&quot;,&quot;county&quot;,&quot;NAME&quot;)) %&gt;%</span></span>
<span id="cb32-85"><a href="commute-vehicle-miles-traveled.html#cb32-85"></a><span class="co">#       dplyr::select(-c(contains(&quot;EA&quot;),contains(&quot;MA&quot;),contains(&quot;M&quot;))) %&gt;%</span></span>
<span id="cb32-86"><a href="commute-vehicle-miles-traveled.html#cb32-86"></a><span class="co">#       gather(</span></span>
<span id="cb32-87"><a href="commute-vehicle-miles-traveled.html#cb32-87"></a><span class="co">#         key = &quot;variable&quot;,</span></span>
<span id="cb32-88"><a href="commute-vehicle-miles-traveled.html#cb32-88"></a><span class="co">#         value = &quot;estimate&quot;,</span></span>
<span id="cb32-89"><a href="commute-vehicle-miles-traveled.html#cb32-89"></a><span class="co">#         -tract</span></span>
<span id="cb32-90"><a href="commute-vehicle-miles-traveled.html#cb32-90"></a><span class="co">#       ) %&gt;%</span></span>
<span id="cb32-91"><a href="commute-vehicle-miles-traveled.html#cb32-91"></a><span class="co">#       mutate(</span></span>
<span id="cb32-92"><a href="commute-vehicle-miles-traveled.html#cb32-92"></a><span class="co">#         label = acs_vars$label[match(variable,acs_vars$name)],</span></span>
<span id="cb32-93"><a href="commute-vehicle-miles-traveled.html#cb32-93"></a><span class="co">#         time = # This extracts only the time information from our label.</span></span>
<span id="cb32-94"><a href="commute-vehicle-miles-traveled.html#cb32-94"></a><span class="co">#           substr(</span></span>
<span id="cb32-95"><a href="commute-vehicle-miles-traveled.html#cb32-95"></a><span class="co">#             label,</span></span>
<span id="cb32-96"><a href="commute-vehicle-miles-traveled.html#cb32-96"></a><span class="co">#             lapply(</span></span>
<span id="cb32-97"><a href="commute-vehicle-miles-traveled.html#cb32-97"></a><span class="co">#               label,</span></span>
<span id="cb32-98"><a href="commute-vehicle-miles-traveled.html#cb32-98"></a><span class="co">#               function(x){</span></span>
<span id="cb32-99"><a href="commute-vehicle-miles-traveled.html#cb32-99"></a><span class="co">#                 ifelse(</span></span>
<span id="cb32-100"><a href="commute-vehicle-miles-traveled.html#cb32-100"></a><span class="co">#                   length(unlist(gregexpr(&#39;!!&#39;,x)))&lt;3,</span></span>
<span id="cb32-101"><a href="commute-vehicle-miles-traveled.html#cb32-101"></a><span class="co">#                   NA,</span></span>
<span id="cb32-102"><a href="commute-vehicle-miles-traveled.html#cb32-102"></a><span class="co">#                   max(unlist(gregexpr(&#39;!!&#39;,x)))+2</span></span>
<span id="cb32-103"><a href="commute-vehicle-miles-traveled.html#cb32-103"></a><span class="co">#                 )</span></span>
<span id="cb32-104"><a href="commute-vehicle-miles-traveled.html#cb32-104"></a><span class="co">#               }</span></span>
<span id="cb32-105"><a href="commute-vehicle-miles-traveled.html#cb32-105"></a><span class="co">#             ),</span></span>
<span id="cb32-106"><a href="commute-vehicle-miles-traveled.html#cb32-106"></a><span class="co">#             nchar(label)</span></span>
<span id="cb32-107"><a href="commute-vehicle-miles-traveled.html#cb32-107"></a><span class="co">#           ),</span></span>
<span id="cb32-108"><a href="commute-vehicle-miles-traveled.html#cb32-108"></a><span class="co">#         mode = # This extracts only the mode information from our label. It doesn&#39;t fully deal with double-counting, so some are further removed later on in a filter.</span></span>
<span id="cb32-109"><a href="commute-vehicle-miles-traveled.html#cb32-109"></a><span class="co">#           substr(</span></span>
<span id="cb32-110"><a href="commute-vehicle-miles-traveled.html#cb32-110"></a><span class="co">#             label,</span></span>
<span id="cb32-111"><a href="commute-vehicle-miles-traveled.html#cb32-111"></a><span class="co">#             lapply(</span></span>
<span id="cb32-112"><a href="commute-vehicle-miles-traveled.html#cb32-112"></a><span class="co">#               label,</span></span>
<span id="cb32-113"><a href="commute-vehicle-miles-traveled.html#cb32-113"></a><span class="co">#               function(x){</span></span>
<span id="cb32-114"><a href="commute-vehicle-miles-traveled.html#cb32-114"></a><span class="co">#                 ifelse(</span></span>
<span id="cb32-115"><a href="commute-vehicle-miles-traveled.html#cb32-115"></a><span class="co">#                   length(unlist(gregexpr(&#39;!!&#39;,x)))&lt;3,</span></span>
<span id="cb32-116"><a href="commute-vehicle-miles-traveled.html#cb32-116"></a><span class="co">#                   NA,</span></span>
<span id="cb32-117"><a href="commute-vehicle-miles-traveled.html#cb32-117"></a><span class="co">#                   unlist(gregexpr(&#39;!!&#39;,x))[length(unlist(gregexpr(&#39;!!&#39;,x)))-1]+2</span></span>
<span id="cb32-118"><a href="commute-vehicle-miles-traveled.html#cb32-118"></a><span class="co">#                 )</span></span>
<span id="cb32-119"><a href="commute-vehicle-miles-traveled.html#cb32-119"></a><span class="co">#               }</span></span>
<span id="cb32-120"><a href="commute-vehicle-miles-traveled.html#cb32-120"></a><span class="co">#             ),</span></span>
<span id="cb32-121"><a href="commute-vehicle-miles-traveled.html#cb32-121"></a><span class="co">#             lapply(</span></span>
<span id="cb32-122"><a href="commute-vehicle-miles-traveled.html#cb32-122"></a><span class="co">#               label,</span></span>
<span id="cb32-123"><a href="commute-vehicle-miles-traveled.html#cb32-123"></a><span class="co">#               function(x){</span></span>
<span id="cb32-124"><a href="commute-vehicle-miles-traveled.html#cb32-124"></a><span class="co">#                 max(unlist(gregexpr(&#39;!!&#39;,x)))-1</span></span>
<span id="cb32-125"><a href="commute-vehicle-miles-traveled.html#cb32-125"></a><span class="co">#               }</span></span>
<span id="cb32-126"><a href="commute-vehicle-miles-traveled.html#cb32-126"></a><span class="co">#             )</span></span>
<span id="cb32-127"><a href="commute-vehicle-miles-traveled.html#cb32-127"></a><span class="co">#           )</span></span>
<span id="cb32-128"><a href="commute-vehicle-miles-traveled.html#cb32-128"></a><span class="co">#       ) %&gt;%</span></span>
<span id="cb32-129"><a href="commute-vehicle-miles-traveled.html#cb32-129"></a><span class="co">#       filter(!is.na(time)) %&gt;% # This removes the grand total rows that are usually at the top of the ACS data.</span></span>
<span id="cb32-130"><a href="commute-vehicle-miles-traveled.html#cb32-130"></a><span class="co">#       filter(!mode %in% c(&quot;Car, truck, or van&quot;,&quot;Car truck or van&quot;,&quot;Carpooled&quot;,&quot;Public transportation (excluding taxicab)&quot;)) %&gt;% # This removes double-counted subtotals.</span></span>
<span id="cb32-131"><a href="commute-vehicle-miles-traveled.html#cb32-131"></a><span class="co">#       dplyr::select(-variable,-label)</span></span>
<span id="cb32-132"><a href="commute-vehicle-miles-traveled.html#cb32-132"></a><span class="co"># </span></span>
<span id="cb32-133"><a href="commute-vehicle-miles-traveled.html#cb32-133"></a><span class="co">#     travel_time_mode_summary &lt;-</span></span>
<span id="cb32-134"><a href="commute-vehicle-miles-traveled.html#cb32-134"></a><span class="co">#       travel_time_mode %&gt;%</span></span>
<span id="cb32-135"><a href="commute-vehicle-miles-traveled.html#cb32-135"></a><span class="co">#       group_by(tract,time) %&gt;%</span></span>
<span id="cb32-136"><a href="commute-vehicle-miles-traveled.html#cb32-136"></a><span class="co">#       summarize(</span></span>
<span id="cb32-137"><a href="commute-vehicle-miles-traveled.html#cb32-137"></a><span class="co">#         jobs = sum(estimate),</span></span>
<span id="cb32-138"><a href="commute-vehicle-miles-traveled.html#cb32-138"></a><span class="co">#         jobs_drovealone = sum(estimate[which(mode == &quot;Drove alone&quot;)]),</span></span>
<span id="cb32-139"><a href="commute-vehicle-miles-traveled.html#cb32-139"></a><span class="co">#         jobs_carpool2 = sum(estimate[which(mode == &quot;In 2-person carpool&quot;)]),</span></span>
<span id="cb32-140"><a href="commute-vehicle-miles-traveled.html#cb32-140"></a><span class="co">#         jobs_carpool3 = sum(estimate[which(mode == &quot;In 3-or-more-person carpool&quot;)]),</span></span>
<span id="cb32-141"><a href="commute-vehicle-miles-traveled.html#cb32-141"></a><span class="co">#       ) %&gt;%</span></span>
<span id="cb32-142"><a href="commute-vehicle-miles-traveled.html#cb32-142"></a><span class="co">#       mutate(</span></span>
<span id="cb32-143"><a href="commute-vehicle-miles-traveled.html#cb32-143"></a><span class="co">#         vehicles_drovealone = jobs_drovealone,</span></span>
<span id="cb32-144"><a href="commute-vehicle-miles-traveled.html#cb32-144"></a><span class="co">#         vehicles_carpool2 = jobs_carpool2/2,</span></span>
<span id="cb32-145"><a href="commute-vehicle-miles-traveled.html#cb32-145"></a><span class="co">#         vehicles_carpool3 = jobs_carpool3/3,</span></span>
<span id="cb32-146"><a href="commute-vehicle-miles-traveled.html#cb32-146"></a><span class="co">#         jobs_car = jobs_drovealone+jobs_carpool2+jobs_carpool3,</span></span>
<span id="cb32-147"><a href="commute-vehicle-miles-traveled.html#cb32-147"></a><span class="co">#         jobs_carpool = jobs_carpool2+jobs_carpool3,</span></span>
<span id="cb32-148"><a href="commute-vehicle-miles-traveled.html#cb32-148"></a><span class="co">#         vehicles = vehicles_drovealone,vehicles_carpool2,vehicles_carpool3,</span></span>
<span id="cb32-149"><a href="commute-vehicle-miles-traveled.html#cb32-149"></a><span class="co">#         perc_jobs_car = jobs_car/jobs,</span></span>
<span id="cb32-150"><a href="commute-vehicle-miles-traveled.html#cb32-150"></a><span class="co">#         perc_jobs_carpool = jobs_carpool/jobs,</span></span>
<span id="cb32-151"><a href="commute-vehicle-miles-traveled.html#cb32-151"></a><span class="co">#         perc_vehicle = vehicles/jobs</span></span>
<span id="cb32-152"><a href="commute-vehicle-miles-traveled.html#cb32-152"></a><span class="co">#       )</span></span>
<span id="cb32-153"><a href="commute-vehicle-miles-traveled.html#cb32-153"></a><span class="co"># </span></span>
<span id="cb32-154"><a href="commute-vehicle-miles-traveled.html#cb32-154"></a><span class="co">#   county_lodes_h_mode &lt;-</span></span>
<span id="cb32-155"><a href="commute-vehicle-miles-traveled.html#cb32-155"></a><span class="co">#     county_lodes_h_filter %&gt;%</span></span>
<span id="cb32-156"><a href="commute-vehicle-miles-traveled.html#cb32-156"></a><span class="co">#     transmute(</span></span>
<span id="cb32-157"><a href="commute-vehicle-miles-traveled.html#cb32-157"></a><span class="co">#       residence = h_tract,</span></span>
<span id="cb32-158"><a href="commute-vehicle-miles-traveled.html#cb32-158"></a><span class="co">#       jobs = S000,</span></span>
<span id="cb32-159"><a href="commute-vehicle-miles-traveled.html#cb32-159"></a><span class="co">#       duration = duration,</span></span>
<span id="cb32-160"><a href="commute-vehicle-miles-traveled.html#cb32-160"></a><span class="co">#       person_miles = S000*as.numeric(distance)/1.60934,</span></span>
<span id="cb32-161"><a href="commute-vehicle-miles-traveled.html#cb32-161"></a><span class="co">#       person_hours = S000*as.numeric(duration)/60</span></span>
<span id="cb32-162"><a href="commute-vehicle-miles-traveled.html#cb32-162"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb32-163"><a href="commute-vehicle-miles-traveled.html#cb32-163"></a><span class="co">#     mutate(</span></span>
<span id="cb32-164"><a href="commute-vehicle-miles-traveled.html#cb32-164"></a><span class="co">#       tier =</span></span>
<span id="cb32-165"><a href="commute-vehicle-miles-traveled.html#cb32-165"></a><span class="co">#         case_when(</span></span>
<span id="cb32-166"><a href="commute-vehicle-miles-traveled.html#cb32-166"></a><span class="co">#           duration &lt; 10 ~ &quot;Less than 10 minutes&quot;,</span></span>
<span id="cb32-167"><a href="commute-vehicle-miles-traveled.html#cb32-167"></a><span class="co">#           duration &lt; 15 ~ &quot;10 to 14 minutes&quot;,</span></span>
<span id="cb32-168"><a href="commute-vehicle-miles-traveled.html#cb32-168"></a><span class="co">#           duration &lt; 20 ~ &quot;15 to 19 minutes&quot;,</span></span>
<span id="cb32-169"><a href="commute-vehicle-miles-traveled.html#cb32-169"></a><span class="co">#           duration &lt; 25 ~ &quot;20 to 24 minutes&quot;,</span></span>
<span id="cb32-170"><a href="commute-vehicle-miles-traveled.html#cb32-170"></a><span class="co">#           duration &lt; 30 ~ &quot;25 to 29 minutes&quot;,</span></span>
<span id="cb32-171"><a href="commute-vehicle-miles-traveled.html#cb32-171"></a><span class="co">#           duration &lt; 35 ~ &quot;30 to 34 minutes&quot;,</span></span>
<span id="cb32-172"><a href="commute-vehicle-miles-traveled.html#cb32-172"></a><span class="co">#           duration &lt; 45 ~ &quot;35 to 44 minutes&quot;,</span></span>
<span id="cb32-173"><a href="commute-vehicle-miles-traveled.html#cb32-173"></a><span class="co">#           duration &lt; 60 ~ &quot;45 to 59 minutes&quot;,</span></span>
<span id="cb32-174"><a href="commute-vehicle-miles-traveled.html#cb32-174"></a><span class="co">#           TRUE ~ &quot;60 or more minutes&quot;</span></span>
<span id="cb32-175"><a href="commute-vehicle-miles-traveled.html#cb32-175"></a><span class="co">#         )</span></span>
<span id="cb32-176"><a href="commute-vehicle-miles-traveled.html#cb32-176"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb32-177"><a href="commute-vehicle-miles-traveled.html#cb32-177"></a><span class="co">#     left_join(</span></span>
<span id="cb32-178"><a href="commute-vehicle-miles-traveled.html#cb32-178"></a><span class="co">#       travel_time_mode_summary %&gt;%</span></span>
<span id="cb32-179"><a href="commute-vehicle-miles-traveled.html#cb32-179"></a><span class="co">#         dplyr::select(</span></span>
<span id="cb32-180"><a href="commute-vehicle-miles-traveled.html#cb32-180"></a><span class="co">#           tract,</span></span>
<span id="cb32-181"><a href="commute-vehicle-miles-traveled.html#cb32-181"></a><span class="co">#           time,</span></span>
<span id="cb32-182"><a href="commute-vehicle-miles-traveled.html#cb32-182"></a><span class="co">#           perc_jobs_car,</span></span>
<span id="cb32-183"><a href="commute-vehicle-miles-traveled.html#cb32-183"></a><span class="co">#           perc_jobs_carpool,</span></span>
<span id="cb32-184"><a href="commute-vehicle-miles-traveled.html#cb32-184"></a><span class="co">#           perc_vehicle</span></span>
<span id="cb32-185"><a href="commute-vehicle-miles-traveled.html#cb32-185"></a><span class="co">#         ),</span></span>
<span id="cb32-186"><a href="commute-vehicle-miles-traveled.html#cb32-186"></a><span class="co">#       by = c(&quot;residence&quot; = &quot;tract&quot;, &quot;tier&quot; = &quot;time&quot;)</span></span>
<span id="cb32-187"><a href="commute-vehicle-miles-traveled.html#cb32-187"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb32-188"><a href="commute-vehicle-miles-traveled.html#cb32-188"></a><span class="co">#     mutate(</span></span>
<span id="cb32-189"><a href="commute-vehicle-miles-traveled.html#cb32-189"></a><span class="co">#       jobs_car = jobs*perc_jobs_car,</span></span>
<span id="cb32-190"><a href="commute-vehicle-miles-traveled.html#cb32-190"></a><span class="co">#       jobs_carpool = jobs*perc_jobs_carpool,</span></span>
<span id="cb32-191"><a href="commute-vehicle-miles-traveled.html#cb32-191"></a><span class="co">#       vehicles = jobs*perc_vehicle,</span></span>
<span id="cb32-192"><a href="commute-vehicle-miles-traveled.html#cb32-192"></a><span class="co">#       vmt = person_miles*perc_vehicle</span></span>
<span id="cb32-193"><a href="commute-vehicle-miles-traveled.html#cb32-193"></a><span class="co">#     )</span></span>
<span id="cb32-194"><a href="commute-vehicle-miles-traveled.html#cb32-194"></a><span class="co"># </span></span>
<span id="cb32-195"><a href="commute-vehicle-miles-traveled.html#cb32-195"></a><span class="co">#     county_commute_vmt_tractmode &lt;-</span></span>
<span id="cb32-196"><a href="commute-vehicle-miles-traveled.html#cb32-196"></a><span class="co">#       rbind(county_commute_vmt_tractmode,</span></span>
<span id="cb32-197"><a href="commute-vehicle-miles-traveled.html#cb32-197"></a><span class="co">#         data.frame(</span></span>
<span id="cb32-198"><a href="commute-vehicle-miles-traveled.html#cb32-198"></a><span class="co">#           Year = year,</span></span>
<span id="cb32-199"><a href="commute-vehicle-miles-traveled.html#cb32-199"></a><span class="co">#           County = county,</span></span>
<span id="cb32-200"><a href="commute-vehicle-miles-traveled.html#cb32-200"></a><span class="co">#           person_miles = sum(county_lodes_h_mode$person_miles, na.rm=T),</span></span>
<span id="cb32-201"><a href="commute-vehicle-miles-traveled.html#cb32-201"></a><span class="co">#           jobs = sum(county_lodes_h_mode$jobs, na.rm=T),</span></span>
<span id="cb32-202"><a href="commute-vehicle-miles-traveled.html#cb32-202"></a><span class="co">#           jobs_car = sum(county_lodes_h_mode$jobs_car, na.rm=T),</span></span>
<span id="cb32-203"><a href="commute-vehicle-miles-traveled.html#cb32-203"></a><span class="co">#           jobs_carpool = sum(county_lodes_h_mode$jobs_carpool, na.rm=T),</span></span>
<span id="cb32-204"><a href="commute-vehicle-miles-traveled.html#cb32-204"></a><span class="co">#           vehicles = sum(county_lodes_h_mode$vehicles, na.rm = T),</span></span>
<span id="cb32-205"><a href="commute-vehicle-miles-traveled.html#cb32-205"></a><span class="co">#           vmt = sum(county_lodes_h_mode$vmt, na.rm=T)</span></span>
<span id="cb32-206"><a href="commute-vehicle-miles-traveled.html#cb32-206"></a><span class="co">#         )</span></span>
<span id="cb32-207"><a href="commute-vehicle-miles-traveled.html#cb32-207"></a><span class="co">#       )</span></span>
<span id="cb32-208"><a href="commute-vehicle-miles-traveled.html#cb32-208"></a><span class="co"># </span></span>
<span id="cb32-209"><a href="commute-vehicle-miles-traveled.html#cb32-209"></a><span class="co">#     save(county_commute_vmt_tractmode,file = &quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/county_commute_vmt_tractmode.Rdata&quot;)</span></span>
<span id="cb32-210"><a href="commute-vehicle-miles-traveled.html#cb32-210"></a><span class="co">#   }</span></span>
<span id="cb32-211"><a href="commute-vehicle-miles-traveled.html#cb32-211"></a><span class="co"># }</span></span>
<span id="cb32-212"><a href="commute-vehicle-miles-traveled.html#cb32-212"></a><span class="co">#</span></span>
<span id="cb32-213"><a href="commute-vehicle-miles-traveled.html#cb32-213"></a><span class="co"># county_commute_vmt_countymode &lt;- NULL</span></span>
<span id="cb32-214"><a href="commute-vehicle-miles-traveled.html#cb32-214"></a><span class="co"># </span></span>
<span id="cb32-215"><a href="commute-vehicle-miles-traveled.html#cb32-215"></a><span class="co"># for(year in 2011:2017){</span></span>
<span id="cb32-216"><a href="commute-vehicle-miles-traveled.html#cb32-216"></a><span class="co">#   for(county in c(&quot;013&quot;)){</span></span>
<span id="cb32-217"><a href="commute-vehicle-miles-traveled.html#cb32-217"></a><span class="co"># </span></span>
<span id="cb32-218"><a href="commute-vehicle-miles-traveled.html#cb32-218"></a><span class="co">#     print(paste0(year,&quot;-&quot;,county))</span></span>
<span id="cb32-219"><a href="commute-vehicle-miles-traveled.html#cb32-219"></a><span class="co"># </span></span>
<span id="cb32-220"><a href="commute-vehicle-miles-traveled.html#cb32-220"></a><span class="co">#     load(paste0(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/county_lodes_&quot;,county,&quot;_&quot;,year,&quot;_tract.Rdata&quot;))</span></span>
<span id="cb32-221"><a href="commute-vehicle-miles-traveled.html#cb32-221"></a><span class="co"># </span></span>
<span id="cb32-222"><a href="commute-vehicle-miles-traveled.html#cb32-222"></a><span class="co">#     load(paste0(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/acs1_vars_&quot;,year,&quot;.Rdata&quot;))</span></span>
<span id="cb32-223"><a href="commute-vehicle-miles-traveled.html#cb32-223"></a><span class="co"># </span></span>
<span id="cb32-224"><a href="commute-vehicle-miles-traveled.html#cb32-224"></a><span class="co">#     travel_time_mode &lt;-</span></span>
<span id="cb32-225"><a href="commute-vehicle-miles-traveled.html#cb32-225"></a><span class="co">#     getCensus(</span></span>
<span id="cb32-226"><a href="commute-vehicle-miles-traveled.html#cb32-226"></a><span class="co">#       name = &quot;acs/acs1&quot;,</span></span>
<span id="cb32-227"><a href="commute-vehicle-miles-traveled.html#cb32-227"></a><span class="co">#       vintage = year,</span></span>
<span id="cb32-228"><a href="commute-vehicle-miles-traveled.html#cb32-228"></a><span class="co">#       region = paste0(&quot;county:&quot;,county),</span></span>
<span id="cb32-229"><a href="commute-vehicle-miles-traveled.html#cb32-229"></a><span class="co">#       regionin = &quot;state:06&quot;,</span></span>
<span id="cb32-230"><a href="commute-vehicle-miles-traveled.html#cb32-230"></a><span class="co">#       vars = &quot;group(B08134)&quot;</span></span>
<span id="cb32-231"><a href="commute-vehicle-miles-traveled.html#cb32-231"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb32-232"><a href="commute-vehicle-miles-traveled.html#cb32-232"></a><span class="co">#     select_if(!names(.) %in% c(&quot;GEO_ID&quot;,&quot;state&quot;,&quot;NAME&quot;)) %&gt;%</span></span>
<span id="cb32-233"><a href="commute-vehicle-miles-traveled.html#cb32-233"></a><span class="co">#     dplyr::select(-c(contains(&quot;EA&quot;),contains(&quot;MA&quot;),contains(&quot;M&quot;))) %&gt;%</span></span>
<span id="cb32-234"><a href="commute-vehicle-miles-traveled.html#cb32-234"></a><span class="co">#     gather(</span></span>
<span id="cb32-235"><a href="commute-vehicle-miles-traveled.html#cb32-235"></a><span class="co">#       key = &quot;variable&quot;,</span></span>
<span id="cb32-236"><a href="commute-vehicle-miles-traveled.html#cb32-236"></a><span class="co">#       value = &quot;estimate&quot;,</span></span>
<span id="cb32-237"><a href="commute-vehicle-miles-traveled.html#cb32-237"></a><span class="co">#       -county</span></span>
<span id="cb32-238"><a href="commute-vehicle-miles-traveled.html#cb32-238"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb32-239"><a href="commute-vehicle-miles-traveled.html#cb32-239"></a><span class="co">#     mutate(</span></span>
<span id="cb32-240"><a href="commute-vehicle-miles-traveled.html#cb32-240"></a><span class="co">#       label = acs_vars$label[match(variable,acs_vars$name)],</span></span>
<span id="cb32-241"><a href="commute-vehicle-miles-traveled.html#cb32-241"></a><span class="co">#       time = # This extracts only the time information from our label.</span></span>
<span id="cb32-242"><a href="commute-vehicle-miles-traveled.html#cb32-242"></a><span class="co">#         substr(</span></span>
<span id="cb32-243"><a href="commute-vehicle-miles-traveled.html#cb32-243"></a><span class="co">#           label,</span></span>
<span id="cb32-244"><a href="commute-vehicle-miles-traveled.html#cb32-244"></a><span class="co">#           lapply(</span></span>
<span id="cb32-245"><a href="commute-vehicle-miles-traveled.html#cb32-245"></a><span class="co">#             label,</span></span>
<span id="cb32-246"><a href="commute-vehicle-miles-traveled.html#cb32-246"></a><span class="co">#             function(x){</span></span>
<span id="cb32-247"><a href="commute-vehicle-miles-traveled.html#cb32-247"></a><span class="co">#               ifelse(</span></span>
<span id="cb32-248"><a href="commute-vehicle-miles-traveled.html#cb32-248"></a><span class="co">#                 length(unlist(gregexpr(&#39;!!&#39;,x)))&lt;3,</span></span>
<span id="cb32-249"><a href="commute-vehicle-miles-traveled.html#cb32-249"></a><span class="co">#                 NA,</span></span>
<span id="cb32-250"><a href="commute-vehicle-miles-traveled.html#cb32-250"></a><span class="co">#                 max(unlist(gregexpr(&#39;!!&#39;,x)))+2</span></span>
<span id="cb32-251"><a href="commute-vehicle-miles-traveled.html#cb32-251"></a><span class="co">#               )</span></span>
<span id="cb32-252"><a href="commute-vehicle-miles-traveled.html#cb32-252"></a><span class="co">#             }</span></span>
<span id="cb32-253"><a href="commute-vehicle-miles-traveled.html#cb32-253"></a><span class="co">#           ),</span></span>
<span id="cb32-254"><a href="commute-vehicle-miles-traveled.html#cb32-254"></a><span class="co">#           nchar(label)</span></span>
<span id="cb32-255"><a href="commute-vehicle-miles-traveled.html#cb32-255"></a><span class="co">#         ),</span></span>
<span id="cb32-256"><a href="commute-vehicle-miles-traveled.html#cb32-256"></a><span class="co">#       mode = # This extracts only the mode information from our label. It doesn&#39;t fully deal with double-counting, so some are further removed later on in a filter.</span></span>
<span id="cb32-257"><a href="commute-vehicle-miles-traveled.html#cb32-257"></a><span class="co">#         substr(</span></span>
<span id="cb32-258"><a href="commute-vehicle-miles-traveled.html#cb32-258"></a><span class="co">#           label,</span></span>
<span id="cb32-259"><a href="commute-vehicle-miles-traveled.html#cb32-259"></a><span class="co">#           lapply(</span></span>
<span id="cb32-260"><a href="commute-vehicle-miles-traveled.html#cb32-260"></a><span class="co">#             label,</span></span>
<span id="cb32-261"><a href="commute-vehicle-miles-traveled.html#cb32-261"></a><span class="co">#             function(x){</span></span>
<span id="cb32-262"><a href="commute-vehicle-miles-traveled.html#cb32-262"></a><span class="co">#               ifelse(</span></span>
<span id="cb32-263"><a href="commute-vehicle-miles-traveled.html#cb32-263"></a><span class="co">#                 length(unlist(gregexpr(&#39;!!&#39;,x)))&lt;3,</span></span>
<span id="cb32-264"><a href="commute-vehicle-miles-traveled.html#cb32-264"></a><span class="co">#                 NA,</span></span>
<span id="cb32-265"><a href="commute-vehicle-miles-traveled.html#cb32-265"></a><span class="co">#                 unlist(gregexpr(&#39;!!&#39;,x))[length(unlist(gregexpr(&#39;!!&#39;,x)))-1]+2</span></span>
<span id="cb32-266"><a href="commute-vehicle-miles-traveled.html#cb32-266"></a><span class="co">#               )</span></span>
<span id="cb32-267"><a href="commute-vehicle-miles-traveled.html#cb32-267"></a><span class="co">#             }</span></span>
<span id="cb32-268"><a href="commute-vehicle-miles-traveled.html#cb32-268"></a><span class="co">#           ),</span></span>
<span id="cb32-269"><a href="commute-vehicle-miles-traveled.html#cb32-269"></a><span class="co">#           lapply(</span></span>
<span id="cb32-270"><a href="commute-vehicle-miles-traveled.html#cb32-270"></a><span class="co">#             label,</span></span>
<span id="cb32-271"><a href="commute-vehicle-miles-traveled.html#cb32-271"></a><span class="co">#             function(x){</span></span>
<span id="cb32-272"><a href="commute-vehicle-miles-traveled.html#cb32-272"></a><span class="co">#               max(unlist(gregexpr(&#39;!!&#39;,x)))-1</span></span>
<span id="cb32-273"><a href="commute-vehicle-miles-traveled.html#cb32-273"></a><span class="co">#             }</span></span>
<span id="cb32-274"><a href="commute-vehicle-miles-traveled.html#cb32-274"></a><span class="co">#           )</span></span>
<span id="cb32-275"><a href="commute-vehicle-miles-traveled.html#cb32-275"></a><span class="co">#         )</span></span>
<span id="cb32-276"><a href="commute-vehicle-miles-traveled.html#cb32-276"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb32-277"><a href="commute-vehicle-miles-traveled.html#cb32-277"></a><span class="co">#     filter(!is.na(time)) %&gt;% # This removes the grand total rows that are usually at the top of the ACS data.</span></span>
<span id="cb32-278"><a href="commute-vehicle-miles-traveled.html#cb32-278"></a><span class="co">#     filter(!mode %in% c(&quot;Car, truck, or van&quot;,&quot;Car truck or van&quot;,&quot;Carpooled&quot;,&quot;Public transportation (excluding taxicab)&quot;)) %&gt;% # This removes double-counted subtotals.</span></span>
<span id="cb32-279"><a href="commute-vehicle-miles-traveled.html#cb32-279"></a><span class="co">#     dplyr::select(-variable,-label)</span></span>
<span id="cb32-280"><a href="commute-vehicle-miles-traveled.html#cb32-280"></a><span class="co"># </span></span>
<span id="cb32-281"><a href="commute-vehicle-miles-traveled.html#cb32-281"></a><span class="co">#     travel_time_mode_summary &lt;-</span></span>
<span id="cb32-282"><a href="commute-vehicle-miles-traveled.html#cb32-282"></a><span class="co">#       travel_time_mode %&gt;%</span></span>
<span id="cb32-283"><a href="commute-vehicle-miles-traveled.html#cb32-283"></a><span class="co">#       group_by(time) %&gt;%</span></span>
<span id="cb32-284"><a href="commute-vehicle-miles-traveled.html#cb32-284"></a><span class="co">#       summarize(</span></span>
<span id="cb32-285"><a href="commute-vehicle-miles-traveled.html#cb32-285"></a><span class="co">#         jobs = sum(estimate),</span></span>
<span id="cb32-286"><a href="commute-vehicle-miles-traveled.html#cb32-286"></a><span class="co">#         jobs_drovealone = sum(estimate[which(mode == &quot;Drove alone&quot;)]),</span></span>
<span id="cb32-287"><a href="commute-vehicle-miles-traveled.html#cb32-287"></a><span class="co">#         jobs_carpool2 = sum(estimate[which(mode == &quot;In 2-person carpool&quot;)]),</span></span>
<span id="cb32-288"><a href="commute-vehicle-miles-traveled.html#cb32-288"></a><span class="co">#         jobs_carpool3 = sum(estimate[which(mode == &quot;In 3-or-more-person carpool&quot;)]),</span></span>
<span id="cb32-289"><a href="commute-vehicle-miles-traveled.html#cb32-289"></a><span class="co">#       ) %&gt;%</span></span>
<span id="cb32-290"><a href="commute-vehicle-miles-traveled.html#cb32-290"></a><span class="co">#       mutate(</span></span>
<span id="cb32-291"><a href="commute-vehicle-miles-traveled.html#cb32-291"></a><span class="co">#         vehicles_drovealone = jobs_drovealone,</span></span>
<span id="cb32-292"><a href="commute-vehicle-miles-traveled.html#cb32-292"></a><span class="co">#         vehicles_carpool2 = jobs_carpool2/2,</span></span>
<span id="cb32-293"><a href="commute-vehicle-miles-traveled.html#cb32-293"></a><span class="co">#         vehicles_carpool3 = jobs_carpool3/3,</span></span>
<span id="cb32-294"><a href="commute-vehicle-miles-traveled.html#cb32-294"></a><span class="co">#         jobs_car = jobs_drovealone+jobs_carpool2+jobs_carpool3,</span></span>
<span id="cb32-295"><a href="commute-vehicle-miles-traveled.html#cb32-295"></a><span class="co">#         jobs_carpool = jobs_carpool2+jobs_carpool3,</span></span>
<span id="cb32-296"><a href="commute-vehicle-miles-traveled.html#cb32-296"></a><span class="co">#         vehicles = vehicles_drovealone,vehicles_carpool2,vehicles_carpool3,</span></span>
<span id="cb32-297"><a href="commute-vehicle-miles-traveled.html#cb32-297"></a><span class="co">#         perc_jobs_car = jobs_car/jobs,</span></span>
<span id="cb32-298"><a href="commute-vehicle-miles-traveled.html#cb32-298"></a><span class="co">#         perc_jobs_carpool = jobs_carpool/jobs,</span></span>
<span id="cb32-299"><a href="commute-vehicle-miles-traveled.html#cb32-299"></a><span class="co">#         perc_vehicle = vehicles/jobs</span></span>
<span id="cb32-300"><a href="commute-vehicle-miles-traveled.html#cb32-300"></a><span class="co">#       )</span></span>
<span id="cb32-301"><a href="commute-vehicle-miles-traveled.html#cb32-301"></a><span class="co"># </span></span>
<span id="cb32-302"><a href="commute-vehicle-miles-traveled.html#cb32-302"></a><span class="co">#   county_lodes_h_mode &lt;-</span></span>
<span id="cb32-303"><a href="commute-vehicle-miles-traveled.html#cb32-303"></a><span class="co">#     county_lodes_h_filter %&gt;%</span></span>
<span id="cb32-304"><a href="commute-vehicle-miles-traveled.html#cb32-304"></a><span class="co">#     transmute(</span></span>
<span id="cb32-305"><a href="commute-vehicle-miles-traveled.html#cb32-305"></a><span class="co">#       jobs = S000,</span></span>
<span id="cb32-306"><a href="commute-vehicle-miles-traveled.html#cb32-306"></a><span class="co">#       duration = duration,</span></span>
<span id="cb32-307"><a href="commute-vehicle-miles-traveled.html#cb32-307"></a><span class="co">#       person_miles = S000*as.numeric(distance)/1.60934,</span></span>
<span id="cb32-308"><a href="commute-vehicle-miles-traveled.html#cb32-308"></a><span class="co">#       person_hours = S000*as.numeric(duration)/60</span></span>
<span id="cb32-309"><a href="commute-vehicle-miles-traveled.html#cb32-309"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb32-310"><a href="commute-vehicle-miles-traveled.html#cb32-310"></a><span class="co">#     mutate(</span></span>
<span id="cb32-311"><a href="commute-vehicle-miles-traveled.html#cb32-311"></a><span class="co">#       tier =</span></span>
<span id="cb32-312"><a href="commute-vehicle-miles-traveled.html#cb32-312"></a><span class="co">#         case_when(</span></span>
<span id="cb32-313"><a href="commute-vehicle-miles-traveled.html#cb32-313"></a><span class="co">#           duration &lt; 10 ~ &quot;Less than 10 minutes&quot;,</span></span>
<span id="cb32-314"><a href="commute-vehicle-miles-traveled.html#cb32-314"></a><span class="co">#           duration &lt; 15 ~ &quot;10 to 14 minutes&quot;,</span></span>
<span id="cb32-315"><a href="commute-vehicle-miles-traveled.html#cb32-315"></a><span class="co">#           duration &lt; 20 ~ &quot;15 to 19 minutes&quot;,</span></span>
<span id="cb32-316"><a href="commute-vehicle-miles-traveled.html#cb32-316"></a><span class="co">#           duration &lt; 25 ~ &quot;20 to 24 minutes&quot;,</span></span>
<span id="cb32-317"><a href="commute-vehicle-miles-traveled.html#cb32-317"></a><span class="co">#           duration &lt; 30 ~ &quot;25 to 29 minutes&quot;,</span></span>
<span id="cb32-318"><a href="commute-vehicle-miles-traveled.html#cb32-318"></a><span class="co">#           duration &lt; 35 ~ &quot;30 to 34 minutes&quot;,</span></span>
<span id="cb32-319"><a href="commute-vehicle-miles-traveled.html#cb32-319"></a><span class="co">#           duration &lt; 45 ~ &quot;35 to 44 minutes&quot;,</span></span>
<span id="cb32-320"><a href="commute-vehicle-miles-traveled.html#cb32-320"></a><span class="co">#           duration &lt; 60 ~ &quot;45 to 59 minutes&quot;,</span></span>
<span id="cb32-321"><a href="commute-vehicle-miles-traveled.html#cb32-321"></a><span class="co">#           TRUE ~ &quot;60 or more minutes&quot;</span></span>
<span id="cb32-322"><a href="commute-vehicle-miles-traveled.html#cb32-322"></a><span class="co">#         )</span></span>
<span id="cb32-323"><a href="commute-vehicle-miles-traveled.html#cb32-323"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb32-324"><a href="commute-vehicle-miles-traveled.html#cb32-324"></a><span class="co">#     left_join(</span></span>
<span id="cb32-325"><a href="commute-vehicle-miles-traveled.html#cb32-325"></a><span class="co">#       travel_time_mode_summary %&gt;%</span></span>
<span id="cb32-326"><a href="commute-vehicle-miles-traveled.html#cb32-326"></a><span class="co">#         dplyr::select(</span></span>
<span id="cb32-327"><a href="commute-vehicle-miles-traveled.html#cb32-327"></a><span class="co">#           time,</span></span>
<span id="cb32-328"><a href="commute-vehicle-miles-traveled.html#cb32-328"></a><span class="co">#           perc_jobs_car,</span></span>
<span id="cb32-329"><a href="commute-vehicle-miles-traveled.html#cb32-329"></a><span class="co">#           perc_jobs_carpool,</span></span>
<span id="cb32-330"><a href="commute-vehicle-miles-traveled.html#cb32-330"></a><span class="co">#           perc_vehicle</span></span>
<span id="cb32-331"><a href="commute-vehicle-miles-traveled.html#cb32-331"></a><span class="co">#         ),</span></span>
<span id="cb32-332"><a href="commute-vehicle-miles-traveled.html#cb32-332"></a><span class="co">#       by = c(&quot;tier&quot; = &quot;time&quot;)</span></span>
<span id="cb32-333"><a href="commute-vehicle-miles-traveled.html#cb32-333"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb32-334"><a href="commute-vehicle-miles-traveled.html#cb32-334"></a><span class="co">#     mutate(</span></span>
<span id="cb32-335"><a href="commute-vehicle-miles-traveled.html#cb32-335"></a><span class="co">#       jobs_car = jobs*perc_jobs_car,</span></span>
<span id="cb32-336"><a href="commute-vehicle-miles-traveled.html#cb32-336"></a><span class="co">#       jobs_carpool = jobs*perc_jobs_carpool,</span></span>
<span id="cb32-337"><a href="commute-vehicle-miles-traveled.html#cb32-337"></a><span class="co">#       vehicles = jobs*perc_vehicle,</span></span>
<span id="cb32-338"><a href="commute-vehicle-miles-traveled.html#cb32-338"></a><span class="co">#       vmt = person_miles*perc_vehicle</span></span>
<span id="cb32-339"><a href="commute-vehicle-miles-traveled.html#cb32-339"></a><span class="co">#     )</span></span>
<span id="cb32-340"><a href="commute-vehicle-miles-traveled.html#cb32-340"></a><span class="co"># </span></span>
<span id="cb32-341"><a href="commute-vehicle-miles-traveled.html#cb32-341"></a><span class="co">#     county_commute_vmt_countymode &lt;-</span></span>
<span id="cb32-342"><a href="commute-vehicle-miles-traveled.html#cb32-342"></a><span class="co">#       rbind(county_commute_vmt_countymode,</span></span>
<span id="cb32-343"><a href="commute-vehicle-miles-traveled.html#cb32-343"></a><span class="co">#         data.frame(</span></span>
<span id="cb32-344"><a href="commute-vehicle-miles-traveled.html#cb32-344"></a><span class="co">#           Year = year,</span></span>
<span id="cb32-345"><a href="commute-vehicle-miles-traveled.html#cb32-345"></a><span class="co">#           County = county,</span></span>
<span id="cb32-346"><a href="commute-vehicle-miles-traveled.html#cb32-346"></a><span class="co">#           person_miles = sum(county_lodes_h_mode$person_miles, na.rm=T),</span></span>
<span id="cb32-347"><a href="commute-vehicle-miles-traveled.html#cb32-347"></a><span class="co">#           jobs = sum(county_lodes_h_mode$jobs, na.rm=T),</span></span>
<span id="cb32-348"><a href="commute-vehicle-miles-traveled.html#cb32-348"></a><span class="co">#           jobs_car = sum(county_lodes_h_mode$jobs_car, na.rm=T),</span></span>
<span id="cb32-349"><a href="commute-vehicle-miles-traveled.html#cb32-349"></a><span class="co">#           jobs_carpool = sum(county_lodes_h_mode$jobs_carpool, na.rm=T),</span></span>
<span id="cb32-350"><a href="commute-vehicle-miles-traveled.html#cb32-350"></a><span class="co">#           vehicles = sum(county_lodes_h_mode$vehicles, na.rm = T),</span></span>
<span id="cb32-351"><a href="commute-vehicle-miles-traveled.html#cb32-351"></a><span class="co">#           vmt = sum(county_lodes_h_mode$vmt, na.rm=T)</span></span>
<span id="cb32-352"><a href="commute-vehicle-miles-traveled.html#cb32-352"></a><span class="co">#         )</span></span>
<span id="cb32-353"><a href="commute-vehicle-miles-traveled.html#cb32-353"></a><span class="co">#       )</span></span>
<span id="cb32-354"><a href="commute-vehicle-miles-traveled.html#cb32-354"></a><span class="co">#   }</span></span>
<span id="cb32-355"><a href="commute-vehicle-miles-traveled.html#cb32-355"></a><span class="co"># }</span></span>
<span id="cb32-356"><a href="commute-vehicle-miles-traveled.html#cb32-356"></a><span class="co"># </span></span>
<span id="cb32-357"><a href="commute-vehicle-miles-traveled.html#cb32-357"></a><span class="co"># save(county_commute_vmt_countymode, file = &quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/county_commute_vmt_countymode.Rdata&quot;)</span></span>
<span id="cb32-358"><a href="commute-vehicle-miles-traveled.html#cb32-358"></a><span class="co"># load(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/county_commute_vmt_countymode.Rdata&quot;)</span></span>
<span id="cb32-359"><a href="commute-vehicle-miles-traveled.html#cb32-359"></a><span class="co"># </span></span>
<span id="cb32-360"><a href="commute-vehicle-miles-traveled.html#cb32-360"></a><span class="co"># county_commute_vmt_countymode %&gt;% </span></span>
<span id="cb32-361"><a href="commute-vehicle-miles-traveled.html#cb32-361"></a><span class="co">#   filter(jobs_car != 0) %&gt;% </span></span>
<span id="cb32-362"><a href="commute-vehicle-miles-traveled.html#cb32-362"></a><span class="co">#   ggplot(</span></span>
<span id="cb32-363"><a href="commute-vehicle-miles-traveled.html#cb32-363"></a><span class="co">#     aes(</span></span>
<span id="cb32-364"><a href="commute-vehicle-miles-traveled.html#cb32-364"></a><span class="co">#       x = Year,</span></span>
<span id="cb32-365"><a href="commute-vehicle-miles-traveled.html#cb32-365"></a><span class="co">#       y = vmt/jobs,</span></span>
<span id="cb32-366"><a href="commute-vehicle-miles-traveled.html#cb32-366"></a><span class="co">#       colour = County</span></span>
<span id="cb32-367"><a href="commute-vehicle-miles-traveled.html#cb32-367"></a><span class="co">#     )</span></span>
<span id="cb32-368"><a href="commute-vehicle-miles-traveled.html#cb32-368"></a><span class="co">#   ) +</span></span>
<span id="cb32-369"><a href="commute-vehicle-miles-traveled.html#cb32-369"></a><span class="co">#   geom_line()</span></span>
<span id="cb32-370"><a href="commute-vehicle-miles-traveled.html#cb32-370"></a><span class="co"># </span></span>
<span id="cb32-371"><a href="commute-vehicle-miles-traveled.html#cb32-371"></a><span class="co"># load(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/county_commute_vmt_tractmode.Rdata&quot;)</span></span>
<span id="cb32-372"><a href="commute-vehicle-miles-traveled.html#cb32-372"></a><span class="co"># </span></span>
<span id="cb32-373"><a href="commute-vehicle-miles-traveled.html#cb32-373"></a><span class="co"># load(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/county_commute_vmt_countymode.Rdata&quot;)</span></span>
<span id="cb32-374"><a href="commute-vehicle-miles-traveled.html#cb32-374"></a><span class="co"># </span></span>
<span id="cb32-375"><a href="commute-vehicle-miles-traveled.html#cb32-375"></a><span class="co"># county_commute_vmt_compare &lt;-</span></span>
<span id="cb32-376"><a href="commute-vehicle-miles-traveled.html#cb32-376"></a><span class="co">#   rbind(</span></span>
<span id="cb32-377"><a href="commute-vehicle-miles-traveled.html#cb32-377"></a><span class="co">#     county_commute_vmt_tractmode %&gt;% </span></span>
<span id="cb32-378"><a href="commute-vehicle-miles-traveled.html#cb32-378"></a><span class="co">#       mutate(type = &quot;tract&quot;),</span></span>
<span id="cb32-379"><a href="commute-vehicle-miles-traveled.html#cb32-379"></a><span class="co">#     county_commute_vmt_countymode %&gt;% </span></span>
<span id="cb32-380"><a href="commute-vehicle-miles-traveled.html#cb32-380"></a><span class="co">#       mutate(type = &quot;county&quot;)</span></span>
<span id="cb32-381"><a href="commute-vehicle-miles-traveled.html#cb32-381"></a><span class="co">#   )</span></span>
<span id="cb32-382"><a href="commute-vehicle-miles-traveled.html#cb32-382"></a><span class="co"># </span></span>
<span id="cb32-383"><a href="commute-vehicle-miles-traveled.html#cb32-383"></a><span class="co"># county_commute_vmt_compare %&gt;% </span></span>
<span id="cb32-384"><a href="commute-vehicle-miles-traveled.html#cb32-384"></a><span class="co">#   filter(jobs_car != 0) %&gt;% </span></span>
<span id="cb32-385"><a href="commute-vehicle-miles-traveled.html#cb32-385"></a><span class="co">#   ggplot(</span></span>
<span id="cb32-386"><a href="commute-vehicle-miles-traveled.html#cb32-386"></a><span class="co">#     aes(</span></span>
<span id="cb32-387"><a href="commute-vehicle-miles-traveled.html#cb32-387"></a><span class="co">#       x = Year,</span></span>
<span id="cb32-388"><a href="commute-vehicle-miles-traveled.html#cb32-388"></a><span class="co">#       y = vmt/jobs,</span></span>
<span id="cb32-389"><a href="commute-vehicle-miles-traveled.html#cb32-389"></a><span class="co">#       linetype = type,</span></span>
<span id="cb32-390"><a href="commute-vehicle-miles-traveled.html#cb32-390"></a><span class="co">#       colour = County</span></span>
<span id="cb32-391"><a href="commute-vehicle-miles-traveled.html#cb32-391"></a><span class="co">#     )</span></span>
<span id="cb32-392"><a href="commute-vehicle-miles-traveled.html#cb32-392"></a><span class="co">#   ) +</span></span>
<span id="cb32-393"><a href="commute-vehicle-miles-traveled.html#cb32-393"></a><span class="co">#   geom_line()</span></span>
<span id="cb32-394"><a href="commute-vehicle-miles-traveled.html#cb32-394"></a></span>
<span id="cb32-395"><a href="commute-vehicle-miles-traveled.html#cb32-395"></a><span class="kw">load</span>(<span class="st">&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/county_commute_vmt_tractmode.Rdata&quot;</span>)</span>
<span id="cb32-396"><a href="commute-vehicle-miles-traveled.html#cb32-396"></a></span>
<span id="cb32-397"><a href="commute-vehicle-miles-traveled.html#cb32-397"></a>county_commute_vmt_tractmode_table &lt;-</span>
<span id="cb32-398"><a href="commute-vehicle-miles-traveled.html#cb32-398"></a><span class="st">  </span>county_commute_vmt_tractmode <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb32-399"><a href="commute-vehicle-miles-traveled.html#cb32-399"></a><span class="st">  </span><span class="kw">filter</span>(County <span class="op">==</span><span class="st"> &quot;077&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb32-400"><a href="commute-vehicle-miles-traveled.html#cb32-400"></a><span class="st">  </span><span class="kw">left_join</span>(county_neighbors, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;County&quot;</span> =<span class="st"> &quot;COUNTYFP&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb32-401"><a href="commute-vehicle-miles-traveled.html#cb32-401"></a><span class="st">  </span><span class="kw">transmute</span>(</span>
<span id="cb32-402"><a href="commute-vehicle-miles-traveled.html#cb32-402"></a>    <span class="dt">Year =</span> Year,</span>
<span id="cb32-403"><a href="commute-vehicle-miles-traveled.html#cb32-403"></a>    <span class="st">`</span><span class="dt">Jobs held by SJC residents</span><span class="st">`</span> =<span class="st"> </span><span class="kw">prettyNum</span>(<span class="kw">round</span>(jobs,<span class="op">-</span><span class="dv">3</span>),<span class="dt">big.mark=</span><span class="st">&quot;,&quot;</span>),</span>
<span id="cb32-404"><a href="commute-vehicle-miles-traveled.html#cb32-404"></a>    <span class="st">`</span><span class="dt">Car-dependent jobs</span><span class="st">`</span> =<span class="st"> </span><span class="kw">prettyNum</span>(<span class="kw">round</span>(jobs_car,<span class="op">-</span><span class="dv">3</span>),<span class="dt">big.mark=</span><span class="st">&quot;,&quot;</span>),</span>
<span id="cb32-405"><a href="commute-vehicle-miles-traveled.html#cb32-405"></a>    <span class="st">`</span><span class="dt">Carpooled jobs</span><span class="st">`</span> =<span class="st"> </span><span class="kw">prettyNum</span>(<span class="kw">round</span>(jobs_carpool,<span class="op">-</span><span class="dv">3</span>),<span class="dt">big.mark=</span><span class="st">&quot;,&quot;</span>),</span>
<span id="cb32-406"><a href="commute-vehicle-miles-traveled.html#cb32-406"></a>    <span class="st">`</span><span class="dt">Vehicles driven by SJC residents</span><span class="st">`</span> =<span class="st"> </span><span class="kw">prettyNum</span>(<span class="kw">round</span>(vehicles,<span class="op">-</span><span class="dv">3</span>),<span class="dt">big.mark=</span><span class="st">&quot;,&quot;</span>),</span>
<span id="cb32-407"><a href="commute-vehicle-miles-traveled.html#cb32-407"></a>    <span class="st">`</span><span class="dt">Person miles traveled</span><span class="st">`</span> =<span class="st"> </span><span class="kw">prettyNum</span>(<span class="kw">round</span>(person_miles,<span class="op">-</span><span class="dv">4</span>),<span class="dt">big.mark=</span><span class="st">&quot;,&quot;</span>),</span>
<span id="cb32-408"><a href="commute-vehicle-miles-traveled.html#cb32-408"></a>    <span class="st">`</span><span class="dt">Vehicle miles traveled</span><span class="st">`</span> =<span class="st"> </span><span class="kw">prettyNum</span>(<span class="kw">round</span>(vmt,<span class="op">-</span><span class="dv">4</span>),<span class="dt">big.mark=</span><span class="st">&quot;,&quot;</span>)</span>
<span id="cb32-409"><a href="commute-vehicle-miles-traveled.html#cb32-409"></a>  )</span>
<span id="cb32-410"><a href="commute-vehicle-miles-traveled.html#cb32-410"></a></span>
<span id="cb32-411"><a href="commute-vehicle-miles-traveled.html#cb32-411"></a><span class="kw">kable</span>(</span>
<span id="cb32-412"><a href="commute-vehicle-miles-traveled.html#cb32-412"></a>  county_commute_vmt_tractmode_table,</span>
<span id="cb32-413"><a href="commute-vehicle-miles-traveled.html#cb32-413"></a>  <span class="dt">booktabs =</span> <span class="ot">TRUE</span>,</span>
<span id="cb32-414"><a href="commute-vehicle-miles-traveled.html#cb32-414"></a>  <span class="dt">caption =</span> <span class="st">&#39;Commute data for SJC residents, 2011 to 2017. Data from LODES.&#39;</span></span>
<span id="cb32-415"><a href="commute-vehicle-miles-traveled.html#cb32-415"></a>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb32-416"><a href="commute-vehicle-miles-traveled.html#cb32-416"></a><span class="st">  </span><span class="kw">kable_styling</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb32-417"><a href="commute-vehicle-miles-traveled.html#cb32-417"></a><span class="st">  </span><span class="kw">scroll_box</span>(<span class="dt">width =</span> <span class="st">&quot;100%&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:county-commute-vmt-tractmode-table">Table 2.15: </span>Commute data for SJC residents, 2011 to 2017. Data from LODES.
</caption>
<thead>
<tr>
<th style="text-align:right;">
Year
</th>
<th style="text-align:left;">
Jobs held by SJC residents
</th>
<th style="text-align:left;">
Car-dependent jobs
</th>
<th style="text-align:left;">
Carpooled jobs
</th>
<th style="text-align:left;">
Vehicles driven by SJC residents
</th>
<th style="text-align:left;">
Person miles traveled
</th>
<th style="text-align:left;">
Vehicle miles traveled
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2011
</td>
<td style="text-align:left;">
202,000
</td>
<td style="text-align:left;">
187,000
</td>
<td style="text-align:left;">
32,000
</td>
<td style="text-align:left;">
156,000
</td>
<td style="text-align:left;">
6,460,000
</td>
<td style="text-align:left;">
4,540,000
</td>
</tr>
<tr>
<td style="text-align:right;">
2012
</td>
<td style="text-align:left;">
205,000
</td>
<td style="text-align:left;">
192,000
</td>
<td style="text-align:left;">
33,000
</td>
<td style="text-align:left;">
159,000
</td>
<td style="text-align:left;">
6,610,000
</td>
<td style="text-align:left;">
4,690,000
</td>
</tr>
<tr>
<td style="text-align:right;">
2013
</td>
<td style="text-align:left;">
213,000
</td>
<td style="text-align:left;">
200,000
</td>
<td style="text-align:left;">
33,000
</td>
<td style="text-align:left;">
167,000
</td>
<td style="text-align:left;">
6,970,000
</td>
<td style="text-align:left;">
5,080,000
</td>
</tr>
<tr>
<td style="text-align:right;">
2014
</td>
<td style="text-align:left;">
221,000
</td>
<td style="text-align:left;">
207,000
</td>
<td style="text-align:left;">
35,000
</td>
<td style="text-align:left;">
172,000
</td>
<td style="text-align:left;">
7,260,000
</td>
<td style="text-align:left;">
5,240,000
</td>
</tr>
<tr>
<td style="text-align:right;">
2015
</td>
<td style="text-align:left;">
229,000
</td>
<td style="text-align:left;">
215,000
</td>
<td style="text-align:left;">
38,000
</td>
<td style="text-align:left;">
176,000
</td>
<td style="text-align:left;">
7,380,000
</td>
<td style="text-align:left;">
5,170,000
</td>
</tr>
<tr>
<td style="text-align:right;">
2016
</td>
<td style="text-align:left;">
238,000
</td>
<td style="text-align:left;">
223,000
</td>
<td style="text-align:left;">
39,000
</td>
<td style="text-align:left;">
184,000
</td>
<td style="text-align:left;">
7,810,000
</td>
<td style="text-align:left;">
5,520,000
</td>
</tr>
<tr>
<td style="text-align:right;">
2017
</td>
<td style="text-align:left;">
248,000
</td>
<td style="text-align:left;">
232,000
</td>
<td style="text-align:left;">
39,000
</td>
<td style="text-align:left;">
193,000
</td>
<td style="text-align:left;">
8,280,000
</td>
<td style="text-align:left;">
5,930,000
</td>
</tr>
</tbody>
</table>
</div>
<p><span class="math inline">\(~\)</span></p>
<p>The following figure shows one-way commute VMT/job for SJC and its neighboring counties from 2011 to 2017. Note that this VMT/job ratio divides VMTs equally among all car-dependent jobs, leaving out non-car-dependent jobs (never more than 10% of jobs, as can be seen in the previous table).</p>
<p>SJC is at the top of the figure, 25 miles/job in 2017, vying with Stanislaus County to have the highest average commute distance per car-dependent worker.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="commute-vehicle-miles-traveled.html#cb33-1"></a>county_commute_vmt_tractmode <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb33-2"><a href="commute-vehicle-miles-traveled.html#cb33-2"></a><span class="st">  </span><span class="kw">left_join</span>(county_neighbors, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;County&quot;</span> =<span class="st"> &quot;COUNTYFP&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb33-3"><a href="commute-vehicle-miles-traveled.html#cb33-3"></a><span class="st">  </span><span class="kw">ggplot</span>(</span>
<span id="cb33-4"><a href="commute-vehicle-miles-traveled.html#cb33-4"></a>    <span class="kw">aes</span>(</span>
<span id="cb33-5"><a href="commute-vehicle-miles-traveled.html#cb33-5"></a>      <span class="dt">x =</span> Year,</span>
<span id="cb33-6"><a href="commute-vehicle-miles-traveled.html#cb33-6"></a>      <span class="dt">y =</span> vmt<span class="op">/</span>jobs_car,</span>
<span id="cb33-7"><a href="commute-vehicle-miles-traveled.html#cb33-7"></a>      <span class="dt">colour =</span> NAME</span>
<span id="cb33-8"><a href="commute-vehicle-miles-traveled.html#cb33-8"></a>    )</span>
<span id="cb33-9"><a href="commute-vehicle-miles-traveled.html#cb33-9"></a>  ) <span class="op">+</span></span>
<span id="cb33-10"><a href="commute-vehicle-miles-traveled.html#cb33-10"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb33-11"><a href="commute-vehicle-miles-traveled.html#cb33-11"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;One-way commute VMT per</span><span class="ch">\n</span><span class="st">car-dependent worker&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb33-12"><a href="commute-vehicle-miles-traveled.html#cb33-12"></a><span class="st">  </span><span class="kw">scale_color_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;County&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:county-commute-vmt-tractmode-graph"></span>
<img src="stockton_greeneconomy_files/figure-html/county-commute-vmt-tractmode-graph-1.png" alt="One-way commute miles per car-dependent worker by county, 2011 to 2017. Data from LODES." width="672" />
<p class="caption">
Figure 2.17: One-way commute miles per car-dependent worker by county, 2011 to 2017. Data from LODES.
</p>
</div>
<p><span class="math inline">\(~\)</span></p>
<p>One of the possible contributions to an increasing VMT/job isn’t necessarily further away jobs but less carpooling to get to those jobs. The following figure shows that the percent of car-dependent SJC workers who carpool has declined from 2015 to 2017, similar to Stanislaus and Sacramento County.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="commute-vehicle-miles-traveled.html#cb34-1"></a><span class="co"># county_modeshare &lt;- NULL</span></span>
<span id="cb34-2"><a href="commute-vehicle-miles-traveled.html#cb34-2"></a><span class="co"># </span></span>
<span id="cb34-3"><a href="commute-vehicle-miles-traveled.html#cb34-3"></a><span class="co"># for(year in 2011:2017){</span></span>
<span id="cb34-4"><a href="commute-vehicle-miles-traveled.html#cb34-4"></a><span class="co">#   for(county in county_neighbors$COUNTYFP){</span></span>
<span id="cb34-5"><a href="commute-vehicle-miles-traveled.html#cb34-5"></a><span class="co">#     </span></span>
<span id="cb34-6"><a href="commute-vehicle-miles-traveled.html#cb34-6"></a><span class="co">#     print(paste0(year,&quot;-&quot;,county))</span></span>
<span id="cb34-7"><a href="commute-vehicle-miles-traveled.html#cb34-7"></a><span class="co">#     </span></span>
<span id="cb34-8"><a href="commute-vehicle-miles-traveled.html#cb34-8"></a><span class="co">#     load(paste0(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/acs1_vars_&quot;,year,&quot;.Rdata&quot;))</span></span>
<span id="cb34-9"><a href="commute-vehicle-miles-traveled.html#cb34-9"></a><span class="co">#     </span></span>
<span id="cb34-10"><a href="commute-vehicle-miles-traveled.html#cb34-10"></a><span class="co">#     travel_time_mode &lt;-</span></span>
<span id="cb34-11"><a href="commute-vehicle-miles-traveled.html#cb34-11"></a><span class="co">#     getCensus(</span></span>
<span id="cb34-12"><a href="commute-vehicle-miles-traveled.html#cb34-12"></a><span class="co">#       name = &quot;acs/acs1&quot;,</span></span>
<span id="cb34-13"><a href="commute-vehicle-miles-traveled.html#cb34-13"></a><span class="co">#       vintage = year,</span></span>
<span id="cb34-14"><a href="commute-vehicle-miles-traveled.html#cb34-14"></a><span class="co">#       region = paste0(&quot;county:&quot;,county),</span></span>
<span id="cb34-15"><a href="commute-vehicle-miles-traveled.html#cb34-15"></a><span class="co">#       regionin = &quot;state:06&quot;,</span></span>
<span id="cb34-16"><a href="commute-vehicle-miles-traveled.html#cb34-16"></a><span class="co">#       vars = &quot;group(B08134)&quot;</span></span>
<span id="cb34-17"><a href="commute-vehicle-miles-traveled.html#cb34-17"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb34-18"><a href="commute-vehicle-miles-traveled.html#cb34-18"></a><span class="co">#     select_if(!names(.) %in% c(&quot;GEO_ID&quot;,&quot;state&quot;,&quot;NAME&quot;)) %&gt;%</span></span>
<span id="cb34-19"><a href="commute-vehicle-miles-traveled.html#cb34-19"></a><span class="co">#     dplyr::select(-c(contains(&quot;EA&quot;),contains(&quot;MA&quot;),contains(&quot;M&quot;))) %&gt;%</span></span>
<span id="cb34-20"><a href="commute-vehicle-miles-traveled.html#cb34-20"></a><span class="co">#     gather(</span></span>
<span id="cb34-21"><a href="commute-vehicle-miles-traveled.html#cb34-21"></a><span class="co">#       key = &quot;variable&quot;,</span></span>
<span id="cb34-22"><a href="commute-vehicle-miles-traveled.html#cb34-22"></a><span class="co">#       value = &quot;estimate&quot;,</span></span>
<span id="cb34-23"><a href="commute-vehicle-miles-traveled.html#cb34-23"></a><span class="co">#       -county</span></span>
<span id="cb34-24"><a href="commute-vehicle-miles-traveled.html#cb34-24"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb34-25"><a href="commute-vehicle-miles-traveled.html#cb34-25"></a><span class="co">#     mutate(</span></span>
<span id="cb34-26"><a href="commute-vehicle-miles-traveled.html#cb34-26"></a><span class="co">#       label = acs_vars$label[match(variable,acs_vars$name)],</span></span>
<span id="cb34-27"><a href="commute-vehicle-miles-traveled.html#cb34-27"></a><span class="co">#       time = # This extracts only the time information from our label.</span></span>
<span id="cb34-28"><a href="commute-vehicle-miles-traveled.html#cb34-28"></a><span class="co">#         substr(</span></span>
<span id="cb34-29"><a href="commute-vehicle-miles-traveled.html#cb34-29"></a><span class="co">#           label,</span></span>
<span id="cb34-30"><a href="commute-vehicle-miles-traveled.html#cb34-30"></a><span class="co">#           lapply(</span></span>
<span id="cb34-31"><a href="commute-vehicle-miles-traveled.html#cb34-31"></a><span class="co">#             label,</span></span>
<span id="cb34-32"><a href="commute-vehicle-miles-traveled.html#cb34-32"></a><span class="co">#             function(x){</span></span>
<span id="cb34-33"><a href="commute-vehicle-miles-traveled.html#cb34-33"></a><span class="co">#               ifelse(</span></span>
<span id="cb34-34"><a href="commute-vehicle-miles-traveled.html#cb34-34"></a><span class="co">#                 length(unlist(gregexpr(&#39;!!&#39;,x)))&lt;3,</span></span>
<span id="cb34-35"><a href="commute-vehicle-miles-traveled.html#cb34-35"></a><span class="co">#                 NA,</span></span>
<span id="cb34-36"><a href="commute-vehicle-miles-traveled.html#cb34-36"></a><span class="co">#                 max(unlist(gregexpr(&#39;!!&#39;,x)))+2</span></span>
<span id="cb34-37"><a href="commute-vehicle-miles-traveled.html#cb34-37"></a><span class="co">#               )</span></span>
<span id="cb34-38"><a href="commute-vehicle-miles-traveled.html#cb34-38"></a><span class="co">#             }</span></span>
<span id="cb34-39"><a href="commute-vehicle-miles-traveled.html#cb34-39"></a><span class="co">#           ),</span></span>
<span id="cb34-40"><a href="commute-vehicle-miles-traveled.html#cb34-40"></a><span class="co">#           nchar(label)</span></span>
<span id="cb34-41"><a href="commute-vehicle-miles-traveled.html#cb34-41"></a><span class="co">#         ),</span></span>
<span id="cb34-42"><a href="commute-vehicle-miles-traveled.html#cb34-42"></a><span class="co">#       mode = # This extracts only the mode information from our label. It doesn&#39;t fully deal with double-counting, so some are further removed later on in a filter.</span></span>
<span id="cb34-43"><a href="commute-vehicle-miles-traveled.html#cb34-43"></a><span class="co">#         substr(</span></span>
<span id="cb34-44"><a href="commute-vehicle-miles-traveled.html#cb34-44"></a><span class="co">#           label,</span></span>
<span id="cb34-45"><a href="commute-vehicle-miles-traveled.html#cb34-45"></a><span class="co">#           lapply(</span></span>
<span id="cb34-46"><a href="commute-vehicle-miles-traveled.html#cb34-46"></a><span class="co">#             label,</span></span>
<span id="cb34-47"><a href="commute-vehicle-miles-traveled.html#cb34-47"></a><span class="co">#             function(x){</span></span>
<span id="cb34-48"><a href="commute-vehicle-miles-traveled.html#cb34-48"></a><span class="co">#               ifelse(</span></span>
<span id="cb34-49"><a href="commute-vehicle-miles-traveled.html#cb34-49"></a><span class="co">#                 length(unlist(gregexpr(&#39;!!&#39;,x)))&lt;3,</span></span>
<span id="cb34-50"><a href="commute-vehicle-miles-traveled.html#cb34-50"></a><span class="co">#                 NA,</span></span>
<span id="cb34-51"><a href="commute-vehicle-miles-traveled.html#cb34-51"></a><span class="co">#                 unlist(gregexpr(&#39;!!&#39;,x))[length(unlist(gregexpr(&#39;!!&#39;,x)))-1]+2</span></span>
<span id="cb34-52"><a href="commute-vehicle-miles-traveled.html#cb34-52"></a><span class="co">#               )</span></span>
<span id="cb34-53"><a href="commute-vehicle-miles-traveled.html#cb34-53"></a><span class="co">#             }</span></span>
<span id="cb34-54"><a href="commute-vehicle-miles-traveled.html#cb34-54"></a><span class="co">#           ),</span></span>
<span id="cb34-55"><a href="commute-vehicle-miles-traveled.html#cb34-55"></a><span class="co">#           lapply(</span></span>
<span id="cb34-56"><a href="commute-vehicle-miles-traveled.html#cb34-56"></a><span class="co">#             label,</span></span>
<span id="cb34-57"><a href="commute-vehicle-miles-traveled.html#cb34-57"></a><span class="co">#             function(x){</span></span>
<span id="cb34-58"><a href="commute-vehicle-miles-traveled.html#cb34-58"></a><span class="co">#               max(unlist(gregexpr(&#39;!!&#39;,x)))-1</span></span>
<span id="cb34-59"><a href="commute-vehicle-miles-traveled.html#cb34-59"></a><span class="co">#             }</span></span>
<span id="cb34-60"><a href="commute-vehicle-miles-traveled.html#cb34-60"></a><span class="co">#           )</span></span>
<span id="cb34-61"><a href="commute-vehicle-miles-traveled.html#cb34-61"></a><span class="co">#         )</span></span>
<span id="cb34-62"><a href="commute-vehicle-miles-traveled.html#cb34-62"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb34-63"><a href="commute-vehicle-miles-traveled.html#cb34-63"></a><span class="co">#     filter(!is.na(time)) %&gt;% # This removes the grand total rows that are usually at the top of the ACS data.</span></span>
<span id="cb34-64"><a href="commute-vehicle-miles-traveled.html#cb34-64"></a><span class="co">#     filter(!mode %in% c(&quot;Car, truck, or van&quot;,&quot;Car truck or van&quot;,&quot;Carpooled&quot;,&quot;Public transportation (excluding taxicab)&quot;)) %&gt;% # This removes double-counted subtotals.</span></span>
<span id="cb34-65"><a href="commute-vehicle-miles-traveled.html#cb34-65"></a><span class="co">#     dplyr::select(-variable,-label)</span></span>
<span id="cb34-66"><a href="commute-vehicle-miles-traveled.html#cb34-66"></a><span class="co">#     </span></span>
<span id="cb34-67"><a href="commute-vehicle-miles-traveled.html#cb34-67"></a><span class="co">#     travel_time_mode_summary &lt;-</span></span>
<span id="cb34-68"><a href="commute-vehicle-miles-traveled.html#cb34-68"></a><span class="co">#       travel_time_mode %&gt;%</span></span>
<span id="cb34-69"><a href="commute-vehicle-miles-traveled.html#cb34-69"></a><span class="co">#       summarize(</span></span>
<span id="cb34-70"><a href="commute-vehicle-miles-traveled.html#cb34-70"></a><span class="co">#         jobs = sum(estimate),</span></span>
<span id="cb34-71"><a href="commute-vehicle-miles-traveled.html#cb34-71"></a><span class="co">#         jobs_drovealone = sum(estimate[which(mode == &quot;Drove alone&quot;)]),</span></span>
<span id="cb34-72"><a href="commute-vehicle-miles-traveled.html#cb34-72"></a><span class="co">#         jobs_carpool2 = sum(estimate[which(mode == &quot;In 2-person carpool&quot;)]),</span></span>
<span id="cb34-73"><a href="commute-vehicle-miles-traveled.html#cb34-73"></a><span class="co">#         jobs_carpool3 = sum(estimate[which(mode == &quot;In 3-or-more-person carpool&quot;)]),</span></span>
<span id="cb34-74"><a href="commute-vehicle-miles-traveled.html#cb34-74"></a><span class="co">#       ) %&gt;% </span></span>
<span id="cb34-75"><a href="commute-vehicle-miles-traveled.html#cb34-75"></a><span class="co">#       mutate(</span></span>
<span id="cb34-76"><a href="commute-vehicle-miles-traveled.html#cb34-76"></a><span class="co">#         vehicles_drovealone = jobs_drovealone,</span></span>
<span id="cb34-77"><a href="commute-vehicle-miles-traveled.html#cb34-77"></a><span class="co">#         vehicles_carpool2 = jobs_carpool2/2,</span></span>
<span id="cb34-78"><a href="commute-vehicle-miles-traveled.html#cb34-78"></a><span class="co">#         vehicles_carpool3 = jobs_carpool3/3,</span></span>
<span id="cb34-79"><a href="commute-vehicle-miles-traveled.html#cb34-79"></a><span class="co">#         jobs_car = jobs_drovealone+jobs_carpool2+jobs_carpool3,</span></span>
<span id="cb34-80"><a href="commute-vehicle-miles-traveled.html#cb34-80"></a><span class="co">#         jobs_carpool = jobs_carpool2+jobs_carpool3,</span></span>
<span id="cb34-81"><a href="commute-vehicle-miles-traveled.html#cb34-81"></a><span class="co">#         vehicles = vehicles_drovealone,vehicles_carpool2,vehicles_carpool3,</span></span>
<span id="cb34-82"><a href="commute-vehicle-miles-traveled.html#cb34-82"></a><span class="co">#         perc_jobs_car = jobs_car/jobs,</span></span>
<span id="cb34-83"><a href="commute-vehicle-miles-traveled.html#cb34-83"></a><span class="co">#         perc_jobs_carpool = jobs_carpool/jobs,</span></span>
<span id="cb34-84"><a href="commute-vehicle-miles-traveled.html#cb34-84"></a><span class="co">#         perc_vehicle = vehicles/jobs</span></span>
<span id="cb34-85"><a href="commute-vehicle-miles-traveled.html#cb34-85"></a><span class="co">#       )</span></span>
<span id="cb34-86"><a href="commute-vehicle-miles-traveled.html#cb34-86"></a><span class="co">#     </span></span>
<span id="cb34-87"><a href="commute-vehicle-miles-traveled.html#cb34-87"></a><span class="co">#     county_modeshare &lt;-</span></span>
<span id="cb34-88"><a href="commute-vehicle-miles-traveled.html#cb34-88"></a><span class="co">#       county_modeshare %&gt;% </span></span>
<span id="cb34-89"><a href="commute-vehicle-miles-traveled.html#cb34-89"></a><span class="co">#       rbind(</span></span>
<span id="cb34-90"><a href="commute-vehicle-miles-traveled.html#cb34-90"></a><span class="co">#         data.frame(</span></span>
<span id="cb34-91"><a href="commute-vehicle-miles-traveled.html#cb34-91"></a><span class="co">#           year = year,</span></span>
<span id="cb34-92"><a href="commute-vehicle-miles-traveled.html#cb34-92"></a><span class="co">#           county = county,</span></span>
<span id="cb34-93"><a href="commute-vehicle-miles-traveled.html#cb34-93"></a><span class="co">#           jobs = travel_time_mode_summary$jobs,</span></span>
<span id="cb34-94"><a href="commute-vehicle-miles-traveled.html#cb34-94"></a><span class="co">#           perc_jobs_car = travel_time_mode_summary$perc_jobs_car,</span></span>
<span id="cb34-95"><a href="commute-vehicle-miles-traveled.html#cb34-95"></a><span class="co">#           perc_jobs_carpool = travel_time_mode_summary$perc_jobs_carpool,</span></span>
<span id="cb34-96"><a href="commute-vehicle-miles-traveled.html#cb34-96"></a><span class="co">#           perc_vehicle = travel_time_mode_summary$perc_vehicle</span></span>
<span id="cb34-97"><a href="commute-vehicle-miles-traveled.html#cb34-97"></a><span class="co">#         )</span></span>
<span id="cb34-98"><a href="commute-vehicle-miles-traveled.html#cb34-98"></a><span class="co">#       )</span></span>
<span id="cb34-99"><a href="commute-vehicle-miles-traveled.html#cb34-99"></a><span class="co">#   }</span></span>
<span id="cb34-100"><a href="commute-vehicle-miles-traveled.html#cb34-100"></a><span class="co"># }</span></span>
<span id="cb34-101"><a href="commute-vehicle-miles-traveled.html#cb34-101"></a><span class="co"># </span></span>
<span id="cb34-102"><a href="commute-vehicle-miles-traveled.html#cb34-102"></a><span class="co"># save(county_modeshare, file = &quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/county_modeshare.Rdata&quot;)</span></span>
<span id="cb34-103"><a href="commute-vehicle-miles-traveled.html#cb34-103"></a><span class="co"># load(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/county_modeshare.Rdata&quot;)</span></span>
<span id="cb34-104"><a href="commute-vehicle-miles-traveled.html#cb34-104"></a><span class="co"># </span></span>
<span id="cb34-105"><a href="commute-vehicle-miles-traveled.html#cb34-105"></a><span class="co"># county_modeshare %&gt;% </span></span>
<span id="cb34-106"><a href="commute-vehicle-miles-traveled.html#cb34-106"></a><span class="co">#   filter(county %in% c(&quot;077&quot;,&quot;001&quot;,&quot;013&quot;,&quot;067&quot;,&quot;099&quot;)) %&gt;% </span></span>
<span id="cb34-107"><a href="commute-vehicle-miles-traveled.html#cb34-107"></a><span class="co">#   filter(jobs != 0) %&gt;% </span></span>
<span id="cb34-108"><a href="commute-vehicle-miles-traveled.html#cb34-108"></a><span class="co">#   left_join(county_neighbors, by = c(&quot;county&quot; = &quot;COUNTYFP&quot;)) %&gt;% </span></span>
<span id="cb34-109"><a href="commute-vehicle-miles-traveled.html#cb34-109"></a><span class="co">#   ggplot(</span></span>
<span id="cb34-110"><a href="commute-vehicle-miles-traveled.html#cb34-110"></a><span class="co">#     aes(</span></span>
<span id="cb34-111"><a href="commute-vehicle-miles-traveled.html#cb34-111"></a><span class="co">#       x = year,</span></span>
<span id="cb34-112"><a href="commute-vehicle-miles-traveled.html#cb34-112"></a><span class="co">#       y = perc_jobs_carpool/perc_jobs_car*100,</span></span>
<span id="cb34-113"><a href="commute-vehicle-miles-traveled.html#cb34-113"></a><span class="co">#       colour = NAME</span></span>
<span id="cb34-114"><a href="commute-vehicle-miles-traveled.html#cb34-114"></a><span class="co">#     )</span></span>
<span id="cb34-115"><a href="commute-vehicle-miles-traveled.html#cb34-115"></a><span class="co">#   ) +</span></span>
<span id="cb34-116"><a href="commute-vehicle-miles-traveled.html#cb34-116"></a><span class="co">#   geom_line() +</span></span>
<span id="cb34-117"><a href="commute-vehicle-miles-traveled.html#cb34-117"></a><span class="co">#   labs(x = &quot;Year&quot;, y = &quot;% Car-dependent workers who carpool&quot;) + </span></span>
<span id="cb34-118"><a href="commute-vehicle-miles-traveled.html#cb34-118"></a><span class="co">#   scale_color_discrete(name = &quot;County&quot;)</span></span>
<span id="cb34-119"><a href="commute-vehicle-miles-traveled.html#cb34-119"></a></span>
<span id="cb34-120"><a href="commute-vehicle-miles-traveled.html#cb34-120"></a>county_commute_vmt_tractmode <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb34-121"><a href="commute-vehicle-miles-traveled.html#cb34-121"></a><span class="st">  </span><span class="kw">left_join</span>(county_neighbors, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;County&quot;</span> =<span class="st"> &quot;COUNTYFP&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb34-122"><a href="commute-vehicle-miles-traveled.html#cb34-122"></a><span class="st">  </span><span class="kw">ggplot</span>(</span>
<span id="cb34-123"><a href="commute-vehicle-miles-traveled.html#cb34-123"></a>    <span class="kw">aes</span>(</span>
<span id="cb34-124"><a href="commute-vehicle-miles-traveled.html#cb34-124"></a>      <span class="dt">x =</span> Year,</span>
<span id="cb34-125"><a href="commute-vehicle-miles-traveled.html#cb34-125"></a>      <span class="dt">y =</span> jobs_carpool<span class="op">/</span>jobs_car,</span>
<span id="cb34-126"><a href="commute-vehicle-miles-traveled.html#cb34-126"></a>      <span class="dt">colour =</span> NAME</span>
<span id="cb34-127"><a href="commute-vehicle-miles-traveled.html#cb34-127"></a>    )</span>
<span id="cb34-128"><a href="commute-vehicle-miles-traveled.html#cb34-128"></a>  ) <span class="op">+</span></span>
<span id="cb34-129"><a href="commute-vehicle-miles-traveled.html#cb34-129"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb34-130"><a href="commute-vehicle-miles-traveled.html#cb34-130"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;% Car-dependent workers who carpool&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb34-131"><a href="commute-vehicle-miles-traveled.html#cb34-131"></a><span class="st">  </span><span class="kw">scale_color_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;County&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:county-modeshare"></span>
<img src="stockton_greeneconomy_files/figure-html/county-modeshare-1.png" alt="Percent of car-dependent commuters traveling by carpool, by county, 2011 to 2017. Data from LODES and ACS." width="672" />
<p class="caption">
Figure 2.18: Percent of car-dependent commuters traveling by carpool, by county, 2011 to 2017. Data from LODES and ACS.
</p>
</div>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="city-level-analysis-2" class="section level3" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> City-level Analysis</h3>
<p>The following graph shows the distribution of workplaces by distance from home for Stockton residents.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="commute-vehicle-miles-traveled.html#cb35-1"></a><span class="co"># for(year in 2011:2017){</span></span>
<span id="cb35-2"><a href="commute-vehicle-miles-traveled.html#cb35-2"></a><span class="co">#   </span></span>
<span id="cb35-3"><a href="commute-vehicle-miles-traveled.html#cb35-3"></a><span class="co">#   print(year)</span></span>
<span id="cb35-4"><a href="commute-vehicle-miles-traveled.html#cb35-4"></a><span class="co">#   </span></span>
<span id="cb35-5"><a href="commute-vehicle-miles-traveled.html#cb35-5"></a><span class="co">#   ca_lodes &lt;-</span></span>
<span id="cb35-6"><a href="commute-vehicle-miles-traveled.html#cb35-6"></a><span class="co">#     grab_lodes(</span></span>
<span id="cb35-7"><a href="commute-vehicle-miles-traveled.html#cb35-7"></a><span class="co">#       state = &quot;ca&quot;,</span></span>
<span id="cb35-8"><a href="commute-vehicle-miles-traveled.html#cb35-8"></a><span class="co">#       year = year,</span></span>
<span id="cb35-9"><a href="commute-vehicle-miles-traveled.html#cb35-9"></a><span class="co">#       lodes_type = &quot;od&quot;,</span></span>
<span id="cb35-10"><a href="commute-vehicle-miles-traveled.html#cb35-10"></a><span class="co">#       job_type = &quot;JT01&quot;, #Primary Jobs</span></span>
<span id="cb35-11"><a href="commute-vehicle-miles-traveled.html#cb35-11"></a><span class="co">#       segment = &quot;S000&quot;,</span></span>
<span id="cb35-12"><a href="commute-vehicle-miles-traveled.html#cb35-12"></a><span class="co">#       state_part = &quot;main&quot;,</span></span>
<span id="cb35-13"><a href="commute-vehicle-miles-traveled.html#cb35-13"></a><span class="co">#       agg_geo = &quot;bg&quot;</span></span>
<span id="cb35-14"><a href="commute-vehicle-miles-traveled.html#cb35-14"></a><span class="co">#     )</span></span>
<span id="cb35-15"><a href="commute-vehicle-miles-traveled.html#cb35-15"></a><span class="co">#   </span></span>
<span id="cb35-16"><a href="commute-vehicle-miles-traveled.html#cb35-16"></a><span class="co">#   stockton_lodes_h &lt;-</span></span>
<span id="cb35-17"><a href="commute-vehicle-miles-traveled.html#cb35-17"></a><span class="co">#     ca_lodes[which(ca_lodes$h_bg %in% stockton_bgs_full$GEOID),]</span></span>
<span id="cb35-18"><a href="commute-vehicle-miles-traveled.html#cb35-18"></a><span class="co">#   </span></span>
<span id="cb35-19"><a href="commute-vehicle-miles-traveled.html#cb35-19"></a><span class="co">#   stockton_lodes_h_origin_centroids &lt;-</span></span>
<span id="cb35-20"><a href="commute-vehicle-miles-traveled.html#cb35-20"></a><span class="co">#     st_centroid(ca_bgs[which(ca_bgs$GEOID %in% stockton_lodes_h$h_bg),])</span></span>
<span id="cb35-21"><a href="commute-vehicle-miles-traveled.html#cb35-21"></a><span class="co">#   </span></span>
<span id="cb35-22"><a href="commute-vehicle-miles-traveled.html#cb35-22"></a><span class="co">#   stockton_lodes_h_dest_centroids &lt;-</span></span>
<span id="cb35-23"><a href="commute-vehicle-miles-traveled.html#cb35-23"></a><span class="co">#     st_centroid(ca_bgs[which(ca_bgs$GEOID %in% stockton_lodes_h$w_bg),])</span></span>
<span id="cb35-24"><a href="commute-vehicle-miles-traveled.html#cb35-24"></a><span class="co">#   </span></span>
<span id="cb35-25"><a href="commute-vehicle-miles-traveled.html#cb35-25"></a><span class="co">#   route &lt;-</span></span>
<span id="cb35-26"><a href="commute-vehicle-miles-traveled.html#cb35-26"></a><span class="co">#     1:nrow(stockton_lodes_h) %&gt;%</span></span>
<span id="cb35-27"><a href="commute-vehicle-miles-traveled.html#cb35-27"></a><span class="co">#     map_dfr(function(row){</span></span>
<span id="cb35-28"><a href="commute-vehicle-miles-traveled.html#cb35-28"></a><span class="co">#       print(row)</span></span>
<span id="cb35-29"><a href="commute-vehicle-miles-traveled.html#cb35-29"></a><span class="co">#       route &lt;- osrmRoute(</span></span>
<span id="cb35-30"><a href="commute-vehicle-miles-traveled.html#cb35-30"></a><span class="co">#         src = stockton_lodes_h_origin_centroids[which(stockton_lodes_h_origin_centroids$GEOID %in% stockton_lodes_h[row,&quot;h_bg&quot;]),],</span></span>
<span id="cb35-31"><a href="commute-vehicle-miles-traveled.html#cb35-31"></a><span class="co">#         dst = stockton_lodes_h_dest_centroids[which(stockton_lodes_h_dest_centroids$GEOID %in% stockton_lodes_h[row,&quot;w_bg&quot;]),],</span></span>
<span id="cb35-32"><a href="commute-vehicle-miles-traveled.html#cb35-32"></a><span class="co">#         overview = FALSE</span></span>
<span id="cb35-33"><a href="commute-vehicle-miles-traveled.html#cb35-33"></a><span class="co">#       ) %&gt;%</span></span>
<span id="cb35-34"><a href="commute-vehicle-miles-traveled.html#cb35-34"></a><span class="co">#         as.list() %&gt;%</span></span>
<span id="cb35-35"><a href="commute-vehicle-miles-traveled.html#cb35-35"></a><span class="co">#         as.data.frame()</span></span>
<span id="cb35-36"><a href="commute-vehicle-miles-traveled.html#cb35-36"></a><span class="co">#       if(is_empty(route)){</span></span>
<span id="cb35-37"><a href="commute-vehicle-miles-traveled.html#cb35-37"></a><span class="co">#         return(</span></span>
<span id="cb35-38"><a href="commute-vehicle-miles-traveled.html#cb35-38"></a><span class="co">#           data.frame(</span></span>
<span id="cb35-39"><a href="commute-vehicle-miles-traveled.html#cb35-39"></a><span class="co">#             duration = NA,</span></span>
<span id="cb35-40"><a href="commute-vehicle-miles-traveled.html#cb35-40"></a><span class="co">#             distance = NA</span></span>
<span id="cb35-41"><a href="commute-vehicle-miles-traveled.html#cb35-41"></a><span class="co">#           )</span></span>
<span id="cb35-42"><a href="commute-vehicle-miles-traveled.html#cb35-42"></a><span class="co">#         )</span></span>
<span id="cb35-43"><a href="commute-vehicle-miles-traveled.html#cb35-43"></a><span class="co">#       } else {return(route)}</span></span>
<span id="cb35-44"><a href="commute-vehicle-miles-traveled.html#cb35-44"></a><span class="co">#     })</span></span>
<span id="cb35-45"><a href="commute-vehicle-miles-traveled.html#cb35-45"></a><span class="co">#   </span></span>
<span id="cb35-46"><a href="commute-vehicle-miles-traveled.html#cb35-46"></a><span class="co">#   stockton_lodes_h_route &lt;-</span></span>
<span id="cb35-47"><a href="commute-vehicle-miles-traveled.html#cb35-47"></a><span class="co">#     stockton_lodes_h %&gt;%</span></span>
<span id="cb35-48"><a href="commute-vehicle-miles-traveled.html#cb35-48"></a><span class="co">#     cbind(route)</span></span>
<span id="cb35-49"><a href="commute-vehicle-miles-traveled.html#cb35-49"></a><span class="co">#   </span></span>
<span id="cb35-50"><a href="commute-vehicle-miles-traveled.html#cb35-50"></a><span class="co">#   stockton_lodes_h_filter &lt;-</span></span>
<span id="cb35-51"><a href="commute-vehicle-miles-traveled.html#cb35-51"></a><span class="co">#     stockton_lodes_h_route %&gt;%</span></span>
<span id="cb35-52"><a href="commute-vehicle-miles-traveled.html#cb35-52"></a><span class="co">#     filter(duration &lt; 180)</span></span>
<span id="cb35-53"><a href="commute-vehicle-miles-traveled.html#cb35-53"></a><span class="co">#   </span></span>
<span id="cb35-54"><a href="commute-vehicle-miles-traveled.html#cb35-54"></a><span class="co">#   save(stockton_lodes_h_route,stockton_lodes_h_filter, file = paste0(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/stockton_lodes_&quot;,year,&quot;.Rdata&quot;))</span></span>
<span id="cb35-55"><a href="commute-vehicle-miles-traveled.html#cb35-55"></a><span class="co"># }</span></span>
<span id="cb35-56"><a href="commute-vehicle-miles-traveled.html#cb35-56"></a></span>
<span id="cb35-57"><a href="commute-vehicle-miles-traveled.html#cb35-57"></a><span class="kw">load</span>(<span class="st">&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/stockton_lodes_2017_tract.Rdata&quot;</span>)</span>
<span id="cb35-58"><a href="commute-vehicle-miles-traveled.html#cb35-58"></a></span>
<span id="cb35-59"><a href="commute-vehicle-miles-traveled.html#cb35-59"></a><span class="kw">ggplot</span>(</span>
<span id="cb35-60"><a href="commute-vehicle-miles-traveled.html#cb35-60"></a>  stockton_lodes_h_filter, </span>
<span id="cb35-61"><a href="commute-vehicle-miles-traveled.html#cb35-61"></a>  <span class="kw">aes</span>(</span>
<span id="cb35-62"><a href="commute-vehicle-miles-traveled.html#cb35-62"></a>    <span class="dt">x =</span> <span class="kw">as.numeric</span>(distance)<span class="op">/</span><span class="fl">1.60934</span>, </span>
<span id="cb35-63"><a href="commute-vehicle-miles-traveled.html#cb35-63"></a>    <span class="dt">weight =</span> S000</span>
<span id="cb35-64"><a href="commute-vehicle-miles-traveled.html#cb35-64"></a>  )</span>
<span id="cb35-65"><a href="commute-vehicle-miles-traveled.html#cb35-65"></a>) <span class="op">+</span></span>
<span id="cb35-66"><a href="commute-vehicle-miles-traveled.html#cb35-66"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">5</span>) <span class="op">+</span></span>
<span id="cb35-67"><a href="commute-vehicle-miles-traveled.html#cb35-67"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Workplace Commute Distance to Work for Stockton Employed Residents&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Commute Distance to Work, Miles&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Number of Residents&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:stockton-commute-vmt-distribution-2017"></span>
<img src="stockton_greeneconomy_files/figure-html/stockton-commute-vmt-distribution-2017-1.png" alt="Distribution of workplaces by distance from home for Stockton employed residents. Trips greater than 3 hours are removed. Data from LODES, 2017." width="672" />
<p class="caption">
Figure 2.19: Distribution of workplaces by distance from home for Stockton employed residents. Trips greater than 3 hours are removed. Data from LODES, 2017.
</p>
</div>
<p><span class="math inline">\(~\)</span></p>
<p>The map below demonstrates the extent of geographic spread of Stockton residents across the greater Northern California region, potentially on a day-to-day basis. Most of the tracts shown have only a handful of estimated Stockton workers, but interesting concentrations of workers can be seen by zooming in and hovering over areas like the East Bay.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="commute-vehicle-miles-traveled.html#cb36-1"></a>stockton_jobs_map &lt;-</span>
<span id="cb36-2"><a href="commute-vehicle-miles-traveled.html#cb36-2"></a><span class="st">  </span>stockton_lodes_h_filter <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb36-3"><a href="commute-vehicle-miles-traveled.html#cb36-3"></a><span class="st">  </span><span class="kw">group_by</span>(w_tract) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb36-4"><a href="commute-vehicle-miles-traveled.html#cb36-4"></a><span class="st">  </span><span class="kw">summarize</span>(</span>
<span id="cb36-5"><a href="commute-vehicle-miles-traveled.html#cb36-5"></a>    <span class="st">`</span><span class="dt">Jobs held by Stockton residents</span><span class="st">`</span> =<span class="st"> </span><span class="kw">sum</span>(S000, <span class="dt">na.rm=</span>T)</span>
<span id="cb36-6"><a href="commute-vehicle-miles-traveled.html#cb36-6"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb36-7"><a href="commute-vehicle-miles-traveled.html#cb36-7"></a><span class="st">  </span><span class="kw">left_join</span>(ca_tracts, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;w_tract&quot;</span> =<span class="st"> &quot;GEOID&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb36-8"><a href="commute-vehicle-miles-traveled.html#cb36-8"></a><span class="st">  </span><span class="kw">st_as_sf</span>()</span>
<span id="cb36-9"><a href="commute-vehicle-miles-traveled.html#cb36-9"></a></span>
<span id="cb36-10"><a href="commute-vehicle-miles-traveled.html#cb36-10"></a><span class="co"># map = mapview(stockton_jobs_map[,c(&quot;Jobs held by Stockton residents&quot;)], zcol = &quot;Jobs held by Stockton residents&quot;, col.regions = colorRampPalette(c(&quot;snow&quot;, &quot;black&quot;, &quot;grey&quot;)), map.types = c(&quot;OpenStreetMap&quot;), legend = TRUE, layer.name = &#39;Jobs held by&lt;/br&gt;Stockton residents&#39;)</span></span>
<span id="cb36-11"><a href="commute-vehicle-miles-traveled.html#cb36-11"></a><span class="co"># </span></span>
<span id="cb36-12"><a href="commute-vehicle-miles-traveled.html#cb36-12"></a><span class="co"># mapshot(map,url=&quot;map-stockton-jobs-map.html&quot;)</span></span>
<span id="cb36-13"><a href="commute-vehicle-miles-traveled.html#cb36-13"></a></span>
<span id="cb36-14"><a href="commute-vehicle-miles-traveled.html#cb36-14"></a>knitr<span class="op">::</span><span class="kw">include_url</span>(<span class="st">&quot;https://city.systems/stockton-greeneconomy/map-stockton-jobs-map.html&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:stockton-jobs-map"></span>
<iframe src="https://city.systems/stockton-greeneconomy/map-stockton-jobs-map.html" width="672" height="400px">
</iframe>
<p class="caption">
Figure 2.20: Tracts where Stockton residents work - number of jobs. Data from LODES, 2017.
</p>
</div>
<p><span class="math inline">\(~\)</span></p>
<p>The previous map can be considered in combination with the map below, which essentially shows the average distance in miles traveled one-way by Stockton workers to those tracts. Evidently, workers traveling to further-away tracts are responsible for a disproportionate share of the transportation emissions compared to other Stockton workers.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="commute-vehicle-miles-traveled.html#cb37-1"></a>stockton_commute_avg &lt;-</span>
<span id="cb37-2"><a href="commute-vehicle-miles-traveled.html#cb37-2"></a><span class="st">  </span>stockton_lodes_h_filter <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb37-3"><a href="commute-vehicle-miles-traveled.html#cb37-3"></a><span class="st">  </span><span class="kw">group_by</span>(w_tract) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb37-4"><a href="commute-vehicle-miles-traveled.html#cb37-4"></a><span class="st">  </span><span class="kw">summarize</span>(</span>
<span id="cb37-5"><a href="commute-vehicle-miles-traveled.html#cb37-5"></a>    <span class="st">`</span><span class="dt">Average Commute Time, Hours</span><span class="st">`</span> =<span class="st"> </span><span class="kw">mean</span>(duration, <span class="dt">na.rm=</span>T)</span>
<span id="cb37-6"><a href="commute-vehicle-miles-traveled.html#cb37-6"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb37-7"><a href="commute-vehicle-miles-traveled.html#cb37-7"></a><span class="st">  </span><span class="kw">left_join</span>(ca_tracts, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;w_tract&quot;</span> =<span class="st"> &quot;GEOID&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb37-8"><a href="commute-vehicle-miles-traveled.html#cb37-8"></a><span class="st">  </span><span class="kw">st_as_sf</span>()</span>
<span id="cb37-9"><a href="commute-vehicle-miles-traveled.html#cb37-9"></a></span>
<span id="cb37-10"><a href="commute-vehicle-miles-traveled.html#cb37-10"></a><span class="co"># map = mapview(stockton_commute_avg[,c(&quot;Average Commute Time, Hours&quot;)], zcol = &quot;Average Commute Time, Hours&quot;, map.types = c(&quot;OpenStreetMap&quot;), legend = TRUE, layer.name = &#39;Average Commute&lt;/br&gt;Time, Hours&#39;)</span></span>
<span id="cb37-11"><a href="commute-vehicle-miles-traveled.html#cb37-11"></a><span class="co"># </span></span>
<span id="cb37-12"><a href="commute-vehicle-miles-traveled.html#cb37-12"></a><span class="co"># mapshot(map,url=&quot;map-stockton-commute-avg.html&quot;)</span></span>
<span id="cb37-13"><a href="commute-vehicle-miles-traveled.html#cb37-13"></a></span>
<span id="cb37-14"><a href="commute-vehicle-miles-traveled.html#cb37-14"></a>knitr<span class="op">::</span><span class="kw">include_url</span>(<span class="st">&quot;https://city.systems/stockton-greeneconomy/map-stockton-commute-avg.html&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:stockton-commute-avg"></span>
<iframe src="https://city.systems/stockton-greeneconomy/map-stockton-commute-avg.html" width="672" height="400px">
</iframe>
<p class="caption">
Figure 2.21: Tracts where Stockton residents work - average commute time, in hours. Data from LODES, 2017.
</p>
</div>
<p><span class="math inline">\(~\)</span></p>
<p>Similar to the county-level analysis, we calculated the change in VMT/job over time, which might give more important relative insight given the many assumptions that go into the specific quantity of VMTs in any given year.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="commute-vehicle-miles-traveled.html#cb38-1"></a><span class="kw">load</span>(<span class="st">&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/stockton_commute_vmt_tractmode.Rdata&quot;</span>)</span>
<span id="cb38-2"><a href="commute-vehicle-miles-traveled.html#cb38-2"></a></span>
<span id="cb38-3"><a href="commute-vehicle-miles-traveled.html#cb38-3"></a>stockton_commute_vmt_tractmode_table &lt;-</span>
<span id="cb38-4"><a href="commute-vehicle-miles-traveled.html#cb38-4"></a><span class="st">  </span>stockton_commute_vmt_tractmode <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb38-5"><a href="commute-vehicle-miles-traveled.html#cb38-5"></a><span class="st">  </span><span class="kw">transmute</span>(</span>
<span id="cb38-6"><a href="commute-vehicle-miles-traveled.html#cb38-6"></a>    <span class="dt">Year =</span> Year,</span>
<span id="cb38-7"><a href="commute-vehicle-miles-traveled.html#cb38-7"></a>    <span class="st">`</span><span class="dt">Commute One-Way VMT</span><span class="st">`</span> =<span class="st"> </span><span class="kw">prettyNum</span>(<span class="kw">round</span>(vmt,<span class="op">-</span><span class="dv">3</span>), <span class="dt">big.mark=</span><span class="st">&quot;,&quot;</span>),</span>
<span id="cb38-8"><a href="commute-vehicle-miles-traveled.html#cb38-8"></a>    <span class="st">`</span><span class="dt">Workers</span><span class="st">`</span> =<span class="st"> </span><span class="kw">prettyNum</span>(<span class="kw">round</span>(jobs,<span class="op">-</span><span class="dv">3</span>), <span class="dt">big.mark=</span><span class="st">&quot;,&quot;</span>),</span>
<span id="cb38-9"><a href="commute-vehicle-miles-traveled.html#cb38-9"></a>    <span class="st">`</span><span class="dt">One-Way VMT/Workers</span><span class="st">`</span> =<span class="st"> </span><span class="kw">round</span>(vmt<span class="op">/</span>jobs_car,<span class="dv">1</span>),</span>
<span id="cb38-10"><a href="commute-vehicle-miles-traveled.html#cb38-10"></a>    <span class="st">`</span><span class="dt">% Car-Dependent Workers who Carpool</span><span class="st">`</span> =<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">round</span>(jobs_carpool<span class="op">/</span>jobs_car<span class="op">*</span><span class="dv">100</span>,<span class="dv">1</span>),<span class="st">&quot;%&quot;</span>)</span>
<span id="cb38-11"><a href="commute-vehicle-miles-traveled.html#cb38-11"></a>  )</span>
<span id="cb38-12"><a href="commute-vehicle-miles-traveled.html#cb38-12"></a></span>
<span id="cb38-13"><a href="commute-vehicle-miles-traveled.html#cb38-13"></a><span class="kw">kable</span>(</span>
<span id="cb38-14"><a href="commute-vehicle-miles-traveled.html#cb38-14"></a>  stockton_commute_vmt_tractmode_table,</span>
<span id="cb38-15"><a href="commute-vehicle-miles-traveled.html#cb38-15"></a>  <span class="dt">booktabs =</span> <span class="ot">TRUE</span>,</span>
<span id="cb38-16"><a href="commute-vehicle-miles-traveled.html#cb38-16"></a>  <span class="dt">caption =</span> <span class="st">&#39;Stockton commute one-way VMT from 2011-2017. Data from LODES and ACS 1-yr.&#39;</span></span>
<span id="cb38-17"><a href="commute-vehicle-miles-traveled.html#cb38-17"></a>) <span class="op">%&gt;%</span></span>
<span id="cb38-18"><a href="commute-vehicle-miles-traveled.html#cb38-18"></a><span class="st">  </span><span class="kw">kable_styling</span>() <span class="op">%&gt;%</span></span>
<span id="cb38-19"><a href="commute-vehicle-miles-traveled.html#cb38-19"></a><span class="st">  </span><span class="kw">scroll_box</span>(<span class="dt">width =</span> <span class="st">&quot;100%&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:stockton-commute-vmt-table">Table 2.16: </span>Stockton commute one-way VMT from 2011-2017. Data from LODES and ACS 1-yr.
</caption>
<thead>
<tr>
<th style="text-align:right;">
Year
</th>
<th style="text-align:left;">
Commute One-Way VMT
</th>
<th style="text-align:left;">
Workers
</th>
<th style="text-align:right;">
One-Way VMT/Workers
</th>
<th style="text-align:left;">
% Car-Dependent Workers who Carpool
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2011
</td>
<td style="text-align:left;">
1,837,000
</td>
<td style="text-align:left;">
98,000
</td>
<td style="text-align:right;">
20.3
</td>
<td style="text-align:left;">
18.2%
</td>
</tr>
<tr>
<td style="text-align:right;">
2012
</td>
<td style="text-align:left;">
1,932,000
</td>
<td style="text-align:left;">
99,000
</td>
<td style="text-align:right;">
20.9
</td>
<td style="text-align:left;">
18.3%
</td>
</tr>
<tr>
<td style="text-align:right;">
2013
</td>
<td style="text-align:left;">
1,979,000
</td>
<td style="text-align:left;">
102,000
</td>
<td style="text-align:right;">
20.9
</td>
<td style="text-align:left;">
19%
</td>
</tr>
<tr>
<td style="text-align:right;">
2014
</td>
<td style="text-align:left;">
2,228,000
</td>
<td style="text-align:left;">
108,000
</td>
<td style="text-align:right;">
22.0
</td>
<td style="text-align:left;">
20.1%
</td>
</tr>
<tr>
<td style="text-align:right;">
2015
</td>
<td style="text-align:left;">
2,226,000
</td>
<td style="text-align:left;">
114,000
</td>
<td style="text-align:right;">
21.0
</td>
<td style="text-align:left;">
20.2%
</td>
</tr>
<tr>
<td style="text-align:right;">
2016
</td>
<td style="text-align:left;">
2,389,000
</td>
<td style="text-align:left;">
119,000
</td>
<td style="text-align:right;">
21.5
</td>
<td style="text-align:left;">
19.8%
</td>
</tr>
<tr>
<td style="text-align:right;">
2017
</td>
<td style="text-align:left;">
2,635,000
</td>
<td style="text-align:left;">
123,000
</td>
<td style="text-align:right;">
23.0
</td>
<td style="text-align:left;">
18.8%
</td>
</tr>
</tbody>
</table>
</div>
<p><span class="math inline">\(~\)</span></p>
<p>The average one-way commute trip for the Stockton worker appears to have increased by 13% over the last 6 years. This could be explained by existing residents changing to jobs that are further and further away from home, where better employment opportunities can be found, and by new residents moving to Stockton to find affordable housing but retaining their faraway jobs.</p>
<p>The following figure compares Stockton and SJC VMT/job. The trends are similar, though Stockton residents commute less distance than SJC residents overall.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="commute-vehicle-miles-traveled.html#cb39-1"></a><span class="co"># stockton_commute_vmt_bgmode &lt;- NULL</span></span>
<span id="cb39-2"><a href="commute-vehicle-miles-traveled.html#cb39-2"></a><span class="co"># </span></span>
<span id="cb39-3"><a href="commute-vehicle-miles-traveled.html#cb39-3"></a><span class="co"># for(year in 2011:2017){</span></span>
<span id="cb39-4"><a href="commute-vehicle-miles-traveled.html#cb39-4"></a><span class="co">#     print(year)</span></span>
<span id="cb39-5"><a href="commute-vehicle-miles-traveled.html#cb39-5"></a><span class="co"># </span></span>
<span id="cb39-6"><a href="commute-vehicle-miles-traveled.html#cb39-6"></a><span class="co">#     load(paste0(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/stockton_lodes_&quot;,year,&quot;.Rdata&quot;))</span></span>
<span id="cb39-7"><a href="commute-vehicle-miles-traveled.html#cb39-7"></a><span class="co"># </span></span>
<span id="cb39-8"><a href="commute-vehicle-miles-traveled.html#cb39-8"></a><span class="co">#     load(paste0(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/acs5_vars_&quot;,year,&quot;.Rdata&quot;))</span></span>
<span id="cb39-9"><a href="commute-vehicle-miles-traveled.html#cb39-9"></a><span class="co"># </span></span>
<span id="cb39-10"><a href="commute-vehicle-miles-traveled.html#cb39-10"></a><span class="co">#     travel_time_mode &lt;-</span></span>
<span id="cb39-11"><a href="commute-vehicle-miles-traveled.html#cb39-11"></a><span class="co">#       getCensus(</span></span>
<span id="cb39-12"><a href="commute-vehicle-miles-traveled.html#cb39-12"></a><span class="co">#         name = &quot;acs/acs5&quot;,</span></span>
<span id="cb39-13"><a href="commute-vehicle-miles-traveled.html#cb39-13"></a><span class="co">#         vintage = ifelse(</span></span>
<span id="cb39-14"><a href="commute-vehicle-miles-traveled.html#cb39-14"></a><span class="co">#           year &lt; 2013,</span></span>
<span id="cb39-15"><a href="commute-vehicle-miles-traveled.html#cb39-15"></a><span class="co">#           2013,</span></span>
<span id="cb39-16"><a href="commute-vehicle-miles-traveled.html#cb39-16"></a><span class="co">#           year</span></span>
<span id="cb39-17"><a href="commute-vehicle-miles-traveled.html#cb39-17"></a><span class="co">#         ),</span></span>
<span id="cb39-18"><a href="commute-vehicle-miles-traveled.html#cb39-18"></a><span class="co">#         region = &quot;block group:*&quot;,</span></span>
<span id="cb39-19"><a href="commute-vehicle-miles-traveled.html#cb39-19"></a><span class="co">#         regionin = &quot;state:06+county:077&quot;,</span></span>
<span id="cb39-20"><a href="commute-vehicle-miles-traveled.html#cb39-20"></a><span class="co">#         vars = &quot;group(B08134)&quot;</span></span>
<span id="cb39-21"><a href="commute-vehicle-miles-traveled.html#cb39-21"></a><span class="co">#       ) %&gt;%</span></span>
<span id="cb39-22"><a href="commute-vehicle-miles-traveled.html#cb39-22"></a><span class="co">#       mutate(bg = paste0(state,county,tract,block_group)) %&gt;%</span></span>
<span id="cb39-23"><a href="commute-vehicle-miles-traveled.html#cb39-23"></a><span class="co">#       select_if(!names(.) %in% c(&quot;GEO_ID&quot;,&quot;state&quot;,&quot;county&quot;,&quot;tract&quot;,&quot;block_group&quot;,&quot;NAME&quot;)) %&gt;%</span></span>
<span id="cb39-24"><a href="commute-vehicle-miles-traveled.html#cb39-24"></a><span class="co">#       dplyr::select(-c(contains(&quot;EA&quot;),contains(&quot;MA&quot;),contains(&quot;M&quot;))) %&gt;%</span></span>
<span id="cb39-25"><a href="commute-vehicle-miles-traveled.html#cb39-25"></a><span class="co">#       gather(</span></span>
<span id="cb39-26"><a href="commute-vehicle-miles-traveled.html#cb39-26"></a><span class="co">#         key = &quot;variable&quot;,</span></span>
<span id="cb39-27"><a href="commute-vehicle-miles-traveled.html#cb39-27"></a><span class="co">#         value = &quot;estimate&quot;,</span></span>
<span id="cb39-28"><a href="commute-vehicle-miles-traveled.html#cb39-28"></a><span class="co">#         -bg</span></span>
<span id="cb39-29"><a href="commute-vehicle-miles-traveled.html#cb39-29"></a><span class="co">#       ) %&gt;%</span></span>
<span id="cb39-30"><a href="commute-vehicle-miles-traveled.html#cb39-30"></a><span class="co">#       mutate(</span></span>
<span id="cb39-31"><a href="commute-vehicle-miles-traveled.html#cb39-31"></a><span class="co">#         label = acs_vars$label[match(variable,acs_vars$name)],</span></span>
<span id="cb39-32"><a href="commute-vehicle-miles-traveled.html#cb39-32"></a><span class="co">#         time = # This extracts only the time information from our label.</span></span>
<span id="cb39-33"><a href="commute-vehicle-miles-traveled.html#cb39-33"></a><span class="co">#           substr(</span></span>
<span id="cb39-34"><a href="commute-vehicle-miles-traveled.html#cb39-34"></a><span class="co">#             label,</span></span>
<span id="cb39-35"><a href="commute-vehicle-miles-traveled.html#cb39-35"></a><span class="co">#             lapply(</span></span>
<span id="cb39-36"><a href="commute-vehicle-miles-traveled.html#cb39-36"></a><span class="co">#               label,</span></span>
<span id="cb39-37"><a href="commute-vehicle-miles-traveled.html#cb39-37"></a><span class="co">#               function(x){</span></span>
<span id="cb39-38"><a href="commute-vehicle-miles-traveled.html#cb39-38"></a><span class="co">#                 ifelse(</span></span>
<span id="cb39-39"><a href="commute-vehicle-miles-traveled.html#cb39-39"></a><span class="co">#                   length(unlist(gregexpr(&#39;!!&#39;,x)))&lt;3,</span></span>
<span id="cb39-40"><a href="commute-vehicle-miles-traveled.html#cb39-40"></a><span class="co">#                   NA,</span></span>
<span id="cb39-41"><a href="commute-vehicle-miles-traveled.html#cb39-41"></a><span class="co">#                   max(unlist(gregexpr(&#39;!!&#39;,x)))+2</span></span>
<span id="cb39-42"><a href="commute-vehicle-miles-traveled.html#cb39-42"></a><span class="co">#                 )</span></span>
<span id="cb39-43"><a href="commute-vehicle-miles-traveled.html#cb39-43"></a><span class="co">#               }</span></span>
<span id="cb39-44"><a href="commute-vehicle-miles-traveled.html#cb39-44"></a><span class="co">#             ),</span></span>
<span id="cb39-45"><a href="commute-vehicle-miles-traveled.html#cb39-45"></a><span class="co">#             nchar(label)</span></span>
<span id="cb39-46"><a href="commute-vehicle-miles-traveled.html#cb39-46"></a><span class="co">#           ),</span></span>
<span id="cb39-47"><a href="commute-vehicle-miles-traveled.html#cb39-47"></a><span class="co">#         mode = # This extracts only the mode information from our label. It doesn&#39;t fully deal with double-counting, so some are further removed later on in a filter.</span></span>
<span id="cb39-48"><a href="commute-vehicle-miles-traveled.html#cb39-48"></a><span class="co">#           substr(</span></span>
<span id="cb39-49"><a href="commute-vehicle-miles-traveled.html#cb39-49"></a><span class="co">#             label,</span></span>
<span id="cb39-50"><a href="commute-vehicle-miles-traveled.html#cb39-50"></a><span class="co">#             lapply(</span></span>
<span id="cb39-51"><a href="commute-vehicle-miles-traveled.html#cb39-51"></a><span class="co">#               label,</span></span>
<span id="cb39-52"><a href="commute-vehicle-miles-traveled.html#cb39-52"></a><span class="co">#               function(x){</span></span>
<span id="cb39-53"><a href="commute-vehicle-miles-traveled.html#cb39-53"></a><span class="co">#                 ifelse(</span></span>
<span id="cb39-54"><a href="commute-vehicle-miles-traveled.html#cb39-54"></a><span class="co">#                   length(unlist(gregexpr(&#39;!!&#39;,x)))&lt;3,</span></span>
<span id="cb39-55"><a href="commute-vehicle-miles-traveled.html#cb39-55"></a><span class="co">#                   NA,</span></span>
<span id="cb39-56"><a href="commute-vehicle-miles-traveled.html#cb39-56"></a><span class="co">#                   unlist(gregexpr(&#39;!!&#39;,x))[length(unlist(gregexpr(&#39;!!&#39;,x)))-1]+2</span></span>
<span id="cb39-57"><a href="commute-vehicle-miles-traveled.html#cb39-57"></a><span class="co">#                 )</span></span>
<span id="cb39-58"><a href="commute-vehicle-miles-traveled.html#cb39-58"></a><span class="co">#               }</span></span>
<span id="cb39-59"><a href="commute-vehicle-miles-traveled.html#cb39-59"></a><span class="co">#             ),</span></span>
<span id="cb39-60"><a href="commute-vehicle-miles-traveled.html#cb39-60"></a><span class="co">#             lapply(</span></span>
<span id="cb39-61"><a href="commute-vehicle-miles-traveled.html#cb39-61"></a><span class="co">#               label,</span></span>
<span id="cb39-62"><a href="commute-vehicle-miles-traveled.html#cb39-62"></a><span class="co">#               function(x){</span></span>
<span id="cb39-63"><a href="commute-vehicle-miles-traveled.html#cb39-63"></a><span class="co">#                 max(unlist(gregexpr(&#39;!!&#39;,x)))-1</span></span>
<span id="cb39-64"><a href="commute-vehicle-miles-traveled.html#cb39-64"></a><span class="co">#               }</span></span>
<span id="cb39-65"><a href="commute-vehicle-miles-traveled.html#cb39-65"></a><span class="co">#             )</span></span>
<span id="cb39-66"><a href="commute-vehicle-miles-traveled.html#cb39-66"></a><span class="co">#           )</span></span>
<span id="cb39-67"><a href="commute-vehicle-miles-traveled.html#cb39-67"></a><span class="co">#       ) %&gt;%</span></span>
<span id="cb39-68"><a href="commute-vehicle-miles-traveled.html#cb39-68"></a><span class="co">#       filter(!is.na(time)) %&gt;% # This removes the grand total rows that are usually at the top of the ACS data.</span></span>
<span id="cb39-69"><a href="commute-vehicle-miles-traveled.html#cb39-69"></a><span class="co">#       filter(!mode %in% c(&quot;Car, truck, or van&quot;,&quot;Car truck or van&quot;,&quot;Carpooled&quot;,&quot;Public transportation (excluding taxicab)&quot;)) %&gt;% # This removes double-counted subtotals.</span></span>
<span id="cb39-70"><a href="commute-vehicle-miles-traveled.html#cb39-70"></a><span class="co">#       dplyr::select(-variable,-label)</span></span>
<span id="cb39-71"><a href="commute-vehicle-miles-traveled.html#cb39-71"></a><span class="co"># </span></span>
<span id="cb39-72"><a href="commute-vehicle-miles-traveled.html#cb39-72"></a><span class="co">#     travel_time_mode_summary &lt;-</span></span>
<span id="cb39-73"><a href="commute-vehicle-miles-traveled.html#cb39-73"></a><span class="co">#       travel_time_mode %&gt;%</span></span>
<span id="cb39-74"><a href="commute-vehicle-miles-traveled.html#cb39-74"></a><span class="co">#       group_by(bg,time) %&gt;%</span></span>
<span id="cb39-75"><a href="commute-vehicle-miles-traveled.html#cb39-75"></a><span class="co">#       summarize(</span></span>
<span id="cb39-76"><a href="commute-vehicle-miles-traveled.html#cb39-76"></a><span class="co">#         jobs = sum(estimate),</span></span>
<span id="cb39-77"><a href="commute-vehicle-miles-traveled.html#cb39-77"></a><span class="co">#         jobs_drovealone = sum(estimate[which(mode == &quot;Drove alone&quot;)]),</span></span>
<span id="cb39-78"><a href="commute-vehicle-miles-traveled.html#cb39-78"></a><span class="co">#         jobs_carpool2 = sum(estimate[which(mode == &quot;In 2-person carpool&quot;)]),</span></span>
<span id="cb39-79"><a href="commute-vehicle-miles-traveled.html#cb39-79"></a><span class="co">#         jobs_carpool3 = sum(estimate[which(mode == &quot;In 3-or-more-person carpool&quot;)]),</span></span>
<span id="cb39-80"><a href="commute-vehicle-miles-traveled.html#cb39-80"></a><span class="co">#       ) %&gt;%</span></span>
<span id="cb39-81"><a href="commute-vehicle-miles-traveled.html#cb39-81"></a><span class="co">#       mutate(</span></span>
<span id="cb39-82"><a href="commute-vehicle-miles-traveled.html#cb39-82"></a><span class="co">#         vehicles_drovealone = jobs_drovealone,</span></span>
<span id="cb39-83"><a href="commute-vehicle-miles-traveled.html#cb39-83"></a><span class="co">#         vehicles_carpool2 = jobs_carpool2/2,</span></span>
<span id="cb39-84"><a href="commute-vehicle-miles-traveled.html#cb39-84"></a><span class="co">#         vehicles_carpool3 = jobs_carpool3/3,</span></span>
<span id="cb39-85"><a href="commute-vehicle-miles-traveled.html#cb39-85"></a><span class="co">#         jobs_car = jobs_drovealone+jobs_carpool2+jobs_carpool3,</span></span>
<span id="cb39-86"><a href="commute-vehicle-miles-traveled.html#cb39-86"></a><span class="co">#         jobs_carpool = jobs_carpool2+jobs_carpool3,</span></span>
<span id="cb39-87"><a href="commute-vehicle-miles-traveled.html#cb39-87"></a><span class="co">#         vehicles = vehicles_drovealone,vehicles_carpool2,vehicles_carpool3,</span></span>
<span id="cb39-88"><a href="commute-vehicle-miles-traveled.html#cb39-88"></a><span class="co">#         perc_jobs_car = jobs_car/jobs,</span></span>
<span id="cb39-89"><a href="commute-vehicle-miles-traveled.html#cb39-89"></a><span class="co">#         perc_jobs_carpool = jobs_carpool/jobs,</span></span>
<span id="cb39-90"><a href="commute-vehicle-miles-traveled.html#cb39-90"></a><span class="co">#         perc_vehicle = vehicles/jobs</span></span>
<span id="cb39-91"><a href="commute-vehicle-miles-traveled.html#cb39-91"></a><span class="co">#       )</span></span>
<span id="cb39-92"><a href="commute-vehicle-miles-traveled.html#cb39-92"></a><span class="co"># </span></span>
<span id="cb39-93"><a href="commute-vehicle-miles-traveled.html#cb39-93"></a><span class="co">#   stockton_lodes_h_mode &lt;-</span></span>
<span id="cb39-94"><a href="commute-vehicle-miles-traveled.html#cb39-94"></a><span class="co">#     stockton_lodes_h_filter %&gt;%</span></span>
<span id="cb39-95"><a href="commute-vehicle-miles-traveled.html#cb39-95"></a><span class="co">#     transmute(</span></span>
<span id="cb39-96"><a href="commute-vehicle-miles-traveled.html#cb39-96"></a><span class="co">#       residence = h_bg,</span></span>
<span id="cb39-97"><a href="commute-vehicle-miles-traveled.html#cb39-97"></a><span class="co">#       jobs = S000,</span></span>
<span id="cb39-98"><a href="commute-vehicle-miles-traveled.html#cb39-98"></a><span class="co">#       duration = duration,</span></span>
<span id="cb39-99"><a href="commute-vehicle-miles-traveled.html#cb39-99"></a><span class="co">#       person_miles = S000*as.numeric(distance)/1.60934,</span></span>
<span id="cb39-100"><a href="commute-vehicle-miles-traveled.html#cb39-100"></a><span class="co">#       person_hours = S000*as.numeric(duration)/60</span></span>
<span id="cb39-101"><a href="commute-vehicle-miles-traveled.html#cb39-101"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb39-102"><a href="commute-vehicle-miles-traveled.html#cb39-102"></a><span class="co">#     mutate(</span></span>
<span id="cb39-103"><a href="commute-vehicle-miles-traveled.html#cb39-103"></a><span class="co">#       tier =</span></span>
<span id="cb39-104"><a href="commute-vehicle-miles-traveled.html#cb39-104"></a><span class="co">#         case_when(</span></span>
<span id="cb39-105"><a href="commute-vehicle-miles-traveled.html#cb39-105"></a><span class="co">#           duration &lt; 10 ~ &quot;Less than 10 minutes&quot;,</span></span>
<span id="cb39-106"><a href="commute-vehicle-miles-traveled.html#cb39-106"></a><span class="co">#           duration &lt; 15 ~ &quot;10 to 14 minutes&quot;,</span></span>
<span id="cb39-107"><a href="commute-vehicle-miles-traveled.html#cb39-107"></a><span class="co">#           duration &lt; 20 ~ &quot;15 to 19 minutes&quot;,</span></span>
<span id="cb39-108"><a href="commute-vehicle-miles-traveled.html#cb39-108"></a><span class="co">#           duration &lt; 25 ~ &quot;20 to 24 minutes&quot;,</span></span>
<span id="cb39-109"><a href="commute-vehicle-miles-traveled.html#cb39-109"></a><span class="co">#           duration &lt; 30 ~ &quot;25 to 29 minutes&quot;,</span></span>
<span id="cb39-110"><a href="commute-vehicle-miles-traveled.html#cb39-110"></a><span class="co">#           duration &lt; 35 ~ &quot;30 to 34 minutes&quot;,</span></span>
<span id="cb39-111"><a href="commute-vehicle-miles-traveled.html#cb39-111"></a><span class="co">#           duration &lt; 45 ~ &quot;35 to 44 minutes&quot;,</span></span>
<span id="cb39-112"><a href="commute-vehicle-miles-traveled.html#cb39-112"></a><span class="co">#           duration &lt; 60 ~ &quot;45 to 59 minutes&quot;,</span></span>
<span id="cb39-113"><a href="commute-vehicle-miles-traveled.html#cb39-113"></a><span class="co">#           TRUE ~ &quot;60 or more minutes&quot;</span></span>
<span id="cb39-114"><a href="commute-vehicle-miles-traveled.html#cb39-114"></a><span class="co">#         )</span></span>
<span id="cb39-115"><a href="commute-vehicle-miles-traveled.html#cb39-115"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb39-116"><a href="commute-vehicle-miles-traveled.html#cb39-116"></a><span class="co">#     left_join(</span></span>
<span id="cb39-117"><a href="commute-vehicle-miles-traveled.html#cb39-117"></a><span class="co">#       travel_time_mode_summary %&gt;%</span></span>
<span id="cb39-118"><a href="commute-vehicle-miles-traveled.html#cb39-118"></a><span class="co">#         dplyr::select(</span></span>
<span id="cb39-119"><a href="commute-vehicle-miles-traveled.html#cb39-119"></a><span class="co">#           bg,</span></span>
<span id="cb39-120"><a href="commute-vehicle-miles-traveled.html#cb39-120"></a><span class="co">#           time,</span></span>
<span id="cb39-121"><a href="commute-vehicle-miles-traveled.html#cb39-121"></a><span class="co">#           perc_jobs_car,</span></span>
<span id="cb39-122"><a href="commute-vehicle-miles-traveled.html#cb39-122"></a><span class="co">#           perc_jobs_carpool,</span></span>
<span id="cb39-123"><a href="commute-vehicle-miles-traveled.html#cb39-123"></a><span class="co">#           perc_vehicle</span></span>
<span id="cb39-124"><a href="commute-vehicle-miles-traveled.html#cb39-124"></a><span class="co">#         ),</span></span>
<span id="cb39-125"><a href="commute-vehicle-miles-traveled.html#cb39-125"></a><span class="co">#       by = c(&quot;residence&quot; = &quot;bg&quot;, &quot;tier&quot; = &quot;time&quot;)</span></span>
<span id="cb39-126"><a href="commute-vehicle-miles-traveled.html#cb39-126"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb39-127"><a href="commute-vehicle-miles-traveled.html#cb39-127"></a><span class="co">#     mutate(</span></span>
<span id="cb39-128"><a href="commute-vehicle-miles-traveled.html#cb39-128"></a><span class="co">#       jobs_car = jobs*perc_jobs_car,</span></span>
<span id="cb39-129"><a href="commute-vehicle-miles-traveled.html#cb39-129"></a><span class="co">#       jobs_carpool = jobs*perc_jobs_carpool,</span></span>
<span id="cb39-130"><a href="commute-vehicle-miles-traveled.html#cb39-130"></a><span class="co">#       vehicles = jobs*perc_vehicle,</span></span>
<span id="cb39-131"><a href="commute-vehicle-miles-traveled.html#cb39-131"></a><span class="co">#       vmt = person_miles*perc_vehicle</span></span>
<span id="cb39-132"><a href="commute-vehicle-miles-traveled.html#cb39-132"></a><span class="co">#     )</span></span>
<span id="cb39-133"><a href="commute-vehicle-miles-traveled.html#cb39-133"></a><span class="co"># </span></span>
<span id="cb39-134"><a href="commute-vehicle-miles-traveled.html#cb39-134"></a><span class="co">#     stockton_commute_vmt_bgmode &lt;-</span></span>
<span id="cb39-135"><a href="commute-vehicle-miles-traveled.html#cb39-135"></a><span class="co">#       rbind(stockton_commute_vmt_bgmode,</span></span>
<span id="cb39-136"><a href="commute-vehicle-miles-traveled.html#cb39-136"></a><span class="co">#         data.frame(</span></span>
<span id="cb39-137"><a href="commute-vehicle-miles-traveled.html#cb39-137"></a><span class="co">#           Year = year,</span></span>
<span id="cb39-138"><a href="commute-vehicle-miles-traveled.html#cb39-138"></a><span class="co">#           person_miles = sum(stockton_lodes_h_mode$person_miles, na.rm=T),</span></span>
<span id="cb39-139"><a href="commute-vehicle-miles-traveled.html#cb39-139"></a><span class="co">#           jobs = sum(stockton_lodes_h_mode$jobs, na.rm=T),</span></span>
<span id="cb39-140"><a href="commute-vehicle-miles-traveled.html#cb39-140"></a><span class="co">#           jobs_car = sum(stockton_lodes_h_mode$jobs_car, na.rm=T),</span></span>
<span id="cb39-141"><a href="commute-vehicle-miles-traveled.html#cb39-141"></a><span class="co">#           jobs_carpool = sum(stockton_lodes_h_mode$jobs_carpool, na.rm=T),</span></span>
<span id="cb39-142"><a href="commute-vehicle-miles-traveled.html#cb39-142"></a><span class="co">#           vehicles = sum(stockton_lodes_h_mode$vehicles, na.rm = T),</span></span>
<span id="cb39-143"><a href="commute-vehicle-miles-traveled.html#cb39-143"></a><span class="co">#           vmt = sum(stockton_lodes_h_mode$vmt, na.rm=T)</span></span>
<span id="cb39-144"><a href="commute-vehicle-miles-traveled.html#cb39-144"></a><span class="co">#         )</span></span>
<span id="cb39-145"><a href="commute-vehicle-miles-traveled.html#cb39-145"></a><span class="co">#       )</span></span>
<span id="cb39-146"><a href="commute-vehicle-miles-traveled.html#cb39-146"></a><span class="co"># </span></span>
<span id="cb39-147"><a href="commute-vehicle-miles-traveled.html#cb39-147"></a><span class="co">#     save(stockton_commute_vmt_bgmode,file = &quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/stockton_commute_vmt_bgmode.Rdata&quot;)</span></span>
<span id="cb39-148"><a href="commute-vehicle-miles-traveled.html#cb39-148"></a><span class="co"># }</span></span>
<span id="cb39-149"><a href="commute-vehicle-miles-traveled.html#cb39-149"></a><span class="co">#</span></span>
<span id="cb39-150"><a href="commute-vehicle-miles-traveled.html#cb39-150"></a><span class="co"># stockton_commute_vmt_tractmode &lt;- NULL</span></span>
<span id="cb39-151"><a href="commute-vehicle-miles-traveled.html#cb39-151"></a><span class="co"># </span></span>
<span id="cb39-152"><a href="commute-vehicle-miles-traveled.html#cb39-152"></a><span class="co"># for(year in 2011:2017){</span></span>
<span id="cb39-153"><a href="commute-vehicle-miles-traveled.html#cb39-153"></a><span class="co">#     print(year)</span></span>
<span id="cb39-154"><a href="commute-vehicle-miles-traveled.html#cb39-154"></a><span class="co"># </span></span>
<span id="cb39-155"><a href="commute-vehicle-miles-traveled.html#cb39-155"></a><span class="co">#     load(paste0(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/stockton_lodes_&quot;,year,&quot;_tract.Rdata&quot;))</span></span>
<span id="cb39-156"><a href="commute-vehicle-miles-traveled.html#cb39-156"></a><span class="co"># </span></span>
<span id="cb39-157"><a href="commute-vehicle-miles-traveled.html#cb39-157"></a><span class="co">#     load(paste0(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/acs5_vars_&quot;,year,&quot;.Rdata&quot;))</span></span>
<span id="cb39-158"><a href="commute-vehicle-miles-traveled.html#cb39-158"></a><span class="co"># </span></span>
<span id="cb39-159"><a href="commute-vehicle-miles-traveled.html#cb39-159"></a><span class="co">#     travel_time_mode &lt;-</span></span>
<span id="cb39-160"><a href="commute-vehicle-miles-traveled.html#cb39-160"></a><span class="co">#       getCensus(</span></span>
<span id="cb39-161"><a href="commute-vehicle-miles-traveled.html#cb39-161"></a><span class="co">#         name = &quot;acs/acs5&quot;,</span></span>
<span id="cb39-162"><a href="commute-vehicle-miles-traveled.html#cb39-162"></a><span class="co">#         vintage = year,</span></span>
<span id="cb39-163"><a href="commute-vehicle-miles-traveled.html#cb39-163"></a><span class="co">#         region = &quot;tract:*&quot;,</span></span>
<span id="cb39-164"><a href="commute-vehicle-miles-traveled.html#cb39-164"></a><span class="co">#         regionin = &quot;state:06+county:077&quot;,</span></span>
<span id="cb39-165"><a href="commute-vehicle-miles-traveled.html#cb39-165"></a><span class="co">#         vars = &quot;group(B08134)&quot;</span></span>
<span id="cb39-166"><a href="commute-vehicle-miles-traveled.html#cb39-166"></a><span class="co">#       ) %&gt;%</span></span>
<span id="cb39-167"><a href="commute-vehicle-miles-traveled.html#cb39-167"></a><span class="co">#       mutate(tract = paste0(state,county,tract)) %&gt;%</span></span>
<span id="cb39-168"><a href="commute-vehicle-miles-traveled.html#cb39-168"></a><span class="co">#       select_if(!names(.) %in% c(&quot;GEO_ID&quot;,&quot;state&quot;,&quot;county&quot;,&quot;NAME&quot;)) %&gt;%</span></span>
<span id="cb39-169"><a href="commute-vehicle-miles-traveled.html#cb39-169"></a><span class="co">#       dplyr::select(-c(contains(&quot;EA&quot;),contains(&quot;MA&quot;),contains(&quot;M&quot;))) %&gt;%</span></span>
<span id="cb39-170"><a href="commute-vehicle-miles-traveled.html#cb39-170"></a><span class="co">#       gather(</span></span>
<span id="cb39-171"><a href="commute-vehicle-miles-traveled.html#cb39-171"></a><span class="co">#         key = &quot;variable&quot;,</span></span>
<span id="cb39-172"><a href="commute-vehicle-miles-traveled.html#cb39-172"></a><span class="co">#         value = &quot;estimate&quot;,</span></span>
<span id="cb39-173"><a href="commute-vehicle-miles-traveled.html#cb39-173"></a><span class="co">#         -tract</span></span>
<span id="cb39-174"><a href="commute-vehicle-miles-traveled.html#cb39-174"></a><span class="co">#       ) %&gt;%</span></span>
<span id="cb39-175"><a href="commute-vehicle-miles-traveled.html#cb39-175"></a><span class="co">#       mutate(</span></span>
<span id="cb39-176"><a href="commute-vehicle-miles-traveled.html#cb39-176"></a><span class="co">#         label = acs_vars$label[match(variable,acs_vars$name)],</span></span>
<span id="cb39-177"><a href="commute-vehicle-miles-traveled.html#cb39-177"></a><span class="co">#         time = # This extracts only the time information from our label.</span></span>
<span id="cb39-178"><a href="commute-vehicle-miles-traveled.html#cb39-178"></a><span class="co">#           substr(</span></span>
<span id="cb39-179"><a href="commute-vehicle-miles-traveled.html#cb39-179"></a><span class="co">#             label,</span></span>
<span id="cb39-180"><a href="commute-vehicle-miles-traveled.html#cb39-180"></a><span class="co">#             lapply(</span></span>
<span id="cb39-181"><a href="commute-vehicle-miles-traveled.html#cb39-181"></a><span class="co">#               label,</span></span>
<span id="cb39-182"><a href="commute-vehicle-miles-traveled.html#cb39-182"></a><span class="co">#               function(x){</span></span>
<span id="cb39-183"><a href="commute-vehicle-miles-traveled.html#cb39-183"></a><span class="co">#                 ifelse(</span></span>
<span id="cb39-184"><a href="commute-vehicle-miles-traveled.html#cb39-184"></a><span class="co">#                   length(unlist(gregexpr(&#39;!!&#39;,x)))&lt;3,</span></span>
<span id="cb39-185"><a href="commute-vehicle-miles-traveled.html#cb39-185"></a><span class="co">#                   NA,</span></span>
<span id="cb39-186"><a href="commute-vehicle-miles-traveled.html#cb39-186"></a><span class="co">#                   max(unlist(gregexpr(&#39;!!&#39;,x)))+2</span></span>
<span id="cb39-187"><a href="commute-vehicle-miles-traveled.html#cb39-187"></a><span class="co">#                 )</span></span>
<span id="cb39-188"><a href="commute-vehicle-miles-traveled.html#cb39-188"></a><span class="co">#               }</span></span>
<span id="cb39-189"><a href="commute-vehicle-miles-traveled.html#cb39-189"></a><span class="co">#             ),</span></span>
<span id="cb39-190"><a href="commute-vehicle-miles-traveled.html#cb39-190"></a><span class="co">#             nchar(label)</span></span>
<span id="cb39-191"><a href="commute-vehicle-miles-traveled.html#cb39-191"></a><span class="co">#           ),</span></span>
<span id="cb39-192"><a href="commute-vehicle-miles-traveled.html#cb39-192"></a><span class="co">#         mode = # This extracts only the mode information from our label. It doesn&#39;t fully deal with double-counting, so some are further removed later on in a filter.</span></span>
<span id="cb39-193"><a href="commute-vehicle-miles-traveled.html#cb39-193"></a><span class="co">#           substr(</span></span>
<span id="cb39-194"><a href="commute-vehicle-miles-traveled.html#cb39-194"></a><span class="co">#             label,</span></span>
<span id="cb39-195"><a href="commute-vehicle-miles-traveled.html#cb39-195"></a><span class="co">#             lapply(</span></span>
<span id="cb39-196"><a href="commute-vehicle-miles-traveled.html#cb39-196"></a><span class="co">#               label,</span></span>
<span id="cb39-197"><a href="commute-vehicle-miles-traveled.html#cb39-197"></a><span class="co">#               function(x){</span></span>
<span id="cb39-198"><a href="commute-vehicle-miles-traveled.html#cb39-198"></a><span class="co">#                 ifelse(</span></span>
<span id="cb39-199"><a href="commute-vehicle-miles-traveled.html#cb39-199"></a><span class="co">#                   length(unlist(gregexpr(&#39;!!&#39;,x)))&lt;3,</span></span>
<span id="cb39-200"><a href="commute-vehicle-miles-traveled.html#cb39-200"></a><span class="co">#                   NA,</span></span>
<span id="cb39-201"><a href="commute-vehicle-miles-traveled.html#cb39-201"></a><span class="co">#                   unlist(gregexpr(&#39;!!&#39;,x))[length(unlist(gregexpr(&#39;!!&#39;,x)))-1]+2</span></span>
<span id="cb39-202"><a href="commute-vehicle-miles-traveled.html#cb39-202"></a><span class="co">#                 )</span></span>
<span id="cb39-203"><a href="commute-vehicle-miles-traveled.html#cb39-203"></a><span class="co">#               }</span></span>
<span id="cb39-204"><a href="commute-vehicle-miles-traveled.html#cb39-204"></a><span class="co">#             ),</span></span>
<span id="cb39-205"><a href="commute-vehicle-miles-traveled.html#cb39-205"></a><span class="co">#             lapply(</span></span>
<span id="cb39-206"><a href="commute-vehicle-miles-traveled.html#cb39-206"></a><span class="co">#               label,</span></span>
<span id="cb39-207"><a href="commute-vehicle-miles-traveled.html#cb39-207"></a><span class="co">#               function(x){</span></span>
<span id="cb39-208"><a href="commute-vehicle-miles-traveled.html#cb39-208"></a><span class="co">#                 max(unlist(gregexpr(&#39;!!&#39;,x)))-1</span></span>
<span id="cb39-209"><a href="commute-vehicle-miles-traveled.html#cb39-209"></a><span class="co">#               }</span></span>
<span id="cb39-210"><a href="commute-vehicle-miles-traveled.html#cb39-210"></a><span class="co">#             )</span></span>
<span id="cb39-211"><a href="commute-vehicle-miles-traveled.html#cb39-211"></a><span class="co">#           )</span></span>
<span id="cb39-212"><a href="commute-vehicle-miles-traveled.html#cb39-212"></a><span class="co">#       ) %&gt;%</span></span>
<span id="cb39-213"><a href="commute-vehicle-miles-traveled.html#cb39-213"></a><span class="co">#       filter(!is.na(time)) %&gt;% # This removes the grand total rows that are usually at the top of the ACS data.</span></span>
<span id="cb39-214"><a href="commute-vehicle-miles-traveled.html#cb39-214"></a><span class="co">#       filter(!mode %in% c(&quot;Car, truck, or van&quot;,&quot;Car truck or van&quot;,&quot;Carpooled&quot;,&quot;Public transportation (excluding taxicab)&quot;)) %&gt;% # This removes double-counted subtotals.</span></span>
<span id="cb39-215"><a href="commute-vehicle-miles-traveled.html#cb39-215"></a><span class="co">#       dplyr::select(-variable,-label)</span></span>
<span id="cb39-216"><a href="commute-vehicle-miles-traveled.html#cb39-216"></a><span class="co"># </span></span>
<span id="cb39-217"><a href="commute-vehicle-miles-traveled.html#cb39-217"></a><span class="co">#     travel_time_mode_summary &lt;-</span></span>
<span id="cb39-218"><a href="commute-vehicle-miles-traveled.html#cb39-218"></a><span class="co">#       travel_time_mode %&gt;%</span></span>
<span id="cb39-219"><a href="commute-vehicle-miles-traveled.html#cb39-219"></a><span class="co">#       group_by(tract,time) %&gt;%</span></span>
<span id="cb39-220"><a href="commute-vehicle-miles-traveled.html#cb39-220"></a><span class="co">#       summarize(</span></span>
<span id="cb39-221"><a href="commute-vehicle-miles-traveled.html#cb39-221"></a><span class="co">#         jobs = sum(estimate),</span></span>
<span id="cb39-222"><a href="commute-vehicle-miles-traveled.html#cb39-222"></a><span class="co">#         jobs_drovealone = sum(estimate[which(mode == &quot;Drove alone&quot;)]),</span></span>
<span id="cb39-223"><a href="commute-vehicle-miles-traveled.html#cb39-223"></a><span class="co">#         jobs_carpool2 = sum(estimate[which(mode == &quot;In 2-person carpool&quot;)]),</span></span>
<span id="cb39-224"><a href="commute-vehicle-miles-traveled.html#cb39-224"></a><span class="co">#         jobs_carpool3 = sum(estimate[which(mode == &quot;In 3-or-more-person carpool&quot;)]),</span></span>
<span id="cb39-225"><a href="commute-vehicle-miles-traveled.html#cb39-225"></a><span class="co">#       ) %&gt;%</span></span>
<span id="cb39-226"><a href="commute-vehicle-miles-traveled.html#cb39-226"></a><span class="co">#       mutate(</span></span>
<span id="cb39-227"><a href="commute-vehicle-miles-traveled.html#cb39-227"></a><span class="co">#         vehicles_drovealone = jobs_drovealone,</span></span>
<span id="cb39-228"><a href="commute-vehicle-miles-traveled.html#cb39-228"></a><span class="co">#         vehicles_carpool2 = jobs_carpool2/2,</span></span>
<span id="cb39-229"><a href="commute-vehicle-miles-traveled.html#cb39-229"></a><span class="co">#         vehicles_carpool3 = jobs_carpool3/3,</span></span>
<span id="cb39-230"><a href="commute-vehicle-miles-traveled.html#cb39-230"></a><span class="co">#         jobs_car = jobs_drovealone+jobs_carpool2+jobs_carpool3,</span></span>
<span id="cb39-231"><a href="commute-vehicle-miles-traveled.html#cb39-231"></a><span class="co">#         jobs_carpool = jobs_carpool2+jobs_carpool3,</span></span>
<span id="cb39-232"><a href="commute-vehicle-miles-traveled.html#cb39-232"></a><span class="co">#         vehicles = vehicles_drovealone,vehicles_carpool2,vehicles_carpool3,</span></span>
<span id="cb39-233"><a href="commute-vehicle-miles-traveled.html#cb39-233"></a><span class="co">#         perc_jobs_car = jobs_car/jobs,</span></span>
<span id="cb39-234"><a href="commute-vehicle-miles-traveled.html#cb39-234"></a><span class="co">#         perc_jobs_carpool = jobs_carpool/jobs,</span></span>
<span id="cb39-235"><a href="commute-vehicle-miles-traveled.html#cb39-235"></a><span class="co">#         perc_vehicle = vehicles/jobs</span></span>
<span id="cb39-236"><a href="commute-vehicle-miles-traveled.html#cb39-236"></a><span class="co">#       )</span></span>
<span id="cb39-237"><a href="commute-vehicle-miles-traveled.html#cb39-237"></a><span class="co"># </span></span>
<span id="cb39-238"><a href="commute-vehicle-miles-traveled.html#cb39-238"></a><span class="co">#   stockton_lodes_h_mode &lt;-</span></span>
<span id="cb39-239"><a href="commute-vehicle-miles-traveled.html#cb39-239"></a><span class="co">#     stockton_lodes_h_filter %&gt;%</span></span>
<span id="cb39-240"><a href="commute-vehicle-miles-traveled.html#cb39-240"></a><span class="co">#     transmute(</span></span>
<span id="cb39-241"><a href="commute-vehicle-miles-traveled.html#cb39-241"></a><span class="co">#       residence = h_tract,</span></span>
<span id="cb39-242"><a href="commute-vehicle-miles-traveled.html#cb39-242"></a><span class="co">#       jobs = S000,</span></span>
<span id="cb39-243"><a href="commute-vehicle-miles-traveled.html#cb39-243"></a><span class="co">#       duration = duration,</span></span>
<span id="cb39-244"><a href="commute-vehicle-miles-traveled.html#cb39-244"></a><span class="co">#       person_miles = S000*as.numeric(distance)/1.60934,</span></span>
<span id="cb39-245"><a href="commute-vehicle-miles-traveled.html#cb39-245"></a><span class="co">#       person_hours = S000*as.numeric(duration)/60</span></span>
<span id="cb39-246"><a href="commute-vehicle-miles-traveled.html#cb39-246"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb39-247"><a href="commute-vehicle-miles-traveled.html#cb39-247"></a><span class="co">#     mutate(</span></span>
<span id="cb39-248"><a href="commute-vehicle-miles-traveled.html#cb39-248"></a><span class="co">#       tier =</span></span>
<span id="cb39-249"><a href="commute-vehicle-miles-traveled.html#cb39-249"></a><span class="co">#         case_when(</span></span>
<span id="cb39-250"><a href="commute-vehicle-miles-traveled.html#cb39-250"></a><span class="co">#           duration &lt; 10 ~ &quot;Less than 10 minutes&quot;,</span></span>
<span id="cb39-251"><a href="commute-vehicle-miles-traveled.html#cb39-251"></a><span class="co">#           duration &lt; 15 ~ &quot;10 to 14 minutes&quot;,</span></span>
<span id="cb39-252"><a href="commute-vehicle-miles-traveled.html#cb39-252"></a><span class="co">#           duration &lt; 20 ~ &quot;15 to 19 minutes&quot;,</span></span>
<span id="cb39-253"><a href="commute-vehicle-miles-traveled.html#cb39-253"></a><span class="co">#           duration &lt; 25 ~ &quot;20 to 24 minutes&quot;,</span></span>
<span id="cb39-254"><a href="commute-vehicle-miles-traveled.html#cb39-254"></a><span class="co">#           duration &lt; 30 ~ &quot;25 to 29 minutes&quot;,</span></span>
<span id="cb39-255"><a href="commute-vehicle-miles-traveled.html#cb39-255"></a><span class="co">#           duration &lt; 35 ~ &quot;30 to 34 minutes&quot;,</span></span>
<span id="cb39-256"><a href="commute-vehicle-miles-traveled.html#cb39-256"></a><span class="co">#           duration &lt; 45 ~ &quot;35 to 44 minutes&quot;,</span></span>
<span id="cb39-257"><a href="commute-vehicle-miles-traveled.html#cb39-257"></a><span class="co">#           duration &lt; 60 ~ &quot;45 to 59 minutes&quot;,</span></span>
<span id="cb39-258"><a href="commute-vehicle-miles-traveled.html#cb39-258"></a><span class="co">#           TRUE ~ &quot;60 or more minutes&quot;</span></span>
<span id="cb39-259"><a href="commute-vehicle-miles-traveled.html#cb39-259"></a><span class="co">#         )</span></span>
<span id="cb39-260"><a href="commute-vehicle-miles-traveled.html#cb39-260"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb39-261"><a href="commute-vehicle-miles-traveled.html#cb39-261"></a><span class="co">#     left_join(</span></span>
<span id="cb39-262"><a href="commute-vehicle-miles-traveled.html#cb39-262"></a><span class="co">#       travel_time_mode_summary %&gt;%</span></span>
<span id="cb39-263"><a href="commute-vehicle-miles-traveled.html#cb39-263"></a><span class="co">#         dplyr::select(</span></span>
<span id="cb39-264"><a href="commute-vehicle-miles-traveled.html#cb39-264"></a><span class="co">#           tract,</span></span>
<span id="cb39-265"><a href="commute-vehicle-miles-traveled.html#cb39-265"></a><span class="co">#           time,</span></span>
<span id="cb39-266"><a href="commute-vehicle-miles-traveled.html#cb39-266"></a><span class="co">#           perc_jobs_car,</span></span>
<span id="cb39-267"><a href="commute-vehicle-miles-traveled.html#cb39-267"></a><span class="co">#           perc_jobs_carpool,</span></span>
<span id="cb39-268"><a href="commute-vehicle-miles-traveled.html#cb39-268"></a><span class="co">#           perc_vehicle</span></span>
<span id="cb39-269"><a href="commute-vehicle-miles-traveled.html#cb39-269"></a><span class="co">#         ),</span></span>
<span id="cb39-270"><a href="commute-vehicle-miles-traveled.html#cb39-270"></a><span class="co">#       by = c(&quot;residence&quot; = &quot;tract&quot;, &quot;tier&quot; = &quot;time&quot;)</span></span>
<span id="cb39-271"><a href="commute-vehicle-miles-traveled.html#cb39-271"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb39-272"><a href="commute-vehicle-miles-traveled.html#cb39-272"></a><span class="co">#     mutate(</span></span>
<span id="cb39-273"><a href="commute-vehicle-miles-traveled.html#cb39-273"></a><span class="co">#       jobs_car = jobs*perc_jobs_car,</span></span>
<span id="cb39-274"><a href="commute-vehicle-miles-traveled.html#cb39-274"></a><span class="co">#       jobs_carpool = jobs*perc_jobs_carpool,</span></span>
<span id="cb39-275"><a href="commute-vehicle-miles-traveled.html#cb39-275"></a><span class="co">#       vehicles = jobs*perc_vehicle,</span></span>
<span id="cb39-276"><a href="commute-vehicle-miles-traveled.html#cb39-276"></a><span class="co">#       vmt = person_miles*perc_vehicle</span></span>
<span id="cb39-277"><a href="commute-vehicle-miles-traveled.html#cb39-277"></a><span class="co">#     )</span></span>
<span id="cb39-278"><a href="commute-vehicle-miles-traveled.html#cb39-278"></a><span class="co"># </span></span>
<span id="cb39-279"><a href="commute-vehicle-miles-traveled.html#cb39-279"></a><span class="co">#     stockton_commute_vmt_tractmode &lt;-</span></span>
<span id="cb39-280"><a href="commute-vehicle-miles-traveled.html#cb39-280"></a><span class="co">#       rbind(stockton_commute_vmt_tractmode,</span></span>
<span id="cb39-281"><a href="commute-vehicle-miles-traveled.html#cb39-281"></a><span class="co">#         data.frame(</span></span>
<span id="cb39-282"><a href="commute-vehicle-miles-traveled.html#cb39-282"></a><span class="co">#           Year = year,</span></span>
<span id="cb39-283"><a href="commute-vehicle-miles-traveled.html#cb39-283"></a><span class="co">#           person_miles = sum(stockton_lodes_h_mode$person_miles, na.rm=T),</span></span>
<span id="cb39-284"><a href="commute-vehicle-miles-traveled.html#cb39-284"></a><span class="co">#           jobs = sum(stockton_lodes_h_mode$jobs, na.rm=T),</span></span>
<span id="cb39-285"><a href="commute-vehicle-miles-traveled.html#cb39-285"></a><span class="co">#           jobs_car = sum(stockton_lodes_h_mode$jobs_car, na.rm=T),</span></span>
<span id="cb39-286"><a href="commute-vehicle-miles-traveled.html#cb39-286"></a><span class="co">#           jobs_carpool = sum(stockton_lodes_h_mode$jobs_carpool, na.rm=T),</span></span>
<span id="cb39-287"><a href="commute-vehicle-miles-traveled.html#cb39-287"></a><span class="co">#           vehicles = sum(stockton_lodes_h_mode$vehicles, na.rm = T),</span></span>
<span id="cb39-288"><a href="commute-vehicle-miles-traveled.html#cb39-288"></a><span class="co">#           vmt = sum(stockton_lodes_h_mode$vmt, na.rm=T)</span></span>
<span id="cb39-289"><a href="commute-vehicle-miles-traveled.html#cb39-289"></a><span class="co">#         )</span></span>
<span id="cb39-290"><a href="commute-vehicle-miles-traveled.html#cb39-290"></a><span class="co">#       )</span></span>
<span id="cb39-291"><a href="commute-vehicle-miles-traveled.html#cb39-291"></a><span class="co"># </span></span>
<span id="cb39-292"><a href="commute-vehicle-miles-traveled.html#cb39-292"></a><span class="co">#     save(stockton_commute_vmt_tractmode,file = &quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/stockton_commute_vmt_tractmode.Rdata&quot;)</span></span>
<span id="cb39-293"><a href="commute-vehicle-miles-traveled.html#cb39-293"></a><span class="co"># }</span></span>
<span id="cb39-294"><a href="commute-vehicle-miles-traveled.html#cb39-294"></a><span class="co"># load(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/stockton_commute_vmt_tractmode.Rdata&quot;)</span></span>
<span id="cb39-295"><a href="commute-vehicle-miles-traveled.html#cb39-295"></a><span class="co"># </span></span>
<span id="cb39-296"><a href="commute-vehicle-miles-traveled.html#cb39-296"></a><span class="co"># stockton_commute_vmt_tractmode %&gt;%</span></span>
<span id="cb39-297"><a href="commute-vehicle-miles-traveled.html#cb39-297"></a><span class="co">#   ggplot(</span></span>
<span id="cb39-298"><a href="commute-vehicle-miles-traveled.html#cb39-298"></a><span class="co">#     aes(</span></span>
<span id="cb39-299"><a href="commute-vehicle-miles-traveled.html#cb39-299"></a><span class="co">#       x = Year,</span></span>
<span id="cb39-300"><a href="commute-vehicle-miles-traveled.html#cb39-300"></a><span class="co">#       y = vmt/jobs</span></span>
<span id="cb39-301"><a href="commute-vehicle-miles-traveled.html#cb39-301"></a><span class="co">#     )</span></span>
<span id="cb39-302"><a href="commute-vehicle-miles-traveled.html#cb39-302"></a><span class="co">#   ) +</span></span>
<span id="cb39-303"><a href="commute-vehicle-miles-traveled.html#cb39-303"></a><span class="co">#   geom_line()</span></span>
<span id="cb39-304"><a href="commute-vehicle-miles-traveled.html#cb39-304"></a><span class="co"># </span></span>
<span id="cb39-305"><a href="commute-vehicle-miles-traveled.html#cb39-305"></a><span class="co"># stockton_commute_vmt_countymode &lt;- NULL</span></span>
<span id="cb39-306"><a href="commute-vehicle-miles-traveled.html#cb39-306"></a><span class="co"># </span></span>
<span id="cb39-307"><a href="commute-vehicle-miles-traveled.html#cb39-307"></a><span class="co"># for(year in 2011:2017){</span></span>
<span id="cb39-308"><a href="commute-vehicle-miles-traveled.html#cb39-308"></a><span class="co"># </span></span>
<span id="cb39-309"><a href="commute-vehicle-miles-traveled.html#cb39-309"></a><span class="co">#   print(year)</span></span>
<span id="cb39-310"><a href="commute-vehicle-miles-traveled.html#cb39-310"></a><span class="co"># </span></span>
<span id="cb39-311"><a href="commute-vehicle-miles-traveled.html#cb39-311"></a><span class="co">#   load(paste0(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/stockton_lodes_&quot;,year,&quot;_tract.Rdata&quot;))</span></span>
<span id="cb39-312"><a href="commute-vehicle-miles-traveled.html#cb39-312"></a><span class="co"># </span></span>
<span id="cb39-313"><a href="commute-vehicle-miles-traveled.html#cb39-313"></a><span class="co">#   load(paste0(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/acs1_vars_&quot;,year,&quot;.Rdata&quot;))</span></span>
<span id="cb39-314"><a href="commute-vehicle-miles-traveled.html#cb39-314"></a><span class="co"># </span></span>
<span id="cb39-315"><a href="commute-vehicle-miles-traveled.html#cb39-315"></a><span class="co">#   travel_time_mode &lt;-</span></span>
<span id="cb39-316"><a href="commute-vehicle-miles-traveled.html#cb39-316"></a><span class="co">#     getCensus(</span></span>
<span id="cb39-317"><a href="commute-vehicle-miles-traveled.html#cb39-317"></a><span class="co">#       name = &quot;acs/acs1&quot;,</span></span>
<span id="cb39-318"><a href="commute-vehicle-miles-traveled.html#cb39-318"></a><span class="co">#       vintage = year,</span></span>
<span id="cb39-319"><a href="commute-vehicle-miles-traveled.html#cb39-319"></a><span class="co">#       region = &quot;county:077&quot;,</span></span>
<span id="cb39-320"><a href="commute-vehicle-miles-traveled.html#cb39-320"></a><span class="co">#       regionin = &quot;state:06&quot;,</span></span>
<span id="cb39-321"><a href="commute-vehicle-miles-traveled.html#cb39-321"></a><span class="co">#       vars = &quot;group(B08134)&quot;</span></span>
<span id="cb39-322"><a href="commute-vehicle-miles-traveled.html#cb39-322"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb39-323"><a href="commute-vehicle-miles-traveled.html#cb39-323"></a><span class="co">#     select_if(!names(.) %in% c(&quot;GEO_ID&quot;,&quot;state&quot;,&quot;NAME&quot;)) %&gt;%</span></span>
<span id="cb39-324"><a href="commute-vehicle-miles-traveled.html#cb39-324"></a><span class="co">#     dplyr::select(-c(contains(&quot;EA&quot;),contains(&quot;MA&quot;),contains(&quot;M&quot;))) %&gt;%</span></span>
<span id="cb39-325"><a href="commute-vehicle-miles-traveled.html#cb39-325"></a><span class="co">#     gather(</span></span>
<span id="cb39-326"><a href="commute-vehicle-miles-traveled.html#cb39-326"></a><span class="co">#       key = &quot;variable&quot;,</span></span>
<span id="cb39-327"><a href="commute-vehicle-miles-traveled.html#cb39-327"></a><span class="co">#       value = &quot;estimate&quot;,</span></span>
<span id="cb39-328"><a href="commute-vehicle-miles-traveled.html#cb39-328"></a><span class="co">#       -county</span></span>
<span id="cb39-329"><a href="commute-vehicle-miles-traveled.html#cb39-329"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb39-330"><a href="commute-vehicle-miles-traveled.html#cb39-330"></a><span class="co">#     mutate(</span></span>
<span id="cb39-331"><a href="commute-vehicle-miles-traveled.html#cb39-331"></a><span class="co">#       label = acs_vars$label[match(variable,acs_vars$name)],</span></span>
<span id="cb39-332"><a href="commute-vehicle-miles-traveled.html#cb39-332"></a><span class="co">#       time = # This extracts only the time information from our label.</span></span>
<span id="cb39-333"><a href="commute-vehicle-miles-traveled.html#cb39-333"></a><span class="co">#         substr(</span></span>
<span id="cb39-334"><a href="commute-vehicle-miles-traveled.html#cb39-334"></a><span class="co">#           label,</span></span>
<span id="cb39-335"><a href="commute-vehicle-miles-traveled.html#cb39-335"></a><span class="co">#           lapply(</span></span>
<span id="cb39-336"><a href="commute-vehicle-miles-traveled.html#cb39-336"></a><span class="co">#             label,</span></span>
<span id="cb39-337"><a href="commute-vehicle-miles-traveled.html#cb39-337"></a><span class="co">#             function(x){</span></span>
<span id="cb39-338"><a href="commute-vehicle-miles-traveled.html#cb39-338"></a><span class="co">#               ifelse(</span></span>
<span id="cb39-339"><a href="commute-vehicle-miles-traveled.html#cb39-339"></a><span class="co">#                 length(unlist(gregexpr(&#39;!!&#39;,x)))&lt;3,</span></span>
<span id="cb39-340"><a href="commute-vehicle-miles-traveled.html#cb39-340"></a><span class="co">#                 NA,</span></span>
<span id="cb39-341"><a href="commute-vehicle-miles-traveled.html#cb39-341"></a><span class="co">#                 max(unlist(gregexpr(&#39;!!&#39;,x)))+2</span></span>
<span id="cb39-342"><a href="commute-vehicle-miles-traveled.html#cb39-342"></a><span class="co">#               )</span></span>
<span id="cb39-343"><a href="commute-vehicle-miles-traveled.html#cb39-343"></a><span class="co">#             }</span></span>
<span id="cb39-344"><a href="commute-vehicle-miles-traveled.html#cb39-344"></a><span class="co">#           ),</span></span>
<span id="cb39-345"><a href="commute-vehicle-miles-traveled.html#cb39-345"></a><span class="co">#           nchar(label)</span></span>
<span id="cb39-346"><a href="commute-vehicle-miles-traveled.html#cb39-346"></a><span class="co">#         ),</span></span>
<span id="cb39-347"><a href="commute-vehicle-miles-traveled.html#cb39-347"></a><span class="co">#       mode = # This extracts only the mode information from our label. It doesn&#39;t fully deal with double-counting, so some are further removed later on in a filter.</span></span>
<span id="cb39-348"><a href="commute-vehicle-miles-traveled.html#cb39-348"></a><span class="co">#         substr(</span></span>
<span id="cb39-349"><a href="commute-vehicle-miles-traveled.html#cb39-349"></a><span class="co">#           label,</span></span>
<span id="cb39-350"><a href="commute-vehicle-miles-traveled.html#cb39-350"></a><span class="co">#           lapply(</span></span>
<span id="cb39-351"><a href="commute-vehicle-miles-traveled.html#cb39-351"></a><span class="co">#             label,</span></span>
<span id="cb39-352"><a href="commute-vehicle-miles-traveled.html#cb39-352"></a><span class="co">#             function(x){</span></span>
<span id="cb39-353"><a href="commute-vehicle-miles-traveled.html#cb39-353"></a><span class="co">#               ifelse(</span></span>
<span id="cb39-354"><a href="commute-vehicle-miles-traveled.html#cb39-354"></a><span class="co">#                 length(unlist(gregexpr(&#39;!!&#39;,x)))&lt;3,</span></span>
<span id="cb39-355"><a href="commute-vehicle-miles-traveled.html#cb39-355"></a><span class="co">#                 NA,</span></span>
<span id="cb39-356"><a href="commute-vehicle-miles-traveled.html#cb39-356"></a><span class="co">#                 unlist(gregexpr(&#39;!!&#39;,x))[length(unlist(gregexpr(&#39;!!&#39;,x)))-1]+2</span></span>
<span id="cb39-357"><a href="commute-vehicle-miles-traveled.html#cb39-357"></a><span class="co">#               )</span></span>
<span id="cb39-358"><a href="commute-vehicle-miles-traveled.html#cb39-358"></a><span class="co">#             }</span></span>
<span id="cb39-359"><a href="commute-vehicle-miles-traveled.html#cb39-359"></a><span class="co">#           ),</span></span>
<span id="cb39-360"><a href="commute-vehicle-miles-traveled.html#cb39-360"></a><span class="co">#           lapply(</span></span>
<span id="cb39-361"><a href="commute-vehicle-miles-traveled.html#cb39-361"></a><span class="co">#             label,</span></span>
<span id="cb39-362"><a href="commute-vehicle-miles-traveled.html#cb39-362"></a><span class="co">#             function(x){</span></span>
<span id="cb39-363"><a href="commute-vehicle-miles-traveled.html#cb39-363"></a><span class="co">#               max(unlist(gregexpr(&#39;!!&#39;,x)))-1</span></span>
<span id="cb39-364"><a href="commute-vehicle-miles-traveled.html#cb39-364"></a><span class="co">#             }</span></span>
<span id="cb39-365"><a href="commute-vehicle-miles-traveled.html#cb39-365"></a><span class="co">#           )</span></span>
<span id="cb39-366"><a href="commute-vehicle-miles-traveled.html#cb39-366"></a><span class="co">#         )</span></span>
<span id="cb39-367"><a href="commute-vehicle-miles-traveled.html#cb39-367"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb39-368"><a href="commute-vehicle-miles-traveled.html#cb39-368"></a><span class="co">#     filter(!is.na(time)) %&gt;% # This removes the grand total rows that are usually at the top of the ACS data.</span></span>
<span id="cb39-369"><a href="commute-vehicle-miles-traveled.html#cb39-369"></a><span class="co">#     filter(!mode %in% c(&quot;Car, truck, or van&quot;,&quot;Car truck or van&quot;,&quot;Carpooled&quot;,&quot;Public transportation (excluding taxicab)&quot;)) %&gt;% # This removes double-counted subtotals.</span></span>
<span id="cb39-370"><a href="commute-vehicle-miles-traveled.html#cb39-370"></a><span class="co">#     dplyr::select(-variable,-label)</span></span>
<span id="cb39-371"><a href="commute-vehicle-miles-traveled.html#cb39-371"></a><span class="co"># </span></span>
<span id="cb39-372"><a href="commute-vehicle-miles-traveled.html#cb39-372"></a><span class="co">#     travel_time_mode_summary &lt;-</span></span>
<span id="cb39-373"><a href="commute-vehicle-miles-traveled.html#cb39-373"></a><span class="co">#       travel_time_mode %&gt;%</span></span>
<span id="cb39-374"><a href="commute-vehicle-miles-traveled.html#cb39-374"></a><span class="co">#       group_by(time) %&gt;%</span></span>
<span id="cb39-375"><a href="commute-vehicle-miles-traveled.html#cb39-375"></a><span class="co">#       summarize(</span></span>
<span id="cb39-376"><a href="commute-vehicle-miles-traveled.html#cb39-376"></a><span class="co">#         jobs = sum(estimate),</span></span>
<span id="cb39-377"><a href="commute-vehicle-miles-traveled.html#cb39-377"></a><span class="co">#         jobs_drovealone = sum(estimate[which(mode == &quot;Drove alone&quot;)]),</span></span>
<span id="cb39-378"><a href="commute-vehicle-miles-traveled.html#cb39-378"></a><span class="co">#         jobs_carpool2 = sum(estimate[which(mode == &quot;In 2-person carpool&quot;)]),</span></span>
<span id="cb39-379"><a href="commute-vehicle-miles-traveled.html#cb39-379"></a><span class="co">#         jobs_carpool3 = sum(estimate[which(mode == &quot;In 3-or-more-person carpool&quot;)]),</span></span>
<span id="cb39-380"><a href="commute-vehicle-miles-traveled.html#cb39-380"></a><span class="co">#       ) %&gt;%</span></span>
<span id="cb39-381"><a href="commute-vehicle-miles-traveled.html#cb39-381"></a><span class="co">#       mutate(</span></span>
<span id="cb39-382"><a href="commute-vehicle-miles-traveled.html#cb39-382"></a><span class="co">#         vehicles_drovealone = jobs_drovealone,</span></span>
<span id="cb39-383"><a href="commute-vehicle-miles-traveled.html#cb39-383"></a><span class="co">#         vehicles_carpool2 = jobs_carpool2/2,</span></span>
<span id="cb39-384"><a href="commute-vehicle-miles-traveled.html#cb39-384"></a><span class="co">#         vehicles_carpool3 = jobs_carpool3/3,</span></span>
<span id="cb39-385"><a href="commute-vehicle-miles-traveled.html#cb39-385"></a><span class="co">#         jobs_car = jobs_drovealone+jobs_carpool2+jobs_carpool3,</span></span>
<span id="cb39-386"><a href="commute-vehicle-miles-traveled.html#cb39-386"></a><span class="co">#         jobs_carpool = jobs_carpool2+jobs_carpool3,</span></span>
<span id="cb39-387"><a href="commute-vehicle-miles-traveled.html#cb39-387"></a><span class="co">#         vehicles = vehicles_drovealone,vehicles_carpool2,vehicles_carpool3,</span></span>
<span id="cb39-388"><a href="commute-vehicle-miles-traveled.html#cb39-388"></a><span class="co">#         perc_jobs_car = jobs_car/jobs,</span></span>
<span id="cb39-389"><a href="commute-vehicle-miles-traveled.html#cb39-389"></a><span class="co">#         perc_jobs_carpool = jobs_carpool/jobs,</span></span>
<span id="cb39-390"><a href="commute-vehicle-miles-traveled.html#cb39-390"></a><span class="co">#         perc_vehicle = vehicles/jobs</span></span>
<span id="cb39-391"><a href="commute-vehicle-miles-traveled.html#cb39-391"></a><span class="co">#       )</span></span>
<span id="cb39-392"><a href="commute-vehicle-miles-traveled.html#cb39-392"></a><span class="co"># </span></span>
<span id="cb39-393"><a href="commute-vehicle-miles-traveled.html#cb39-393"></a><span class="co">#   stockton_lodes_h_mode &lt;-</span></span>
<span id="cb39-394"><a href="commute-vehicle-miles-traveled.html#cb39-394"></a><span class="co">#     stockton_lodes_h_filter %&gt;%</span></span>
<span id="cb39-395"><a href="commute-vehicle-miles-traveled.html#cb39-395"></a><span class="co">#     transmute(</span></span>
<span id="cb39-396"><a href="commute-vehicle-miles-traveled.html#cb39-396"></a><span class="co">#       jobs = S000,</span></span>
<span id="cb39-397"><a href="commute-vehicle-miles-traveled.html#cb39-397"></a><span class="co">#       duration = duration,</span></span>
<span id="cb39-398"><a href="commute-vehicle-miles-traveled.html#cb39-398"></a><span class="co">#       person_miles = S000*as.numeric(distance)/1.60934,</span></span>
<span id="cb39-399"><a href="commute-vehicle-miles-traveled.html#cb39-399"></a><span class="co">#       person_hours = S000*as.numeric(duration)/60</span></span>
<span id="cb39-400"><a href="commute-vehicle-miles-traveled.html#cb39-400"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb39-401"><a href="commute-vehicle-miles-traveled.html#cb39-401"></a><span class="co">#     mutate(</span></span>
<span id="cb39-402"><a href="commute-vehicle-miles-traveled.html#cb39-402"></a><span class="co">#       tier =</span></span>
<span id="cb39-403"><a href="commute-vehicle-miles-traveled.html#cb39-403"></a><span class="co">#         case_when(</span></span>
<span id="cb39-404"><a href="commute-vehicle-miles-traveled.html#cb39-404"></a><span class="co">#           duration &lt; 10 ~ &quot;Less than 10 minutes&quot;,</span></span>
<span id="cb39-405"><a href="commute-vehicle-miles-traveled.html#cb39-405"></a><span class="co">#           duration &lt; 15 ~ &quot;10 to 14 minutes&quot;,</span></span>
<span id="cb39-406"><a href="commute-vehicle-miles-traveled.html#cb39-406"></a><span class="co">#           duration &lt; 20 ~ &quot;15 to 19 minutes&quot;,</span></span>
<span id="cb39-407"><a href="commute-vehicle-miles-traveled.html#cb39-407"></a><span class="co">#           duration &lt; 25 ~ &quot;20 to 24 minutes&quot;,</span></span>
<span id="cb39-408"><a href="commute-vehicle-miles-traveled.html#cb39-408"></a><span class="co">#           duration &lt; 30 ~ &quot;25 to 29 minutes&quot;,</span></span>
<span id="cb39-409"><a href="commute-vehicle-miles-traveled.html#cb39-409"></a><span class="co">#           duration &lt; 35 ~ &quot;30 to 34 minutes&quot;,</span></span>
<span id="cb39-410"><a href="commute-vehicle-miles-traveled.html#cb39-410"></a><span class="co">#           duration &lt; 45 ~ &quot;35 to 44 minutes&quot;,</span></span>
<span id="cb39-411"><a href="commute-vehicle-miles-traveled.html#cb39-411"></a><span class="co">#           duration &lt; 60 ~ &quot;45 to 59 minutes&quot;,</span></span>
<span id="cb39-412"><a href="commute-vehicle-miles-traveled.html#cb39-412"></a><span class="co">#           TRUE ~ &quot;60 or more minutes&quot;</span></span>
<span id="cb39-413"><a href="commute-vehicle-miles-traveled.html#cb39-413"></a><span class="co">#         )</span></span>
<span id="cb39-414"><a href="commute-vehicle-miles-traveled.html#cb39-414"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb39-415"><a href="commute-vehicle-miles-traveled.html#cb39-415"></a><span class="co">#     left_join(</span></span>
<span id="cb39-416"><a href="commute-vehicle-miles-traveled.html#cb39-416"></a><span class="co">#       travel_time_mode_summary %&gt;%</span></span>
<span id="cb39-417"><a href="commute-vehicle-miles-traveled.html#cb39-417"></a><span class="co">#         dplyr::select(</span></span>
<span id="cb39-418"><a href="commute-vehicle-miles-traveled.html#cb39-418"></a><span class="co">#           time,</span></span>
<span id="cb39-419"><a href="commute-vehicle-miles-traveled.html#cb39-419"></a><span class="co">#           perc_jobs_car,</span></span>
<span id="cb39-420"><a href="commute-vehicle-miles-traveled.html#cb39-420"></a><span class="co">#           perc_jobs_carpool,</span></span>
<span id="cb39-421"><a href="commute-vehicle-miles-traveled.html#cb39-421"></a><span class="co">#           perc_vehicle</span></span>
<span id="cb39-422"><a href="commute-vehicle-miles-traveled.html#cb39-422"></a><span class="co">#         ),</span></span>
<span id="cb39-423"><a href="commute-vehicle-miles-traveled.html#cb39-423"></a><span class="co">#       by = c(&quot;tier&quot; = &quot;time&quot;)</span></span>
<span id="cb39-424"><a href="commute-vehicle-miles-traveled.html#cb39-424"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb39-425"><a href="commute-vehicle-miles-traveled.html#cb39-425"></a><span class="co">#     mutate(</span></span>
<span id="cb39-426"><a href="commute-vehicle-miles-traveled.html#cb39-426"></a><span class="co">#       jobs_car = jobs*perc_jobs_car,</span></span>
<span id="cb39-427"><a href="commute-vehicle-miles-traveled.html#cb39-427"></a><span class="co">#       jobs_carpool = jobs*perc_jobs_carpool,</span></span>
<span id="cb39-428"><a href="commute-vehicle-miles-traveled.html#cb39-428"></a><span class="co">#       vehicles = jobs*perc_vehicle,</span></span>
<span id="cb39-429"><a href="commute-vehicle-miles-traveled.html#cb39-429"></a><span class="co">#       vmt = person_miles*perc_vehicle</span></span>
<span id="cb39-430"><a href="commute-vehicle-miles-traveled.html#cb39-430"></a><span class="co">#     )</span></span>
<span id="cb39-431"><a href="commute-vehicle-miles-traveled.html#cb39-431"></a><span class="co"># </span></span>
<span id="cb39-432"><a href="commute-vehicle-miles-traveled.html#cb39-432"></a><span class="co">#     stockton_commute_vmt_countymode &lt;-</span></span>
<span id="cb39-433"><a href="commute-vehicle-miles-traveled.html#cb39-433"></a><span class="co">#       rbind(stockton_commute_vmt_countymode,</span></span>
<span id="cb39-434"><a href="commute-vehicle-miles-traveled.html#cb39-434"></a><span class="co">#         data.frame(</span></span>
<span id="cb39-435"><a href="commute-vehicle-miles-traveled.html#cb39-435"></a><span class="co">#           Year = year,</span></span>
<span id="cb39-436"><a href="commute-vehicle-miles-traveled.html#cb39-436"></a><span class="co">#           person_miles = sum(stockton_lodes_h_mode$person_miles, na.rm=T),</span></span>
<span id="cb39-437"><a href="commute-vehicle-miles-traveled.html#cb39-437"></a><span class="co">#           jobs = sum(stockton_lodes_h_mode$jobs, na.rm=T),</span></span>
<span id="cb39-438"><a href="commute-vehicle-miles-traveled.html#cb39-438"></a><span class="co">#           jobs_car = sum(stockton_lodes_h_mode$jobs_car, na.rm=T),</span></span>
<span id="cb39-439"><a href="commute-vehicle-miles-traveled.html#cb39-439"></a><span class="co">#           jobs_carpool = sum(stockton_lodes_h_mode$jobs_carpool, na.rm=T),</span></span>
<span id="cb39-440"><a href="commute-vehicle-miles-traveled.html#cb39-440"></a><span class="co">#           vehicles = sum(stockton_lodes_h_mode$vehicles, na.rm = T),</span></span>
<span id="cb39-441"><a href="commute-vehicle-miles-traveled.html#cb39-441"></a><span class="co">#           vmt = sum(stockton_lodes_h_mode$vmt, na.rm=T)</span></span>
<span id="cb39-442"><a href="commute-vehicle-miles-traveled.html#cb39-442"></a><span class="co">#         )</span></span>
<span id="cb39-443"><a href="commute-vehicle-miles-traveled.html#cb39-443"></a><span class="co">#       )</span></span>
<span id="cb39-444"><a href="commute-vehicle-miles-traveled.html#cb39-444"></a><span class="co"># }</span></span>
<span id="cb39-445"><a href="commute-vehicle-miles-traveled.html#cb39-445"></a><span class="co"># </span></span>
<span id="cb39-446"><a href="commute-vehicle-miles-traveled.html#cb39-446"></a><span class="co"># save(stockton_commute_vmt_countymode, file = &quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/stockton_commute_vmt_countymode.Rdata&quot;)</span></span>
<span id="cb39-447"><a href="commute-vehicle-miles-traveled.html#cb39-447"></a><span class="co"># load(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/stockton_commute_vmt_countymode.Rdata&quot;)</span></span>
<span id="cb39-448"><a href="commute-vehicle-miles-traveled.html#cb39-448"></a><span class="co"># </span></span>
<span id="cb39-449"><a href="commute-vehicle-miles-traveled.html#cb39-449"></a><span class="co"># stockton_commute_vmt_countymode %&gt;%</span></span>
<span id="cb39-450"><a href="commute-vehicle-miles-traveled.html#cb39-450"></a><span class="co">#   ggplot(</span></span>
<span id="cb39-451"><a href="commute-vehicle-miles-traveled.html#cb39-451"></a><span class="co">#     aes(</span></span>
<span id="cb39-452"><a href="commute-vehicle-miles-traveled.html#cb39-452"></a><span class="co">#       x = Year,</span></span>
<span id="cb39-453"><a href="commute-vehicle-miles-traveled.html#cb39-453"></a><span class="co">#       y = vmt/jobs</span></span>
<span id="cb39-454"><a href="commute-vehicle-miles-traveled.html#cb39-454"></a><span class="co">#     )</span></span>
<span id="cb39-455"><a href="commute-vehicle-miles-traveled.html#cb39-455"></a><span class="co">#   ) +</span></span>
<span id="cb39-456"><a href="commute-vehicle-miles-traveled.html#cb39-456"></a><span class="co">#   geom_line()</span></span>
<span id="cb39-457"><a href="commute-vehicle-miles-traveled.html#cb39-457"></a><span class="co"># </span></span>
<span id="cb39-458"><a href="commute-vehicle-miles-traveled.html#cb39-458"></a><span class="co"># load(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/stockton_commute_vmt_bgmode.Rdata&quot;)</span></span>
<span id="cb39-459"><a href="commute-vehicle-miles-traveled.html#cb39-459"></a><span class="co"># </span></span>
<span id="cb39-460"><a href="commute-vehicle-miles-traveled.html#cb39-460"></a><span class="co"># load(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/stockton_commute_vmt_tractmode.Rdata&quot;)</span></span>
<span id="cb39-461"><a href="commute-vehicle-miles-traveled.html#cb39-461"></a><span class="co"># </span></span>
<span id="cb39-462"><a href="commute-vehicle-miles-traveled.html#cb39-462"></a><span class="co"># load(&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/stockton_commute_vmt_countymode.Rdata&quot;)</span></span>
<span id="cb39-463"><a href="commute-vehicle-miles-traveled.html#cb39-463"></a><span class="co"># </span></span>
<span id="cb39-464"><a href="commute-vehicle-miles-traveled.html#cb39-464"></a><span class="co"># stockton_commute_vmt_compare &lt;-</span></span>
<span id="cb39-465"><a href="commute-vehicle-miles-traveled.html#cb39-465"></a><span class="co">#   rbind(</span></span>
<span id="cb39-466"><a href="commute-vehicle-miles-traveled.html#cb39-466"></a><span class="co">#     stockton_commute_vmt_bgmode %&gt;% </span></span>
<span id="cb39-467"><a href="commute-vehicle-miles-traveled.html#cb39-467"></a><span class="co">#       mutate(mode = &quot;block group&quot;),</span></span>
<span id="cb39-468"><a href="commute-vehicle-miles-traveled.html#cb39-468"></a><span class="co">#     stockton_commute_vmt_tractmode %&gt;% </span></span>
<span id="cb39-469"><a href="commute-vehicle-miles-traveled.html#cb39-469"></a><span class="co">#       mutate(mode = &quot;tract&quot;),</span></span>
<span id="cb39-470"><a href="commute-vehicle-miles-traveled.html#cb39-470"></a><span class="co">#     stockton_commute_vmt_countymode %&gt;% </span></span>
<span id="cb39-471"><a href="commute-vehicle-miles-traveled.html#cb39-471"></a><span class="co">#       mutate(mode = &quot;county&quot;)</span></span>
<span id="cb39-472"><a href="commute-vehicle-miles-traveled.html#cb39-472"></a><span class="co">#   )</span></span>
<span id="cb39-473"><a href="commute-vehicle-miles-traveled.html#cb39-473"></a><span class="co"># </span></span>
<span id="cb39-474"><a href="commute-vehicle-miles-traveled.html#cb39-474"></a><span class="co"># stockton_commute_vmt_compare %&gt;%</span></span>
<span id="cb39-475"><a href="commute-vehicle-miles-traveled.html#cb39-475"></a><span class="co">#   ggplot(</span></span>
<span id="cb39-476"><a href="commute-vehicle-miles-traveled.html#cb39-476"></a><span class="co">#     aes(</span></span>
<span id="cb39-477"><a href="commute-vehicle-miles-traveled.html#cb39-477"></a><span class="co">#       x = Year,</span></span>
<span id="cb39-478"><a href="commute-vehicle-miles-traveled.html#cb39-478"></a><span class="co">#       y = vmt/jobs,</span></span>
<span id="cb39-479"><a href="commute-vehicle-miles-traveled.html#cb39-479"></a><span class="co">#       linetype = mode</span></span>
<span id="cb39-480"><a href="commute-vehicle-miles-traveled.html#cb39-480"></a><span class="co">#     )</span></span>
<span id="cb39-481"><a href="commute-vehicle-miles-traveled.html#cb39-481"></a><span class="co">#   ) +</span></span>
<span id="cb39-482"><a href="commute-vehicle-miles-traveled.html#cb39-482"></a><span class="co">#   geom_line()</span></span>
<span id="cb39-483"><a href="commute-vehicle-miles-traveled.html#cb39-483"></a></span>
<span id="cb39-484"><a href="commute-vehicle-miles-traveled.html#cb39-484"></a>county_commute_vmt_tractmode <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-485"><a href="commute-vehicle-miles-traveled.html#cb39-485"></a><span class="st">  </span><span class="kw">filter</span>(County <span class="op">==</span><span class="st"> &quot;077&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-486"><a href="commute-vehicle-miles-traveled.html#cb39-486"></a><span class="st">  </span><span class="kw">ggplot</span>(</span>
<span id="cb39-487"><a href="commute-vehicle-miles-traveled.html#cb39-487"></a>    <span class="kw">aes</span>(</span>
<span id="cb39-488"><a href="commute-vehicle-miles-traveled.html#cb39-488"></a>      <span class="dt">x =</span> Year,</span>
<span id="cb39-489"><a href="commute-vehicle-miles-traveled.html#cb39-489"></a>      <span class="dt">y =</span> vmt<span class="op">/</span>jobs_car,</span>
<span id="cb39-490"><a href="commute-vehicle-miles-traveled.html#cb39-490"></a>      <span class="dt">linetype =</span> <span class="st">&quot;SJC&quot;</span></span>
<span id="cb39-491"><a href="commute-vehicle-miles-traveled.html#cb39-491"></a>    )</span>
<span id="cb39-492"><a href="commute-vehicle-miles-traveled.html#cb39-492"></a>  ) <span class="op">+</span></span>
<span id="cb39-493"><a href="commute-vehicle-miles-traveled.html#cb39-493"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb39-494"><a href="commute-vehicle-miles-traveled.html#cb39-494"></a><span class="st">  </span><span class="kw">geom_line</span>(</span>
<span id="cb39-495"><a href="commute-vehicle-miles-traveled.html#cb39-495"></a>    <span class="dt">data =</span> stockton_commute_vmt_tractmode,</span>
<span id="cb39-496"><a href="commute-vehicle-miles-traveled.html#cb39-496"></a>    <span class="kw">aes</span>(</span>
<span id="cb39-497"><a href="commute-vehicle-miles-traveled.html#cb39-497"></a>      <span class="dt">x =</span> Year,</span>
<span id="cb39-498"><a href="commute-vehicle-miles-traveled.html#cb39-498"></a>      <span class="dt">y =</span> vmt<span class="op">/</span>jobs_car,</span>
<span id="cb39-499"><a href="commute-vehicle-miles-traveled.html#cb39-499"></a>      <span class="dt">linetype =</span> <span class="st">&quot;Stockton&quot;</span></span>
<span id="cb39-500"><a href="commute-vehicle-miles-traveled.html#cb39-500"></a>    )</span>
<span id="cb39-501"><a href="commute-vehicle-miles-traveled.html#cb39-501"></a>  ) <span class="op">+</span></span>
<span id="cb39-502"><a href="commute-vehicle-miles-traveled.html#cb39-502"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;One-way commute miles</span><span class="ch">\n</span><span class="st">per car-dependent worker&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;Group&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:stockton-commute-vmt-tractmode"></span>
<img src="stockton_greeneconomy_files/figure-html/stockton-commute-vmt-tractmode-1.png" alt="One-way commute miles per car-dependent worker in Stockton vs. SJC, 2011 to 2017. Data from LODES." width="672" />
<p class="caption">
Figure 2.22: One-way commute miles per car-dependent worker in Stockton vs. SJC, 2011 to 2017. Data from LODES.
</p>
</div>
<p><span class="math inline">\(~\)</span></p>
<p>The following figure compares the percent of car-dependent workers who carpool in Stockton and SJC. Stockton workers overall are more likely to carpool than SJC workers overall, but the trends are again similar between Stockton and SJC, with a decline in carpooling in the last two years of data.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="commute-vehicle-miles-traveled.html#cb40-1"></a><span class="kw">load</span>(<span class="st">&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/stockton_commute_vmt_tractmode.Rdata&quot;</span>)</span>
<span id="cb40-2"><a href="commute-vehicle-miles-traveled.html#cb40-2"></a></span>
<span id="cb40-3"><a href="commute-vehicle-miles-traveled.html#cb40-3"></a><span class="kw">load</span>(<span class="st">&quot;C:/Users/derek/Google Drive/City Systems/Stockton Green Economy/LODES/county_commute_vmt_tractmode.Rdata&quot;</span>)</span>
<span id="cb40-4"><a href="commute-vehicle-miles-traveled.html#cb40-4"></a></span>
<span id="cb40-5"><a href="commute-vehicle-miles-traveled.html#cb40-5"></a>stockton_county_commute_vmt_compare &lt;-</span>
<span id="cb40-6"><a href="commute-vehicle-miles-traveled.html#cb40-6"></a><span class="st">  </span><span class="kw">rbind</span>(</span>
<span id="cb40-7"><a href="commute-vehicle-miles-traveled.html#cb40-7"></a>    county_commute_vmt_tractmode <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb40-8"><a href="commute-vehicle-miles-traveled.html#cb40-8"></a><span class="st">      </span><span class="kw">filter</span>(County <span class="op">==</span><span class="st"> &quot;077&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb40-9"><a href="commute-vehicle-miles-traveled.html#cb40-9"></a><span class="st">      </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>County) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb40-10"><a href="commute-vehicle-miles-traveled.html#cb40-10"></a><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">type =</span> <span class="st">&quot;SJC&quot;</span>), </span>
<span id="cb40-11"><a href="commute-vehicle-miles-traveled.html#cb40-11"></a>    stockton_commute_vmt_tractmode <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb40-12"><a href="commute-vehicle-miles-traveled.html#cb40-12"></a><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">type =</span> <span class="st">&quot;Stockton&quot;</span>)</span>
<span id="cb40-13"><a href="commute-vehicle-miles-traveled.html#cb40-13"></a>  )</span>
<span id="cb40-14"><a href="commute-vehicle-miles-traveled.html#cb40-14"></a></span>
<span id="cb40-15"><a href="commute-vehicle-miles-traveled.html#cb40-15"></a>stockton_county_commute_vmt_compare <span class="op">%&gt;%</span></span>
<span id="cb40-16"><a href="commute-vehicle-miles-traveled.html#cb40-16"></a><span class="st">  </span><span class="kw">ggplot</span>(</span>
<span id="cb40-17"><a href="commute-vehicle-miles-traveled.html#cb40-17"></a>    <span class="kw">aes</span>(</span>
<span id="cb40-18"><a href="commute-vehicle-miles-traveled.html#cb40-18"></a>      <span class="dt">x =</span> Year,</span>
<span id="cb40-19"><a href="commute-vehicle-miles-traveled.html#cb40-19"></a>      <span class="dt">y =</span> jobs_carpool<span class="op">/</span>jobs_car<span class="op">*</span><span class="dv">100</span>,</span>
<span id="cb40-20"><a href="commute-vehicle-miles-traveled.html#cb40-20"></a>      <span class="dt">linetype =</span> type</span>
<span id="cb40-21"><a href="commute-vehicle-miles-traveled.html#cb40-21"></a>    )</span>
<span id="cb40-22"><a href="commute-vehicle-miles-traveled.html#cb40-22"></a>  ) <span class="op">+</span></span>
<span id="cb40-23"><a href="commute-vehicle-miles-traveled.html#cb40-23"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb40-24"><a href="commute-vehicle-miles-traveled.html#cb40-24"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;% Car-dependent workers who carpool&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;Group&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:stockton-county-commute-vmt-compare"></span>
<img src="stockton_greeneconomy_files/figure-html/stockton-county-commute-vmt-compare-1.png" alt="Percent of car-dependent commuters traveling by carpool, Stockton vs. SJC, 2011 to 2017. Data from LODES and ACS." width="672" />
<p class="caption">
Figure 2.23: Percent of car-dependent commuters traveling by carpool, Stockton vs. SJC, 2011 to 2017. Data from LODES and ACS.
</p>
</div>
<p><span class="math inline">\(~\)</span></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="origin-destination-commute-analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="non-commute-vehicle-miles-traveled.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "none",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": false,
"info": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
