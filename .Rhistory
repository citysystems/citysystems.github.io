json <- fromJSON(paste0(
"https://api.purpleair.com/v1/sensors/",
127197,
"?api_key=",
pa_api,
"&read_key=APPT5T2OYFU6T6LU",
"&fields=name,location_type,latitude,longitude,primary_id_a,primary_key_a,secondary_id_a,secondary_key_a,primary_id_b,primary_key_b,secondary_id_b,secondary_key_b"
))
View(json)
#get private sensors----
json <- fromJSON(paste0(
"https://api.purpleair.com/v1/sensors/",
127197,
"?api_key=",
pa_api,
# "&read_key=APPT5T2OYFU6T6LU",
"&fields=name,location_type,latitude,longitude,primary_id_a,primary_key_a,secondary_id_a,secondary_key_a,primary_id_b,primary_key_b,secondary_id_b,secondary_key_b"
))
basekey_main <- "appscP3FzoEx66HEW"
tablekey <- "tblPZnfV3jNyIJPPG"
main_airtable <- airtable(
base = basekey_main,
tables = tablekey
)
main_table <- eval(parse(text = paste0("main_airtable$",tablekey)))$select()
data1 <- main_table
offset <- get_offset(main_table)
while(!is.null(offset)) {
main_table <- eval(parse(text = paste0("main_airtable$",tablekey)))$select(offset = offset)
data1 <-
tryCatch({
data1 %>%
dplyr::bind_rows(main_table)
}, error = function(e) {
print(e)
return(data1)
}
)
offset <- get_offset(main_table)
}
participants <- data1 %>%
filter(`ID (from PurpleAir ID)` != "NULL") %>%
transmute(
id = as.numeric(unlist(`ID (from PurpleAir ID)`)),
access = unlist(`AccessCode (from Assigned Access Code)`),
condition = unlist(`Condition (from Assigned Access Code)`)
)
View(participants)
load(url("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.rda"))
View(hub_table)
setwd("~/GitHub/citysystems.github.io")
hub_table <- hub_table %>%
mutate(
Logo = ifelse(
is.na(Logo),
Logo,
Logo %>% gsub(".*\\(","",.) %>% gsub(")","",.)
),
`Featured Photo` = ifelse(
is.na(`Featured Photo`),
`Featured Photo`,
`Featured Photo` %>% gsub(".*\\(","",.) %>% gsub(")","",.)
)
)
View(hub_table)
load(url("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.rda"))
View(hub_table)
hub_table <- hub_table %>%
mutate(
Logo = ifelse(
is.na(Logo),
Logo,
Logo %>% gsub(".*\\(","",.) %>% gsub(")","",.)
),
`Featured Photo` = ifelse(
is.na(`Featured Photo`),
`Featured Photo`,
`Featured Photo` %>% gsub(".*\\(","",.) %>% gsub(")","",.)
)
)
save(hub_table,file = "oce/hubs_from_airtable.rda")
save(hub_table,file = "oce/hubs_from_airtable.rda")
data <- hub_table
save(data,file = "oce/hubs_from_airtable.rda")
load(url("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.rda"))
load(url("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.rda"))
load(url("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.rda"))
?use_hover
library(hover)
use_hover
?use_hover
menu <- list()
menu[[1]] <- 1
menu[[4]] <- 2
menu
menu <- list()
unique_schools <- c("Dean of Research","Graduate School of Business","Graduate School of Education","Provost","School of Earth, Energy & Environmental Sciences","School of Engineering","School of Humanities & Sciences","School of Law","Stanford Medicine","Stanford Athletics","Vice President for the Arts","Vice Provost for Graduate Education","Vice Provost for Undergraduate Education")
buttons <- c("All Hubs",unique_schools,"")
urls <- c(
"all_oce",
"stanford_president",
"stanford_business_s",
"stanford_education_s",
"stanford_flag_f",
"stanford_eee_s",
"stanford_engineering_s",
"stanford_humanities_s",
"stanford_law_s",
"stanford_medicine_s",
"stanfordlogo",
"stanford_vpa_s",
"stanford_vpge_s",
"stanford_vpue_s",
"placeholder_oce"
)
rep(1:3)
rep((1+0:1):(3+0:1))
rep((1+(0:1)):(3+(0:1)))
1+0:1
(1+0:1):(2+0:1)
(1+0:1):2
(1:3):(1:3)
(1:3):(3:5)
floor(2/2)
floor(2/3)
ceiling(2/3)
ceiling(1/3)
ceiling(3/3)
ceiling(4/3)
button_list <- list()
button_text_list <- list()
for(i in 1:15){
button[[i]] <- div(
hover_action_button(
inputId = paste0("button",i),
tags$img(src = paste0("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/icons/",urls[[i]],".png"),height = "50px"),
button_animation = "rotate",
style="background: transparent; border: none; outline: none;"
),
style=button_style,align = "center"
)
button_text[[i]] <- div(
HTML(paste0("<center><font size=3>",button_texts[[i]],"</font></center>")),
style=button_style
)
}
button_list <- list()
button_text_list <- list()
for(i in 1:15){
button[[i]] <- div(
hover_action_button(
inputId = paste0("button",i),
tags$img(src = paste0("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/icons/",urls[[i]],".png"),height = "50px"),
button_animation = "rotate",
style="background: transparent; border: none; outline: none;"
),
style=button_style,align = "center"
)
button_text_list[[i]] <- div(
HTML(paste0("<center><font size=3>",button_texts[[i]],"</font></center>")),
style=button_style
)
}
button_list <- list()
button_text_list <- list()
for(i in 1:15){
button_list[[i]] <- div(
hover_action_button(
inputId = paste0("button",i),
tags$img(src = paste0("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/icons/",urls[[i]],".png"),height = "50px"),
button_animation = "rotate",
style="background: transparent; border: none; outline: none;"
),
style=button_style,
align = "center"
)
button_text_list[[i]] <- div(
HTML(paste0("<center><font size=3>",button_texts[[i]],"</font></center>")),
style=button_style
)
}
button_texts <- c("All Hubs",unique_schools,"")
urls <- c(
"all_oce",
"stanford_president",
"stanford_business_s",
"stanford_education_s",
"stanford_flag_f",
"stanford_eee_s",
"stanford_engineering_s",
"stanford_humanities_s",
"stanford_law_s",
"stanford_medicine_s",
"stanfordlogo",
"stanford_vpa_s",
"stanford_vpge_s",
"stanford_vpue_s",
"placeholder_oce"
)
button_list <- list()
button_text_list <- list()
for(i in 1:15){
button_list[[i]] <- div(
hover_action_button(
inputId = paste0("button",i),
tags$img(src = paste0("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/icons/",urls[[i]],".png"),height = "50px"),
button_animation = "rotate",
style="background: transparent; border: none; outline: none;"
),
style=button_style,
align = "center"
)
button_text_list[[i]] <- div(
HTML(paste0("<center><font size=3>",button_texts[[i]],"</font></center>")),
style=button_style
)
}
button_list <- list()
button_list[[1]]
urls <- c(
"all_oce",
"stanford_president",
"stanford_business_s",
"stanford_education_s",
"stanford_flag_f",
"stanford_eee_s",
"stanford_engineering_s",
"stanford_humanities_s",
"stanford_law_s",
"stanford_medicine_s",
"stanfordlogo",
"stanford_vpa_s",
"stanford_vpge_s",
"stanford_vpue_s",
"placeholder_oce"
)
urls[[1]]
urls[[2]]
button_texts <- c("All Hubs",unique_schools,"")
button_list <- list()
button_list[[1]] <- 1
button_list[[15]] <- 1
button_list[[2]] <- 1
button_list[[3]] <- 1
button_list[[1:3]]
button_list[1:3]
button_list <- list()
button_list[1] <- 1
button_list[2] <- 1
button_list[3] <- 1
button_list_text <- list()
button_list_text[1] <- 2
button_list_text[2] <- 2
button_list_text[3] <- 2
c(
button_list[1:3],
button_text_list[1:3])
c(
button_list[1:3],
button_list_text[1:3])
ceiling(2/2)
ceiling(1/2)
ceiling(3/2)
ceiling(4/2)
3%%3
i <- 1
x <- 1
while(x<=30){
# menu_list[[x]] <- button_list[[i]]
# menu_list[[x+3]] <- button_text_list[[i]]
print(x)
i <- i + 1
if(x&&3==0)
x <- x + 4
else
x <- x + 1
}
i <- 1
x <- 1
while(x<=30){
# menu_list[[x]] <- button_list[[i]]
# menu_list[[x+3]] <- button_text_list[[i]]
print(x)
print(i)
i <- i + 1
if(x&&3==0)
x <- x + 4
else
x <- x + 1
}
i <- 1
x <- 1
while(x<=27){
# menu_list[[x]] <- button_list[[i]]
# menu_list[[x+3]] <- button_text_list[[i]]
print(x)
print(i)
i <- i + 1
if(x&&3==0)
x <- x + 4
else
x <- x + 1
}
button_texts <- c("All Hubs",unique_schools,"")
button_texts[1]
button_texts[2]
i <- 1
x <- 1
while(i <= 15){
# menu_list[[x]] <- button_list[[i]]
# menu_list[[x+3]] <- button_text_list[[i]]
print(x+3)
print(button_text_list[[i]])
i <- i + 1
if(x&&3==0){
x <- x + 4
} else {
x <- x + 1
}
}
i <- 1
x <- 1
while(i <= 15){
# menu_list[[x]] <- button_list[[i]]
# menu_list[[x+3]] <- button_text_list[[i]]
print(x+3)
print(button_text_list[[i]])
i <- i + 1
if(x&&3==0){
x <- x + 4
} else {
x <- x + 1
}
}
i <- 1
x <- 1
while(i <= 15){
# menu_list[[x]] <- button_list[[i]]
# menu_list[[x+3]] <- button_text_list[[i]]
print(x+3)
print(button_texts[i])
i <- i + 1
if(x&&3==0){
x <- x + 4
} else {
x <- x + 1
}
}
load(url("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.rda"))
load(url("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.rda"))
data <-
hub_table %>%
arrange(`Campus Hubs`) %>%
mutate(
Logo = case_when(
grepl(".jpg",Logo) ~ paste0("https",str_match(Logo, "https\\s*(.*?)\\s*jpg")[,2],"jpg"),
grepl(".png",Logo) ~ paste0("https",str_match(Logo, "https\\s*(.*?)\\s*png")[,2],"png"),
TRUE ~ Logo
),
`Featured Photo` = case_when(
grepl(".jpg",`Featured Photo`) ~ paste0("https",str_match(`Featured Photo`, "https\\s*(.*?)\\s*jpg")[,2],"jpg"),
grepl(".png",`Featured Photo`) ~ paste0("https",str_match(`Featured Photo`, "https\\s*(.*?)\\s*png")[,2],"png"),
TRUE ~ `Featured Photo`
),
Logo = ifelse(
is.na(Logo),
Logo,
Logo %>% gsub(".*\\(","",.) %>% gsub(")","",.)
),
`Featured Photo` = ifelse(
is.na(`Featured Photo`),
`Featured Photo`,
`Featured Photo` %>% gsub(".*\\(","",.) %>% gsub(")","",.)
)
)
save(data,file = "oce/hubs_from_airtable.rda")
load(url("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.rda"))
load(url("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.rda"))
save(data,file = "oce/hubs_from_airtable.rda")
load(url("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.rda"))
load(url("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.rda"))
load(url("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.rda"))
load(url("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.rda"))
load(url("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.rda"))
View(data)
data <-
hub_table %>%
arrange(`Campus Hubs`) %>%
mutate(
Logo = case_when(
grepl(".jpg",Logo) ~ paste0("https",str_match(Logo, "https\\s*(.*?)\\s*jpg")[,2],"jpg"),
grepl(".png",Logo) ~ paste0("https",str_match(Logo, "https\\s*(.*?)\\s*png")[,2],"png"),
TRUE ~ Logo
),
`Featured Photo` = case_when(
grepl(".jpg",`Featured Photo`) ~ paste0("https",str_match(`Featured Photo`, "https\\s*(.*?)\\s*jpg")[,2],"jpg"),
grepl(".png",`Featured Photo`) ~ paste0("https",str_match(`Featured Photo`, "https\\s*(.*?)\\s*png")[,2],"png"),
TRUE ~ `Featured Photo`
),
Logo = ifelse(
is.na(Logo),
Logo,
Logo %>% gsub(".*\\(","",.) %>% gsub(")","",.)
),
`Featured Photo` = ifelse(
is.na(`Featured Photo`),
`Featured Photo`,
`Featured Photo` %>% gsub(".*\\(","",.) %>% gsub(")","",.)
)
)
save(data,file = "oce/hubs_from_airtable.rda")
data
load(url("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.rda"))
source("~/GitHub/citysystems.github.io/oce/hub_airtable_processing.R", echo=TRUE)
View(data)
data <- readRDS("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.rds")
data <- readRDS("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.rds")
data <- readRDS("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.rds")
data <- readRDS("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.rds")
hubs_from_airtable <- readRDS("~/GitHub/hubs_from_airtable.rds")
data <- readRDS("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.rds")
data <- readRDS("https://github.com/citysystems/citysystems.github.io/blob/master/oce/hubs_from_airtable.rds?raw=true")
data <- readRDS("https://github.com/citysystems/citysystems.github.io/blob/master/oce/hubs_from_airtable.rds?raw=true")
source("~/GitHub/citysystems.github.io/oce/hub_airtable_processing.R", echo=TRUE)
data <-
hub_table %>%
arrange(`Campus Hubs`) %>%
mutate(
Logo = case_when(
grepl(".jpg",Logo) ~ paste0("https",str_match(Logo, "https\\s*(.*?)\\s*jpg")[,2],"jpg"),
grepl(".png",Logo) ~ paste0("https",str_match(Logo, "https\\s*(.*?)\\s*png")[,2],"png"),
TRUE ~ Logo
),
`Featured Photo` = case_when(
grepl(".jpg",`Featured Photo`) ~ paste0("https",str_match(`Featured Photo`, "https\\s*(.*?)\\s*jpg")[,2],"jpg"),
grepl(".png",`Featured Photo`) ~ paste0("https",str_match(`Featured Photo`, "https\\s*(.*?)\\s*png")[,2],"png"),
TRUE ~ `Featured Photo`
),
Logo = ifelse(
is.na(Logo),
Logo,
Logo %>% gsub(".*\\(","",.) %>% gsub(")","",.)
),
`Featured Photo` = ifelse(
is.na(`Featured Photo`),
`Featured Photo`,
`Featured Photo` %>% gsub(".*\\(","",.) %>% gsub(")","",.)
)
)
View(data)
write_csv(data,"oce/hubs_from_airtable.csv")
data <- read_csv("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.csv")
unique_themes <- c("Arts & Humanities","Education","Environment and Sustainability","Equity or Socioeconomic Issues","Health","Identity & Human Rights","Law, Policy, & Justice","Recreation and Culture","Media and Technology","Global","Other")
unique_schools <- c("Dean of Research","Graduate School of Business","Graduate School of Education","Provost","School of Earth, Energy & Environmental Sciences","School of Engineering","School of Humanities & Sciences","School of Law","Stanford Medicine","Stanford Athletics","Vice President for the Arts","Vice Provost for Graduate Education","Vice Provost for Undergraduate Education")
button_texts <- c("All Hubs",unique_schools,"")
urls <- c(
"all_oce",
"stanford_president",
"stanford_business_s",
"stanford_education_s",
"stanford_flag_f",
"stanford_eee_s",
"stanford_engineering_s",
"stanford_humanities_s",
"stanford_law_s",
"stanford_medicine_s",
"stanfordlogo",
"stanford_vpa_s",
"stanford_vpge_s",
"stanford_vpue_s",
"placeholder_oce"
)
campus_hubs <- unique(data$`Campus Hubs`)
data <- read_csv("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.csv") %>%
st_as_sf(geometry="geometry")
data <- read_csv("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.csv") %>%
st_set_geometry("geometry")
?st_as_sf
data <- read_csv("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.csv") %>%
st_set_geometry(sf_column_name = "geometry")
data <- read_csv("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.csv") %>%
st_as_sf(sf_column_name = "geometry")
data <-
hub_table %>%
arrange(`Campus Hubs`) %>%
mutate(
Logo = case_when(
grepl(".jpg",Logo) ~ paste0("https",str_match(Logo, "https\\s*(.*?)\\s*jpg")[,2],"jpg"),
grepl(".png",Logo) ~ paste0("https",str_match(Logo, "https\\s*(.*?)\\s*png")[,2],"png"),
TRUE ~ Logo
),
`Featured Photo` = case_when(
grepl(".jpg",`Featured Photo`) ~ paste0("https",str_match(`Featured Photo`, "https\\s*(.*?)\\s*jpg")[,2],"jpg"),
grepl(".png",`Featured Photo`) ~ paste0("https",str_match(`Featured Photo`, "https\\s*(.*?)\\s*png")[,2],"png"),
TRUE ~ `Featured Photo`
),
Logo = ifelse(
is.na(Logo),
Logo,
Logo %>% gsub(".*\\(","",.) %>% gsub(")","",.)
),
`Featured Photo` = ifelse(
is.na(`Featured Photo`),
`Featured Photo`,
`Featured Photo` %>% gsub(".*\\(","",.) %>% gsub(")","",.)
),
geometry = st_as_text(geometry)
)
write_csv(data,"oce/hubs_from_airtable.csv")
View(data)
data <- read_csv("https://raw.githubusercontent.com/citysystems/citysystems.github.io/master/oce/hubs_from_airtable.csv") %>%
st_as_sf(wkt = "geometry")
